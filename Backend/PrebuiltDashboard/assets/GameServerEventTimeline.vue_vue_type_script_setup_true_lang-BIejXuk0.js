import{b9 as Ke,a0 as Be,c1 as Qe,dC as Xe,X as Ye,dD as Je,dE as et,Y as tt,dF as nt,dG as it,dH as st,D as H,dI as _e,dJ as xe,dK as ot,dL as Ee,z as Ie,d as G,c as V,a as r,o as n,n as Ue,F as L,q as d,m as x,aV as Fe,dM as at,b as N,bj as z,t as k,e as E,U as ue,w as B,j as Z,h as W,i as J,cn as be,a7 as Ce,K as Y,Q as ne,f as M,k as ie,dN as lt,dO as rt,T as dt,b7 as je,_ as ve,y as ut,B as mt,ae as ct,r as wt,dP as me,dQ as vt,a4 as pt,s as ft,bE as ye,dz as Ve,bl as ht,dR as yt,cG as ae,bs as It}from"./index-DAyiym1a.js";import{_ as Se}from"./MAbbreviateNumber.vue_vue_type_script_setup_true_lang-D1qNvv8f.js";import{t as bt}from"./debounce-CRuraxcR.js";import{_ as gt}from"./MInputSingleSelectDropdown.vue_vue_type_script_setup_true_lang-BRIBVSuX.js";import{_ as kt}from"./MInputText.vue_vue_type_script_setup_true_lang-B9sf9LSD.js";var Pe=1/0,Tt=17976931348623157e292;function Te(s){if(!s)return s===0?s:0;if(s=bt(s),s===Pe||s===-Pe){var a=s<0?-1:1;return a*Tt}return s===s?s:0}function Dt(s,a,e){if(!Ke(e))return!1;var t=typeof a;return(t=="number"?Be(e)&&Qe(a,e.length):t=="string"&&a in e)?Xe(e[a],s):!1}var Ct="[object Map]",St="[object Set]",$t=Object.prototype,xt=$t.hasOwnProperty;function Et(s){if(s==null)return!0;if(Be(s)&&(Ye(s)||typeof s=="string"||typeof s.splice=="function"||Je(s)||et(s)||tt(s)))return!s.length;var a=nt(s);if(a==Ct||a==St)return!s.size;if(it(s))return!st(s).length;for(var e in s)if(xt.call(s,e))return!1;return!0}var Rt=Math.ceil,At=Math.max;function Lt(s,a,e,t){for(var l=-1,o=At(Rt((a-s)/(e||1)),0),i=Array(o);o--;)i[++l]=s,s+=e;return i}function Mt(s){return function(a,e,t){return t&&typeof t!="number"&&Dt(a,e,t)&&(e=t=void 0),a=Te(a),e===void 0?(e=a,a=0):e=Te(e),t=t===void 0?a<e?1:-1:Te(t),Lt(a,e,t)}}var ze=Mt();function pe(s){let[a,e]=Object.entries(s)[0];for(;;){if(e.itemType==="root")return e;if(a=e.hierarchy.parentId,!a)throw new Error("No root element found in timeline data");e=s[a]}}function fe(s,a){if(a.itemType!=="root")throw new Error("Supplied item is not a root");return a.hierarchy.childIds.map(e=>{const t=s[e];if(!t)throw new Error("Section not found");if(t.itemType!=="section")throw new Error("Item contains item that is not a section");return[e,t]})}function Re(s,a){if(a.itemType!=="section")throw new Error("Supplied item is not a section");return a.hierarchy.childIds.map(e=>{const t=s[e];if(!t)throw new Error("Group not found");if(t.itemType!=="group")throw new Error("Item contains item that is not a group");return[e,t]})}function ge(s,a){if(a.itemType!=="group")throw new Error("Supplied item is not a group");return a.hierarchy.childIds.map(e=>{const t=s[e];if(!t)throw new Error("Row not found");if(t.itemType!=="row")throw new Error("Item contains item that is not a row");return[e,t]})}function $e(s,a){if(a.itemType!=="row")throw new Error("Supplied item is not a row");return a.hierarchy.childIds.map(e=>{const t=s[e];if(!t)throw new Error("Item not found");return[e,t]})}class ke{expectedItemType;constructor(a){this.expectedItemType=a}getAs(a,e){const t=this.getRaw(a,e);if(t.itemType!==this.expectedItemType)throw new Error("Item is not of the expected type");return t}getParentAs(a,e){const t=this.getRaw(a,e);if(t.itemType==="root")throw new Error("Item cannot have parent");const l=t.hierarchy.parentId;if(!l)throw new Error("Item has no parent");const o=this.getAs(l,e);if(o.itemType!==this.expectedItemType)throw new Error("Parent is not of the expected type");if(o.itemType!=="root"&&o.itemType!=="section"&&o.itemType!=="group"&&o.itemType!=="row")throw new Error("Parent item cannot have children");const i=o.hierarchy.childIds.indexOf(a);if(i===-1)throw new Error("Parent does not contain child");return{parentId:l,parentItem:o,childIndex:i}}getChildAs(a,e,t){const l=this.getRaw(a,t);if(l.itemType!=="root"&&l.itemType!=="section"&&l.itemType!=="group"&&l.itemType!=="row")throw new Error("Item cannot have children");const o=l.hierarchy.childIds;if(e<0||e>=o.length)throw new Error("Child index out of bounds");const i=o[e],u=this.getAs(i,t);return{childId:i,childItem:u}}getRaw(a,e){if(!e)throw new Error("No items supplied");const t=e[a];if(!t)throw new Error("Item not found");return t}}function He(s,a,e){const t=new ke(a),{parentItem:l}=t.getParentAs(s,e);return!!l.isImmutable}function Ft(s,a,e,t){const o=H.fromISO(s.renderData.instantIsoString).diff(a,"minutes").minutes*e,i=t?42:22;return{itemType:"instantItem",styles:{backgroundColor:s.renderData.color??_e.instantItem,left:`${o-i/2}px`,width:`${i}px`,height:`${i}px`}}}function Vt(s,a,e,t,l,o,i,u){const m=H.fromISO(s.renderData.startInstantIsoString);if(m>i)return;const w=s.renderData.endInstantIsoString?H.fromISO(s.renderData.endInstantIsoString):H.utc().plus({years:10});let f=w;const h=f.diff(m);let T=!1;if(h<l&&(f=m.plus(l),T=!0),f<o)return;const S=xe(s.metadata.color??_e.spanItem);return{itemType:"spanItem",containerStyles:Pt(a,t,m,f,s.renderData.state,u),textContainerStyles:T?void 0:zt(a,e,o,i,t,m,f,S,u),detailsRow:u&&!T?{isPlayerLocalTimeZone:s.renderData.playerLocalTimeZone,isLocked:s.renderData.isLocked,isImmutable:s.renderData.isImmutable,isTargeted:s.renderData.isTargeted,isRecurring:s.renderData.isRecurring,statusValue:s.renderData.statusValue}:void 0,activitySegments:Ot(m,w,f,s.renderData.state?-1.5:0,s.renderData.activitySegments,S,t,!s.renderData.state||s.renderData.state==="paused"),displayName:s.metadata.displayName}}function Pt(s,a,e,t,l,o,i){const u=e.diff(s,"minutes").minutes*a,m=t.diff(s,"minutes").minutes*a+1.5,f=(l?{paused:"3px solid rgba(255, 128, 0, 0.7)",cancelled:"3px dashed rgba(255, 0, 0, 0.7)",draft:"3px dashed rgba(128, 128, 128, 0.7)"}[l]:void 0)??void 0,h=o?`${Ae-.1}rem`:`${he-.1}rem`;return{left:`${u}px`,width:`${m-u}px`,height:h,border:f,zIndex:i}}function zt(s,a,e,t,l,o,i,u,m,w){o<e&&(o=e),i>t&&(i=t),i>a&&(i=a);const f=o.diff(s,"minutes").minutes*l,h=i.diff(s,"minutes").minutes*l+1.5,[T,S,b]=u,v=(T*.299+S*.587+b*.114)/255>=.5?"black":"white",y=m?"42px":"22px",g=m?"0.25rem":"0.125rem",C=m?"0.25rem":"0.125rem";return{left:`${f}px`,width:`${h-f}px`,height:y,color:v,fill:v,paddingTop:g,paddingBottom:C,zIndex:w}}function Ot(s,a,e,t,l,o,i,u){const m=e.diff(s).as("minutes"),w=a.diff(s).as("minutes"),h=H.utc().diff(s).as("minutes"),T=ot(o),S=Ee(o);if(!l||l.length===0){const y=0+t,g=m*i,C=u&&h>=0&&h<w;return[{x:Math.floor(y),width:Math.floor(g)+1,color:T,active:C}]}const b=[];let p=0;for(const y of l){const g=Ie.fromISO(y.durationIsoString).as("minutes"),C=p*i+t,F=g*i,O=u&&h>=p&&h<p+g,A={x:Math.floor(C),width:Math.floor(F)+1,color:T,active:O};y.type==="paused"&&(A.color=S),b.push(A),p+=g}if(p<w){const y=p*i+t,g=(w-p)*i,C=u&&h>=p&&h<w;b.push({x:Math.floor(y),width:Math.floor(g)+1,color:T,active:C})}if(!e.equals(a)){const y=a.diff(s).as("minutes")*i+t,g=e.diff(a).as("minutes")*i;b.push({x:Math.floor(y)-1,width:Math.floor(g)+1,color:T})}return b}const Ge=1.25,he=1.5,Ae=2.75;function ce(s){return s*parseFloat(getComputedStyle(document.documentElement).fontSize)}function Oe(s){return s/parseFloat(getComputedStyle(document.documentElement).fontSize)}function Nt(s,a,e,t,l,o,i,u){const m={},w=pe(s.items),f=24*60,h=ce(o/f),S=Ie.fromObject({minutes:10/h});for(const[b,p]of fe(s.items,w))if(i.includes(b))for(const[y,g]of Re(s.items,p)){const C=u.includes(y);for(const[,F]of ge(s.items,g))for(const[O,A]of $e(s.items,F)){let P;A.itemType==="instantItem"?P=Ft(A,a,h,C):A.itemType==="spanItem"&&(P=Vt(A,a,e,h,S,t,l,C)),P&&(m[O]=P)}}return m}const Ne=G({inheritAttrs:!1,__name:"MEventTimelineItemInstantItem",props:{untypedRenderInfo:{},selected:{type:Boolean}},setup(s){const a=s,e=V(()=>{if(a.untypedRenderInfo.itemType!=="instantItem")throw new Error("Unexpected render info type");return a.untypedRenderInfo});return(t,l)=>(n(),r("div",Ue(t.$attrs,{class:"tw-absolute tw-flex tw-cursor-pointer tw-rounded-full tw-border tw-border-neutral-50 tw-shadow tw-filter hover:tw-brightness-90 active:tw-brightness-75"},{class:{"tw-ring tw-ring-blue-500 tw-ring-offset-1":t.selected},style:e.value.styles,onClick:l[0]||(l[0]=o=>t.$emit("click"))}),null,16))}}),Wt={key:0,width:"100%"},qt={key:0},Bt=["x","width","fill"],_t=["x","width"],Ut={class:"tw-truncate"},jt={key:0,class:"tw-flex tw-h-3 tw-items-center tw-justify-between tw-space-x-1 tw-overflow-hidden"},Ht={class:"tw-flex tw-items-center tw-space-x-0.5"},Gt={key:0,class:"tw-pointer-events-auto tw-flex tw-items-center tw-space-x-0.5 tw-text-xs"},We=G({inheritAttrs:!1,__name:"MEventTimelineItemSpanItem",props:{untypedRenderInfo:{},selected:{type:Boolean}},setup(s){const a=s,e=V(()=>{if(a.untypedRenderInfo.itemType!=="spanItem")throw new Error("Unexpected render info type");return a.untypedRenderInfo}),t=V(()=>e.value.activitySegments.some(l=>l.active));return(l,o)=>(n(),r(L,null,[d("div",Ue(l.$attrs,{class:"tw-absolute tw-flex tw-cursor-pointer tw-overflow-hidden tw-rounded-lg tw-border tw-border-neutral-50 tw-shadow tw-filter hover:tw-brightness-90 active:tw-brightness-75"},{class:{"tw-ring tw-ring-blue-500 tw-ring-offset-1":l.selected},style:e.value.containerStyles,onClick:o[0]||(o[0]=i=>l.$emit("click")),onMousedown:o[1]||(o[1]=Fe(()=>{},["stop"]))}),[e.value.activitySegments?(n(),r("svg",Wt,[t.value?(n(),r("defs",qt,o[4]||(o[4]=[at('<pattern id="active-event-overlay" width="15" height="1" patternUnits="userSpaceOnUse" patternTransform="rotate(-45)"><animate attributeName="x" from="15" to="0" dur="1s" repeatCount="indefinite"></animate><line stroke="#0006" stroke-width="5px" x1="0" x2="1"></line><line stroke="#fff6" stroke-width="5px" x1="1" x2="7"></line><line stroke="#0006" stroke-width="5px" x1="7" x2="8"></line></pattern>',1)]))):x("",!0),(n(!0),r(L,null,N(e.value.activitySegments,i=>(n(),r(L,null,[d("rect",{x:i.x,width:i.width,height:"100%",fill:i.color},null,8,Bt),i.active?(n(),r("rect",{key:0,x:i.x,width:i.width,height:"100%",fill:"url(#active-event-overlay)"},null,8,_t)):x("",!0)],64))),256))])):x("",!0)],16),e.value.textContainerStyles?(n(),r("div",{key:0,class:"tw-pointer-events-none tw-absolute tw-flex tw-cursor-pointer tw-select-none tw-flex-col tw-content-center tw-justify-between tw-px-1.5 tw-text-xs",style:z(e.value.textContainerStyles),onClick:o[2]||(o[2]=i=>l.$emit("click")),onMousedown:o[3]||(o[3]=Fe(()=>{},["stop"]))},[d("div",Ut,k(e.value.displayName),1),e.value.detailsRow?(n(),r("div",jt,[d("div",Ht,[e.value.detailsRow.isPlayerLocalTimeZone?(n(),E(ue,{key:0,class:"tw-pointer-events-auto tw-relative tw-bottom-[1px] tw-size-3",content:"Player Local Time","no-underline":""},{default:B(()=>o[5]||(o[5]=[d("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor"},[d("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 21a9.004 9.004 0 0 0 8.716-6.747M12 21a9.004 9.004 0 0 1-8.716-6.747M12 21c2.485 0 4.5-4.03 4.5-9S14.485 3 12 3m0 18c-2.485 0-4.5-4.03-4.5-9S9.515 3 12 3m0 0a8.997 8.997 0 0 1 7.843 4.582M12 3a8.997 8.997 0 0 0-7.843 4.582m15.686 0A11.953 11.953 0 0 1 12 10.5c-2.998 0-5.74-1.1-7.843-2.918m15.686 0A8.959 8.959 0 0 1 21 12c0 .778-.099 1.533-.284 2.253m0 0A17.919 17.919 0 0 1 12 16.5c-3.162 0-6.133-.815-8.716-2.247m0 0A9.015 9.015 0 0 1 3 12c0-1.605.42-3.113 1.157-4.418"})],-1)]),void 0,!0),_:1,__:[5]})):x("",!0),e.value.detailsRow.isLocked?(n(),E(ue,{key:1,class:"tw-pointer-events-auto tw-relative tw-bottom-[1px] tw-size-2",content:"Locked","no-underline":""},{default:B(()=>o[6]||(o[6]=[d("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 448 512"},[d("path",{d:"M144 144v48H304V144c0-44.2-35.8-80-80-80s-80 35.8-80 80zM80 192V144C80 64.5 144.5 0 224 0s144 64.5 144 144v48h16c35.3 0 64 28.7 64 64V448c0 35.3-28.7 64-64 64H64c-35.3 0-64-28.7-64-64V256c0-35.3 28.7-64 64-64H80z"})],-1)]),void 0,!0),_:1,__:[6]})):x("",!0),e.value.detailsRow.isImmutable?(n(),E(ue,{key:2,class:"tw-pointer-events-auto tw-relative tw-bottom-[1px] tw-size-2",content:"Immutable","no-underline":""},{default:B(()=>o[7]||(o[7]=[d("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 448 512"},[d("path",{d:"M144 144v48H304V144c0-44.2-35.8-80-80-80s-80 35.8-80 80zM80 192V144C80 64.5 144.5 0 224 0s144 64.5 144 144v48h16c35.3 0 64 28.7 64 64V448c0 35.3-28.7 64-64 64H64c-35.3 0-64-28.7-64-64V256c0-35.3 28.7-64 64-64H80z"})],-1)]),void 0,!0),_:1,__:[7]})):x("",!0),e.value.detailsRow.isRecurring?(n(),E(ue,{key:3,class:"tw-pointer-events-auto tw-size-2.5",content:"Recurring","no-underline":""},{default:B(()=>o[8]||(o[8]=[d("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512"},[d("path",{d:"M0 224c0 17.7 14.3 32 32 32s32-14.3 32-32c0-53 43-96 96-96H320v32c0 12.9 7.8 24.6 19.8 29.6s25.7 2.2 34.9-6.9l64-64c12.5-12.5 12.5-32.8 0-45.3l-64-64c-9.2-9.2-22.9-11.9-34.9-6.9S320 19.1 320 32V64H160C71.6 64 0 135.6 0 224zm512 64c0-17.7-14.3-32-32-32s-32 14.3-32 32c0 53-43 96-96 96H192V352c0-12.9-7.8-24.6-19.8-29.6s-25.7-2.2-34.9 6.9l-64 64c-12.5 12.5-12.5 32.8 0 45.3l64 64c9.2 9.2 22.9 11.9 34.9 6.9s19.8-16.6 19.8-29.6V448H352c88.4 0 160-71.6 160-160z"})],-1)]),void 0,!0),_:1,__:[8]})):x("",!0),e.value.detailsRow.isTargeted?(n(),E(ue,{key:4,class:"tw-pointer-events-auto tw-size-2",content:"Targeted","no-underline":""},{default:B(()=>o[9]||(o[9]=[d("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512"},[d("path",{d:"M448 256A192 192 0 1 0 64 256a192 192 0 1 0 384 0zM0 256a256 256 0 1 1 512 0A256 256 0 1 1 0 256zm256 80a80 80 0 1 0 0-160 80 80 0 1 0 0 160zm0-224a144 144 0 1 1 0 288 144 144 0 1 1 0-288zM224 256a32 32 0 1 1 64 0 32 32 0 1 1 -64 0z"})],-1)]),void 0,!0),_:1,__:[9]})):x("",!0)]),e.value.detailsRow.statusValue?(n(),r(L,{key:0},[e.value.detailsRow.statusValue.type==="participants"?(n(),r("div",Gt,[o[10]||(o[10]=d("div",{class:"tw-relative tw-bottom-[1px] tw-size-2"},[d("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 448 512"},[d("path",{d:"M224 256A128 128 0 1 0 224 0a128 128 0 1 0 0 256zm-45.7 48C79.8 304 0 383.8 0 482.3C0 498.7 13.3 512 29.7 512H418.3c16.4 0 29.7-13.3 29.7-29.7C448 383.8 368.2 304 269.7 304H178.3z"})])],-1)),Z(Se,{number:e.value.detailsRow.statusValue.value},null,8,["number"])])):(n(),r(L,{key:1},[o[11]||(o[11]=d("span",null,"?",-1)),Z(Se,{number:e.value.detailsRow.statusValue.value,"disable-tooltip":""},null,8,["number"])],64))],64)):x("",!0)])):x("",!0)],36)):x("",!0)],64))}}),Zt={key:1},Kt=G({__name:"MLazyLoader",props:{placeholderHeight:{default:"100px"},margin:{default:500},remainVisible:{type:Boolean,default:!1},showAfterDelayInMs:{default:250},hideAfterDelayInMs:{default:1e4}},setup(s){const a=s,e=W(),t=W(!1);let l,o,i;function u(){t.value=!0,a.remainVisible&&i.unobserve(e.value),l=void 0}function m(){t.value=!1,o=void 0}return J(()=>{i=new IntersectionObserver(([w])=>{w&&(clearTimeout(l),clearTimeout(o),w.isIntersecting?t.value||(a.showAfterDelayInMs>0?l=setTimeout(u,a.showAfterDelayInMs):u()):w.isIntersecting||t.value&&(a.hideAfterDelayInMs>0?o=setTimeout(m,a.hideAfterDelayInMs):m()))},{rootMargin:`${a.margin}px`}),i.observe(e.value)}),be(()=>{i.disconnect(),clearTimeout(l),clearTimeout(o)}),(w,f)=>(n(),r("div",{ref_key:"root",ref:e},[t.value?Ce(w.$slots,"default",{key:0}):(n(),r("div",Zt,[d("div",{style:z({minHeight:w.placeholderHeight})},null,4)]))],512))}}),Qt={key:0,class:"tw-absolute tw-left-0.5 tw-top-0 tw-text-xs tw-text-neutral-400"},Xt={key:1,class:"tw-absolute tw-right-0.5 tw-top-0.5 tw-size-4 tw-rounded-sm tw-bg-neutral-200 tw-text-xs tw-text-neutral-500"},Yt={class:"tw-mt-2 tw-space-x-1"},Jt={class:"tw-text-xs tw-text-neutral-600"},en={class:"tw-font-semibold"},tn={key:2,class:"tw-mt-1 tw-flex tw-justify-between tw-text-xs tw-text-neutral-600"},nn={key:3,class:"tw-mt-1 tw-flex tw-justify-between tw-text-xs tw-text-neutral-600"},sn={key:0,class:"tw-absolute tw-left-0.5 tw-top-0 tw-text-xs tw-text-neutral-400"},on={key:1,class:"tw-absolute tw-right-0.5 tw-top-0.5 tw-size-4 tw-rounded-sm tw-bg-neutral-200 tw-text-xs tw-text-neutral-500"},an={class:"-tw-mb-1 tw-mt-3 tw-text-xs tw-text-neutral-600"},ln={class:"tw-font-semibold"},rn={class:"tw-mt-1 tw-flex tw-text-center tw-text-xs tw-text-neutral-600"},dn={class:"tw-basis-full"},un={key:0,class:"tw-absolute tw-left-0.5 tw-top-0 tw-text-xs"},mn={key:0,class:"tw-text-neutral-500"},cn={class:"tw-pointer-events-none tw-absolute tw-inset-0 tw-z-0"},wn={key:0,class:"tw-pointer-events-none tw-absolute tw-inset-0 tw-z-30"},vn={key:1},pn={key:0},fn=G({__name:"MEventTimelineContent",props:{visibleTimelineData:{},timelineStartInstant:{},timelineEndInstant:{},timelineLengthInDays:{},timelineFirstVisibleInstant:{},numberOfTimelineBufferDays:{},timelineDayWidthInRem:{},expandedSections:{},expandedGroups:{},selectedItemIds:{}},emits:["update:timelineFirstVisibleInstant","update:timelineLastVisibleInstant","update:timelineDayWidthInRem","eventClicked"],setup(s,{expose:a,emit:e}){const t=e,l=s,o=`${Ae}rem`,i=V(()=>l.visibleTimelineData===void 0?void 0:pe(l.visibleTimelineData.items)),u=W(),m=W(0),w=W(l.timelineDayWidthInRem),f=V(()=>w.value<1?"years":w.value<3?"months":w.value<11?"weeks":w.value<20?"days":"hours"),h=V(()=>l.timelineLengthInDays/7);function T(c){return c===0?7-l.timelineStartInstant.weekday+1:c===h.value-1?l.timelineEndInstant.weekday:7}function S(){if(!u.value)return;const c=u.value.clientWidth,U=Oe(c);m.value=U/w.value}Y(()=>w.value,S),J(()=>{S(),window.addEventListener("resize",S)});const b=W();let p;J(()=>{if(!b.value){console.warn("Timeline element not found.");return}p=new ResizeObserver(()=>{O(l.timelineFirstVisibleInstant)}),p.observe(b.value)}),be(()=>{p&&p.disconnect()});const v=V(()=>{if(u.value)return l.timelineFirstVisibleInstant.plus({days:m.value})});Y(v,c=>{c&&t("update:timelineLastVisibleInstant",c)}),J(()=>{u.value&&u.value.addEventListener("scroll",c=>{const $=Oe(u.value.scrollLeft)/w.value,R=l.timelineStartInstant.plus({days:$});t("update:timelineFirstVisibleInstant",R)})});const y=V(()=>{const c=H.utc();if(!(c<l.timelineStartInstant||c>l.timelineEndInstant))return c.diff(l.timelineStartInstant,"days").days*100/l.timelineLengthInDays}),g=W(!1);J(()=>{function c($){g.value&&u.value.scrollBy(-$.movementX,0)}document.addEventListener("mousemove",c);function U(){g.value=!1}document.addEventListener("mouseup",U),be(()=>{document.removeEventListener("mousemove",c),document.removeEventListener("mouseup",U)})}),J(()=>{document.addEventListener("keydown",c=>{l.visibleTimelineData&&c.key==="e"&&c.ctrlKey&&l.selectedItemIds.length>0})});function C(c=!0){if(!u.value)return;const R=H.utc().diff(l.timelineStartInstant,"days").days*ce(w.value);c?u.value.scrollTo({left:R,behavior:"smooth"}):u.value.scrollLeft=R}function F(c,U=!0,$=!0){if(!u.value)return;let R;if(c.itemType==="instantItem"){const K=c;R=H.fromISO(K.renderData.instantIsoString)}else if(c.itemType==="spanItem"){const K=c;R=H.fromISO(K.renderData.startInstantIsoString)}else return;R=R.minus({days:1});const X=R.diff(l.timelineStartInstant,"days").days;$?u.value.scrollTo({left:X*ce(w.value),behavior:"smooth"}):u.value.scrollLeft=X*ce(w.value)}function O(c){if(!u.value)return;const $=c.diff(l.timelineStartInstant,"days").days*ce(w.value);u.value.scrollLeft=$}a({scrollTimelineToToday:C,scrollTimelineToItem:F,jumpTimelineToInstant:O});const A=W({});Y([()=>l.visibleTimelineData,()=>l.timelineStartInstant,()=>l.timelineEndInstant,()=>l.timelineFirstVisibleInstant,v,()=>l.timelineDayWidthInRem,()=>l.expandedSections,()=>l.expandedGroups],([c,U,$,R,X,K,Q,ee])=>{c&&X&&(A.value=Nt(c,U,$,R,X,K,Q,ee))}),Y([()=>l.timelineStartInstant,()=>l.timelineEndInstant,()=>l.timelineDayWidthInRem],()=>{O(l.timelineFirstVisibleInstant)});function P(c){return l.expandedSections.includes(c)}function _(c){return l.expandedGroups.includes(c)}return(c,U)=>(n(),r("div",{class:"tw-grow tw-overflow-x-scroll",ref_key:"timelineContainer",ref:u,"data-testid":"timeline-content"},[d("div",{ref_key:"timelineElement",ref:b,class:ne(`tw-relative tw-h-full tw-overflow-x-hidden ${g.value?"tw-cursor-grabbing":"tw-cursor-grab"}`),style:z({width:`${c.timelineDayWidthInRem*c.timelineLengthInDays}rem`}),onMousedown:U[0]||(U[0]=$=>g.value=!0)},[d("div",{class:ne(`${g.value?"tw-cursor-grabbing":"tw-cursor-grab"} tw-relative tw-z-10 tw-flex tw-h-14 tw-select-none tw-border-b tw-border-neutral-300 tw-drop-shadow-sm  ${g.value?"tw-cursor-grabbing":"tw-cursor-grab"}`)},[f.value==="hours"||f.value==="days"?(n(!0),r(L,{key:0},N(c.timelineLengthInDays,$=>(n(),r("div",{class:"tw-relative tw-text-center",style:z({width:`${c.timelineDayWidthInRem}rem`})},[c.timelineStartInstant.plus({days:$-1}).day===1?(n(),r("div",Qt,k(c.timelineStartInstant.plus({days:$-1}).toFormat("LLL")),1)):x("",!0),c.timelineStartInstant.plus({days:$-1}).weekday===1?(n(),r("div",Xt,k(c.timelineStartInstant.plus({days:$-1}).weekNumber),1)):x("",!0),d("div",Yt,[d("span",Jt,k(c.timelineStartInstant.plus({days:$-1}).toFormat("ccc")),1),d("span",en,k(c.timelineStartInstant.plus({days:$-1}).toFormat("d")),1)]),f.value==="days"?(n(),r("div",tn,[(n(!0),r(L,null,N(M(ze)(0,24,2),R=>(n(),r("div",{style:z({width:`${c.timelineDayWidthInRem/12}rem`})},k(R<10?"0"+R:R),5))),256))])):(n(),r("div",nn,[(n(!0),r(L,null,N(M(ze)(0,24),R=>(n(),r("div",{style:z({width:`${c.timelineDayWidthInRem/24}rem`})},k(R<10?"0"+R:R),5))),256))]))],4))),256)):f.value==="weeks"?(n(!0),r(L,{key:1},N(c.timelineLengthInDays,$=>(n(),r("div",{class:"tw-relative tw-text-center",style:z({width:`${c.timelineDayWidthInRem}rem`})},[c.timelineStartInstant.plus({days:$-1}).day===1?(n(),r("div",sn,k(c.timelineStartInstant.plus({days:$-1}).toFormat("LLL")),1)):x("",!0),c.timelineStartInstant.plus({days:$-1}).weekday===1?(n(),r("div",on,k(c.timelineStartInstant.plus({days:$-1}).weekNumber),1)):x("",!0),d("div",an,k(c.timelineStartInstant.plus({days:$-1}).toFormat("ccc")),1),d("div",ln,k(c.timelineStartInstant.plus({days:$-1}).toFormat("d")),1)],4))),256)):f.value==="months"?(n(!0),r(L,{key:2},N(Math.ceil(h.value),$=>(n(),r("div",{class:"tw-relative tw-ml-[1px]",style:z({width:`${c.timelineDayWidthInRem*T($-1)}rem`})},[d("div",null,"Week "+k(c.timelineStartInstant.plus({weeks:$-1}).weekNumber),1),d("div",rn,[(n(!0),r(L,null,N(T($-1),R=>(n(),r("div",dn,k(c.timelineStartInstant.plus({weeks:$-1,days:R-1-7+T(0)}).toFormat("d")),1))),256))])],4))),256)):f.value==="years"?(n(!0),r(L,{key:3},N(Math.ceil(h.value),$=>(n(),r("div",{class:"tw-relative",style:z({width:`${c.timelineDayWidthInRem*T($-1)}rem`})},[c.timelineStartInstant.plus({days:($-1)*7}).day<=7?(n(),r("div",un,[ie(k(c.timelineStartInstant.plus({days:($-1)*7}).toFormat("LLL")),1),c.timelineStartInstant.plus({days:($-1)*7}).month===1?(n(),r("div",mn,k(c.timelineStartInstant.plus({days:($-1)*7}).year),1)):x("",!0)])):x("",!0)],4))),256)):x("",!0)],2),d("div",cn,[(n(!0),r(L,null,N(c.timelineLengthInDays,($,R)=>(n(),r("div",null,[c.timelineStartInstant.plus({days:R}).weekday>5?(n(),r("div",{key:0,class:"tw-pointer-events-none tw-absolute tw-bottom-0 tw-top-0 tw-bg-neutral-500 tw-opacity-10",style:z({left:`${R*100/c.timelineLengthInDays}%`,width:`${100/c.timelineLengthInDays}%`})},null,4)):x("",!0)]))),256)),f.value==="hours"?(n(!0),r(L,{key:0},N(c.timelineLengthInDays*24,($,R)=>(n(),r("div",{class:"tw-pointer-events-none tw-absolute tw-bottom-0 tw-top-14 tw-w-[1px] tw-bg-neutral-200",style:z({left:`${R*100/(c.timelineLengthInDays*24)}%`})},null,4))),256)):f.value==="days"?(n(!0),r(L,{key:1},N(c.timelineLengthInDays*12,($,R)=>(n(),r("div",{class:"tw-pointer-events-none tw-absolute tw-bottom-0 tw-top-14 tw-w-[1px] tw-bg-neutral-200",style:z({left:`${R*100/(c.timelineLengthInDays*12)}%`})},null,4))),256)):x("",!0),f.value==="hours"||f.value==="days"||f.value==="weeks"?(n(!0),r(L,{key:2},N(c.timelineLengthInDays,($,R)=>(n(),r("div",{class:"tw-pointer-events-none tw-absolute tw-h-full tw-w-[1px] tw-bg-neutral-300",style:z({left:`${R*100/c.timelineLengthInDays}%`})},null,4))),256)):x("",!0),f.value==="years"?(n(!0),r(L,{key:3},N(c.timelineLengthInDays,($,R)=>(n(),r(L,null,[c.timelineStartInstant.plus({days:R-1}).weekday===1?(n(),r("div",{key:0,class:"tw-pointer-events-none tw-absolute tw-h-full tw-w-[1px] tw-bg-neutral-300",style:z({left:`${(R-1)*100/c.timelineLengthInDays}%`})},null,4)):x("",!0)],64))),256)):x("",!0)]),y.value?(n(),r("div",wn,[d("div",{class:"tw-pointer-events-none tw-absolute tw-h-full tw-w-0.5 tw-bg-red-500",style:z({left:`${y.value}%`})},null,4)])):x("",!0),d("div",{class:"tw-pointer-events-none tw-absolute tw-bottom-0 tw-left-0 tw-top-14 tw-z-20 tw-overflow-clip tw-bg-neutral-300",style:z({width:`${c.numberOfTimelineBufferDays*c.timelineDayWidthInRem}rem`})},U[1]||(U[1]=[d("div",{class:"active-event-overlay"},null,-1)]),4),d("div",{class:"tw-pointer-events-none tw-absolute tw-bottom-0 tw-right-0 tw-top-14 tw-z-20 tw-overflow-clip tw-bg-neutral-300",style:z({width:`${c.numberOfTimelineBufferDays*c.timelineDayWidthInRem}rem`})},U[2]||(U[2]=[d("div",{class:"active-event-overlay"},null,-1)]),4),c.visibleTimelineData&&i.value?(n(),r("span",vn,[(n(!0),r(L,null,N(M(fe)(c.visibleTimelineData.items,i.value),([$,R])=>(n(),r("div",null,[d("div",{class:"tw-border-b tw-border-neutral-300",style:z({height:`${M(Ge)}rem`})},null,4),P($)?(n(!0),r(L,{key:0},N(M(Re)(c.visibleTimelineData.items,R),([X,K])=>(n(),r("div",{class:"odd:tw-bg-neutral-100 even:tw-bg-neutral-50",style:z({backgroundColor:K.metadata.color?M(Ee)(M(xe)(K.metadata.color),.8):void 0})},[d("div",null,[_(X)?(n(),r("div",{key:0,class:"tw-relative tw-z-10",style:z({height:`${M(he)}rem`})},null,4)):(n(),r("div",{key:1,class:"tw-relative tw-z-10 tw-py-[1px]",style:z({height:`${M(he)}rem`})},[(n(!0),r(L,null,N(M(ge)(c.visibleTimelineData.items,K),([Q,ee])=>(n(),r(L,null,[(n(!0),r(L,null,N(M($e)(c.visibleTimelineData.items,ee),([j,te])=>(n(),r(L,null,[A.value[j]?(n(),r(L,{key:0},[te.itemType==="instantItem"?(n(),E(Ne,{key:0,untypedRenderInfo:A.value[j],selected:!!c.selectedItemIds?.includes(j),onClick:I=>c.$emit("eventClicked",j)},null,8,["untypedRenderInfo","selected","onClick"])):te.itemType==="spanItem"?(n(),E(We,{key:1,untypedRenderInfo:A.value[j],selected:!!c.selectedItemIds?.includes(j),onClick:I=>c.$emit("eventClicked",j)},null,8,["untypedRenderInfo","selected","onClick"])):x("",!0)],64)):x("",!0)],64))),256))],64))),256))],4))]),_(X)?(n(),r("div",pn,[(n(!0),r(L,null,N(M(ge)(c.visibleTimelineData.items,K),([Q,ee])=>(n(),E(Kt,{class:"tw-relative tw-z-10","show-after-delay-in-ms":0,"hide-after-delay-in-ms":1e3,margin:100,"placeholder-height":o,style:z({height:o})},{default:B(()=>[(n(!0),r(L,null,N(M($e)(c.visibleTimelineData.items,ee),([j,te])=>(n(),r("span",null,[A.value[j]?(n(),r(L,{key:0},[te.itemType==="instantItem"?(n(),E(Ne,{key:0,untypedRenderInfo:A.value[j],selected:!!c.selectedItemIds?.includes(j),onClick:I=>c.$emit("eventClicked",j)},null,8,["untypedRenderInfo","selected","onClick"])):te.itemType==="spanItem"?(n(),E(We,{key:1,untypedRenderInfo:A.value[j],selected:!!c.selectedItemIds?.includes(j),onClick:I=>c.$emit("eventClicked",j)},null,8,["untypedRenderInfo","selected","onClick"])):x("",!0)],64)):x("",!0)]))),256))],void 0,!0),_:2},1032,["style"]))),256))])):x("",!0)],4))),256)):x("",!0)]))),256))])):x("",!0)],38)],512))}}),hn={class:"tw-px-4"},yn={class:"tw-items-top tw-flex tw-justify-between tw-space-x-1 tw-pt-4"},In={class:"tw-font-bold"},bn={key:1,class:"tw-mr-1"},gn={class:"tw-text-sm",style:{"white-space":"pre-wrap"}},kn={class:"align-items-center tw-flex"},Tn={key:1,class:"tw-h-4 tw-w-4 tw-rounded tw-border tw-border-neutral-300",style:{background:"linear-gradient(to bottom right, white, white 45%, red 45%, red 55%, white 55%, white)"}},Dn={class:"tw-ml-1"},Cn={class:"tw-mt-2"},Sn={class:"tw-flex tw-flex-wrap tw-place-content-end tw-gap-1"},re=G({__name:"MEventTimelineInspectorSingle",props:{id:{},version:{},title:{},description:{},showTitleEditor:{type:Boolean},showDescriptionEditor:{type:Boolean},showColorPicker:{type:Boolean},currentColor:{},rawDetails:{},buttons:{}},emits:{close:()=>({type:"close"}),invokeCommand:s=>({type:"command",command:s})},setup(s,{emit:a}){const e=a,t=s,l=V(()=>t.buttons??[]);function o(w){const f={commandType:"changeMetadata",items:[{targetId:t.id,currentVersion:t.version,changes:[{property:"displayName",newValue:w}]}]};e("invokeCommand",f)}const i=Object.entries(lt).map(([w,f])=>({label:w,value:f}));i.unshift({label:"None",value:void 0});const u=W(t.currentColor?rt(t.currentColor):void 0);function m(w){u.value=w;const f={commandType:"changeMetadata",items:[{targetId:t.id,currentVersion:t.version,changes:[{property:"color",newValue:w}]}]};e("invokeCommand",f)}return(w,f)=>(n(),r("div",hn,[d("div",yn,[d("h2",In,[w.showTitleEditor?(n(),E(kt,{key:0,class:"tw-basis-2/3","model-value":w.title,placeholder:"No title.",debounce:1e3,"onUpdate:modelValue":f[0]||(f[0]=h=>o(h))},null,8,["model-value"])):(n(),r("span",bn,k(w.title),1)),Ce(w.$slots,"title-badge")]),d("button",{class:"tw-relative -tw-top-0.5 tw-inline-flex tw-h-7 tw-w-7 tw-shrink-0 tw-items-center tw-justify-center tw-rounded tw-font-semibold hover:tw-bg-neutral-100 active:tw-bg-neutral-200",onClick:f[1]||(f[1]=h=>w.$emit("close"))},f[2]||(f[2]=[d("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",class:"tw-w-6 tw-h-6"},[d("path",{"fill-rule":"evenodd",d:"M5.47 5.47a.75.75 0 011.06 0L12 10.94l5.47-5.47a.75.75 0 111.06 1.06L13.06 12l5.47 5.47a.75.75 0 11-1.06 1.06L12 13.06l-5.47 5.47a.75.75 0 01-1.06-1.06L10.94 12 5.47 6.53a.75.75 0 010-1.06z","clip-rule":"evenodd"})],-1)]))]),d("div",gn,k(w.description),1),w.showColorPicker?(n(),E(gt,{key:0,label:"Color","model-value":u.value,options:M(i),placeholder:"Select a color","onUpdate:modelValue":m},{option:B(({option:h})=>[d("div",kn,[h.value?(n(),r("div",{key:0,class:"tw-h-4 tw-w-4 tw-rounded-sm tw-border tw-border-neutral-800",style:z(`background-color: ${h.value}`)},null,4)):(n(),r("div",Tn)),d("div",Dn,k(h.label),1)])]),_:1},8,["model-value","options"])):x("",!0),d("div",Cn,[Ce(w.$slots,"default")]),d("div",Sn,[(n(!0),r(L,null,N(l.value,h=>(n(),E(dt,{"disabled-tooltip":h.disabledTooltip,permission:h.permission,to:h.url,size:"small",onClick:h.action},{default:B(()=>[ie(k(h.label),1)],void 0,!0),_:2},1032,["disabled-tooltip","permission","to","onClick"]))),256))])]))}}),le=new ke("section"),oe=new ke("group"),we=new ke("row"),$n=G({__name:"MEventTimelineItemGroupInspectorSingle",props:{id:{},version:{},visibleTimelineData:{},rawDetails:{}},emits:{close:()=>({type:"close"}),invokeCommand:s=>({type:"command",command:s})},setup(s,{emit:a}){const e=a,t=s,l=V(()=>t.rawDetails),o=V(()=>He(t.id,"section",t.visibleTimelineData?.items)),i=V(()=>je().doesHavePermission("api.liveops_events.edit"));function u(f){if(o.value)return"Cannot move. Parent is immutable.";{const{parentItem:h,childIndex:T}=le.getParentAs(t.id,t.visibleTimelineData?.items),S=T+(f==="up"?-1:2);return S<0?"Cannot move. Already at the top.":S>h.hierarchy.childIds.length?"Cannot move. Already at the bottom.":void 0}}function m(f){const{parentId:h,parentItem:T,childIndex:S}=le.getParentAs(t.id,t.visibleTimelineData?.items),b=S+(f==="up"?-1:2),p={commandType:"moveItems",items:[{targetId:t.id,currentVersion:t.version,parentVersion:T.version}],newParent:{targetId:h,currentVersion:T.version,insertIndex:b}};e("invokeCommand",p)}const w=V(()=>[{label:"Move Up",disabledTooltip:u("up"),permission:"api.liveops_timeline.edit",action:()=>{m("up")}},{label:"Move Down",disabledTooltip:u("down"),permission:"api.liveops_timeline.edit",action:()=>{m("down")}}]);return(f,h)=>(n(),E(re,{id:f.id,version:f.version,title:l.value.displayName,description:"Groups are used to organize rows in the timeline.",buttons:w.value,"show-title-editor":!o.value&&i.value,"show-color-picker":!o.value&&i.value,"current-color":l.value.details.color,"raw-details":f.rawDetails,onClose:h[0]||(h[0]=T=>e("close")),onInvokeCommand:h[1]||(h[1]=T=>e("invokeCommand",T))},null,8,["id","version","title","buttons","show-title-editor","show-color-picker","current-color","raw-details"]))}}),xn=G({__name:"MEventTimelineItemInstantItemInspectorSingle",props:{id:{},version:{},rawDetails:{}},emits:{close:()=>({type:"close"}),invokeCommand:s=>({type:"command",command:s})},setup(s,{emit:a}){const e=a,t=s,l=V(()=>t.rawDetails);return(o,i)=>(n(),E(re,{id:o.id,version:o.version,title:"Instant Event",description:l.value.description,"raw-details":o.rawDetails,onClose:i[0]||(i[0]=u=>e("close")),onInvokeCommand:i[1]||(i[1]=u=>e("invokeCommand",u))},{"title-badge":B(()=>[Z(ve,null,{default:B(()=>i[2]||(i[2]=[ie("instant",-1)]),void 0,!0),_:1,__:[2]})]),_:1},8,["id","version","description","raw-details"]))}}),En=G({__name:"MEventTimelineItemRowInspectorSingle",props:{id:{},version:{},visibleTimelineData:{},isImmutable:{type:Boolean},rawDetails:{}},emits:{close:()=>({type:"close"}),invokeCommand:s=>({type:"command",command:s})},setup(s,{emit:a}){const e=a,t=s,l=V(()=>t.rawDetails),o=V(()=>He(t.id,"group",t.visibleTimelineData?.items)),i=V(()=>je().doesHavePermission("api.liveops_events.edit"));function u(h){return o.value?"Cannot move. Parent is immutable.":h==="up"&&!m.value?"Cannot move. Already at the top.":h==="down"&&!w.value?"Cannot move. Already at the bottom.":void 0}const m=V(()=>{const{parentId:h,parentItem:T,childIndex:S}=oe.getParentAs(t.id,t.visibleTimelineData?.items);if(S>0){const v=S-1;return{commandType:"moveItems",items:[{targetId:t.id,currentVersion:t.version,parentVersion:T.version}],newParent:{targetId:h,currentVersion:T.version,insertIndex:v}}}const{parentItem:b,childIndex:p}=le.getParentAs(h,t.visibleTimelineData?.items);if(p>0){const v=b.hierarchy.childIds[p-1],y=oe.getAs(v,t.visibleTimelineData?.items),g=y.hierarchy.childIds.length;return{commandType:"moveItems",items:[{targetId:t.id,currentVersion:t.version,parentVersion:b.version}],newParent:{targetId:v,currentVersion:y.version,insertIndex:g}}}}),w=V(()=>{const{parentId:h,parentItem:T,childIndex:S}=oe.getParentAs(t.id,t.visibleTimelineData?.items);if(S<T.hierarchy.childIds.length-1){const v=S+2;return{commandType:"moveItems",items:[{targetId:t.id,currentVersion:t.version,parentVersion:T.version}],newParent:{targetId:h,currentVersion:T.version,insertIndex:v}}}const{parentItem:b,childIndex:p}=le.getParentAs(h,t.visibleTimelineData?.items);if(p<b.hierarchy.childIds.length-1){const v=b.hierarchy.childIds[p+1],y=oe.getAs(v,t.visibleTimelineData?.items);return{commandType:"moveItems",items:[{targetId:t.id,currentVersion:t.version,parentVersion:b.version}],newParent:{targetId:v,currentVersion:y.version,insertIndex:0}}}}),f=V(()=>[{label:"Move Up",disabledTooltip:u("up"),permission:"api.liveops_timeline.edit",action:()=>{m.value&&e("invokeCommand",m.value)}},{label:"Move Down",disabledTooltip:u("down"),permission:"api.liveops_timeline.edit",action:()=>{w.value&&e("invokeCommand",w.value)}}]);return(h,T)=>(n(),E(re,{id:h.id,version:h.version,title:l.value.displayName,description:"Rows are used to organize items in the timeline.",buttons:f.value,"show-title-editor":!h.isImmutable&&i.value,"raw-details":h.rawDetails,onClose:T[0]||(T[0]=S=>e("close")),onInvokeCommand:T[1]||(T[1]=S=>e("invokeCommand",S))},null,8,["id","version","title","buttons","show-title-editor","raw-details"]))}}),Rn=G({__name:"MEventTimelineItemSectionInspectorSingle",props:{id:{},version:{},rawDetails:{}},emits:{close:()=>({type:"close"}),invokeCommand:s=>({type:"command",command:s})},setup(s,{emit:a}){const e=a,t=s,l=V(()=>t.rawDetails);return(o,i)=>(n(),E(re,{id:o.id,version:o.version,title:l.value.displayName,description:"Sections are used to organize groups in the timeline.","raw-details":o.rawDetails,onClose:i[0]||(i[0]=u=>e("close")),onInvokeCommand:i[1]||(i[1]=u=>e("invokeCommand",u))},null,8,["id","version","title","raw-details"]))}}),An={key:1},Ln={key:1},Mn={key:4},Fn={key:5},Vn={key:6,class:"tw-bg-neutral-100 tw-px-0.5 tw-font-mono tw-text-red-500"},Pn={key:7},zn={key:9,class:"tw-text-red-400"},qe=G({__name:"MTaggedText",props:{content:{}},setup(s){const a={badge:{required:["value"],optional:["variant"],flags:[]},dateTime:{required:["value"],optional:["showAs"],flags:["disableTooltip"]},duration:{required:["value"],optional:["showAs","showZeroAs"],flags:[]},number:{required:["value"],optional:["showZeroAs","unit"],flags:[]},percentage:{required:["value"],optional:["decimalPlaces"],flags:[]},code:{required:["value"],optional:[],flags:[]},break:{required:[],optional:[],flags:[]},url:{required:["value"],optional:["text"],flags:[]}};function e(i){const u=/\[(badge|dateTime|duration|number|percentage|code|break|url)(.*?)\]/g,m=[];let w=0;return i.replace(u,(f,h,T,S)=>{S>w&&m.push({type:"text",value:i.slice(w,S)});const b={},p={};T.trim().replace(/(\w+)="(.*?)"/g,(g,C,F)=>(a[h]?.flags?.includes(C)?p[C]=F.toLowerCase()==="true":b[C]=F,""));const v=a[h]||{required:[],optional:[],flags:[]};if(T.trim().replace(/\b(\w+)\b/g,(g,C)=>(v.flags?.includes(C)&&!(C in p)&&(p[C]=!0),"")),!v.required.every(g=>g in b))console.warn(`Skipping ${h} tag: Missing required attributes.`);else{const g={};for(const C of[...v.required,...v.optional??[]])b[C]!==void 0&&(g[C]=b[C]);m.push({type:h,value:b.value,attributes:Object.keys(g).length?g:void 0,flags:Object.keys(p).length?p:void 0})}return w=S+f.length,f}),w<i.length&&m.push({type:"text",value:i.slice(w)}),m}function t(i){return i}function l(i){return i}function o(i){return i}return(i,u)=>(n(!0),r(L,null,N(e(i.content),m=>(n(),r("span",null,[m.type==="badge"?(n(),E(ve,{key:0,variant:m.attributes?.variant},{default:B(()=>[ie(k(m.value),1)],void 0,!0),_:2},1032,["variant"])):m.type==="dateTime"?(n(),E(ut,{key:1,instant:M(H).fromISO(m.value),"show-as":m.attributes?.showAs,"disable-tooltip":m.flags?.disableTooltip},null,8,["instant","show-as","disable-tooltip"])):m.type==="duration"?(n(),r(L,{key:2},[m.attributes?.showZeroAs&&M(Ie).fromISO(m.value).toMillis()===0?(n(),r("span",An,k(m.attributes?.showZeroAs),1)):(n(),E(mt,{key:0,duration:M(Ie).fromISO(m.value),"show-as":m.attributes?.showAs},null,8,["duration","show-as"]))],64)):m.type==="number"?(n(),r(L,{key:3},[m.attributes?.showZeroAs&&parseFloat(m.value)===0?(n(),r("span",Ln,k(m.attributes?.showZeroAs),1)):(n(),E(Se,{key:0,number:parseFloat(m.value),unit:m.attributes?.unit},null,8,["number","unit"]))],64)):m.type==="percentage"?(n(),r("span",Mn,k(parseFloat(m.value).toFixed(parseInt(m.attributes?.decimalPlaces??"0")))+"%",1)):m.type==="text"?(n(),r("span",Fn,k(m.value),1)):m.type==="code"?(n(),r("span",Vn,k(m.value),1)):m.type==="break"?(n(),r("br",Pn)):m.type==="url"?(n(),E(ct,{key:8,to:m.value},{default:B(()=>[ie(k(m.attributes?.text??m.value),1)],void 0,!0),_:2},1032,["to"])):(n(),r("span",zn,"?? "+k(m.value)+" ??",1))]))),256))}}),On={key:0,class:"tw-my-2 tw-rounded-md tw-border tw-border-neutral-200 tw-bg-neutral-50 tw-p-2 tw-text-xs"},Nn={class:"tw-flex tw-justify-between"},Wn={class:"tw-mb-1 tw-mr-1 tw-font-bold"},qn={key:1,class:"tw-my-2 tw-rounded-md tw-border tw-border-neutral-200 tw-bg-neutral-50 tw-p-2 tw-text-xs"},Bn={class:"tw-flex tw-justify-between"},_n={class:"tw-mb-1 tw-mr-1 tw-font-bold"},Un={class:"tw-text-neutral-400"},jn={key:2,class:"tw-flex tw-justify-between tw-text-xs"},Hn={key:1},Gn={key:2},Zn={key:3},Kn={key:3,class:"tw-text-xs"},Qn={key:4,class:"tw-text-xs"},Xn={key:5,class:"tw-text-xs"},Yn={key:6,class:"tw-text-red-400"},Jn=G({__name:"MAutoView",props:{content:{}},setup(s){const a=s,e=V(()=>a.content);return(t,l)=>{const o=wt("MAutoView",!0);return n(!0),r(L,null,N(e.value,i=>(n(),r(L,null,[i.type==="section"?(n(),r("div",On,[d("div",Nn,[d("div",Wn,k(M(me)(i.title)),1),i.badge?(n(),E(ve,{key:0,variant:i.badge.variant},{default:B(()=>[ie(k(M(me)(i.badge.text)),1)],void 0,!0),_:2},1032,["variant"])):x("",!0)]),Z(o,{content:i.content},null,8,["content"])])):i.type==="emptySection"?(n(),r("div",qn,[d("div",Bn,[d("div",_n,k(M(me)(i.title)),1),i.badge?(n(),E(ve,{key:0,variant:i.badge.variant},{default:B(()=>[ie(k(M(me)(i.badge.text)),1)],void 0,!0),_:2},1032,["variant"])):x("",!0)]),d("div",Un,k(i.reason),1)])):i.type==="keyValue"?(n(),r("div",jn,[d("div",null,k(M(me)(i.key)),1),d("div",null,[typeof i.value=="string"?(n(),E(qe,{key:0,content:i.value},null,8,["content"])):typeof i.value=="number"?(n(),r("div",Hn,k(i.value),1)):typeof i.value=="boolean"?(n(),r("div",Gn,k(i.value?"True":"False"),1)):(n(),r("pre",Zn,k(typeof i.value),1))])])):i.type==="rawData"?(n(),r("pre",Kn,k(i.rawData),1)):i.type==="plainText"?(n(),r("div",Qn,k(i.plainText),1)):i.type==="taggedText"?(n(),r("div",Xn,[Z(qe,{content:i.taggedText},null,8,["content"])])):(n(),r("span",Yn,"?? "+k(i.type)+" ??",1))],64))),256)}}}),ei=G({__name:"MEventTimelineItemSpanItemInspectorSingle",props:{id:{},version:{},visibleTimelineData:{},rawDetails:{}},emits:{close:()=>({type:"close"}),invokeCommand:s=>({type:"command",command:s})},setup(s,{emit:a}){const e=vt(),t=a,l=s,o=V(()=>l.rawDetails),i=V(()=>{if(o.value.state)return{paused:{text:"Paused",variant:"warning"},cancelled:{text:"Cancelled",variant:"danger"},draft:{text:"Draft",variant:"neutral"}}[o.value.state]}),u=W({autoView:[],buttons:[]});(()=>{const b=o.value.details.subType,p=o.value.details.subTypeDetails,v=e.getBuilder(b);if(v)Promise.resolve(v(p,w())).then(y=>{u.value=y});else{const y=Object.entries(p),g=[];y.length?g.push({type:"section",title:"Summary",content:Object.entries(p).map(([C,F])=>({type:"keyValue",key:pt(C),value:F}))}):g.push({type:"emptySection",title:"Summary",reason:"This item has no details to show."}),u.value={autoView:g,buttons:[]}}})();function w(){return{getMoveUpDownButtons:()=>{const b=f(),p=h();return[{label:"Move Up",disabledTooltip:b?void 0:"Cannot move up. Already at the top.",permission:"api.liveops_timeline.edit",action:()=>{b&&t("invokeCommand",b)}},{label:"Move Down",disabledTooltip:p?void 0:"Cannot move down. Already at the bottom.",permission:"api.liveops_timeline.edit",action:()=>{p&&t("invokeCommand",p)}}]}}}function f(){if(!l.visibleTimelineData)return;const b=l.visibleTimelineData.items,p=l.id,v=l.visibleTimelineData.items[p],{parentId:y,parentItem:g}=we.getParentAs(p,b),C=T(y,b,["group"]);if(!C)return;const F=we.getAs(C,b);return{commandType:"moveItems",items:[{targetId:p,currentVersion:v.version,parentVersion:g.version}],newParent:{targetId:C,currentVersion:F.version,insertIndex:0}}}function h(){if(!l.visibleTimelineData)return;const b=l.visibleTimelineData.items,p=l.id,v=l.visibleTimelineData.items[p],{parentId:y,parentItem:g}=we.getParentAs(p,b),C=S(y,b,["group"]);if(!C)return;const F=we.getAs(C,b);return{commandType:"moveItems",items:[{targetId:p,currentVersion:v.version,parentVersion:g.version}],newParent:{targetId:C,currentVersion:F.version,insertIndex:0}}}function T(b,p,v){const y=p[b];if(y.itemType==="root"||!y.hierarchy.parentId)return;const g=y.hierarchy.parentId,C=p[g],F=p[g].itemType;if(!Object.keys(C.hierarchy).includes("childIds"))throw new Error("Unexpected parent item type.");const O=C.hierarchy.childIds,A=O.indexOf(b);if(A-1>=0)return O[A-1];if(v.includes(F)){for(let P=T(g,p,v);P;P=T(P,p,v)){const _=p[P];if(!Object.keys(_.hierarchy).includes("childIds"))throw new Error("Unexpected parent item type.");const c=_.hierarchy.childIds;if(c.length>0)return c[c.length-1]}return}else return}function S(b,p,v){const y=p[b];if(y.itemType==="root"||!y.hierarchy.parentId)return;const g=y.hierarchy.parentId,C=p[g],F=p[g].itemType;if(!Object.keys(C.hierarchy).includes("childIds"))throw new Error("Unexpected parent item type.");const O=C.hierarchy.childIds,A=O.indexOf(b);if(A+1<O.length)return O[A+1];if(v.includes(F)){for(let P=S(g,p,v);P;P=S(P,p,v)){const _=p[P];if(!Object.keys(_.hierarchy).includes("childIds"))throw new Error("Unexpected parent item type.");const c=_.hierarchy.childIds;if(c.length>0)return c[0]}return}else return}return(b,p)=>(n(),E(re,{id:b.id,version:b.version,title:b.rawDetails.displayName,description:b.rawDetails.description,buttons:u.value.buttons,"raw-details":b.rawDetails,onClose:p[0]||(p[0]=v=>t("close"))},{default:B(()=>[Z(Jn,{content:u.value.autoView},null,8,["content"])]),"title-badge":B(()=>[i.value?(n(),E(ve,{key:b.id,variant:i.value.variant},{default:B(()=>[ie(k(i.value.text),1)],void 0,!0),_:1},8,["variant"])):x("",!0)]),_:1},8,["id","version","title","description","buttons","raw-details"]))}}),ti={key:0},ni={key:0,class:"tw-h-32 tw-content-center tw-text-center"},ii={key:1},si={key:6},oi={key:1},ai={class:"tw-rounded tw-border tw-border-neutral-300 tw-bg-neutral-100 tw-p-2 tw-text-xs"},li=G({__name:"MEventTimelineInspector",props:{selectedItemAndDetails:{},visibleTimelineData:{}},emits:{close:()=>({type:"close"}),invokeCommand:s=>({type:"invokeCommand",command:s})},setup(s,{emit:a}){const e=a,t=s,l=W();J(()=>{if(!l.value)return;new MutationObserver(()=>{window.dispatchEvent(new Event("resize"))}).observe(l.value,{attributes:!0,attributeFilter:["class"]})});const o=V(()=>{const i=Object.entries(t.selectedItemAndDetails);return i.length===1?{id:i[0][0],data:i[0][1].data,details:i[0][1].details}:void 0});return J(()=>{document.addEventListener("keydown",i=>{i.key==="Escape"&&e("close")})}),(i,u)=>(n(),r("div",{class:ne(["tw-shrink-0 tw-basis-96 tw-border-l tw-border-neutral-300 tw-shadow-[rgba(0,0,0,0.1)_-1px_0px_0px_0px]",M(Et)(i.selectedItemAndDetails)?"tw-hidden":"tw-block"])},[d("div",{class:"tw-sticky tw-top-0 tw-flex tw-flex-col",ref_key:"inspectorRef",ref:l},[Object.keys(i.selectedItemAndDetails).length===1?(n(),r("div",ti,[o.value?.details?(n(),r("span",ii,[o.value.data?o.value.details.itemType==="section"?(n(),E(Rn,{key:1,id:o.value.id,version:o.value.data.version,"visible-timeline-data":i.visibleTimelineData,"raw-details":o.value.details,onClose:u[1]||(u[1]=m=>i.$emit("close")),onInvokeCommand:u[2]||(u[2]=m=>e("invokeCommand",m))},null,8,["id","version","visible-timeline-data","raw-details"])):o.value.details.itemType==="group"?(n(),E($n,{key:2,id:o.value.id,version:o.value.data.version,"visible-timeline-data":i.visibleTimelineData,"raw-details":o.value.details,onClose:u[3]||(u[3]=m=>i.$emit("close")),onInvokeCommand:u[4]||(u[4]=m=>e("invokeCommand",m))},null,8,["id","version","visible-timeline-data","raw-details"])):o.value.details.itemType==="row"?(n(),E(En,{key:3,id:o.value.id,version:o.value.data.version,"visible-timeline-data":i.visibleTimelineData,"is-immutable":!!o.value.data.isImmutable,"raw-details":o.value.details,onClose:u[5]||(u[5]=m=>i.$emit("close")),onInvokeCommand:u[6]||(u[6]=m=>e("invokeCommand",m))},null,8,["id","version","visible-timeline-data","is-immutable","raw-details"])):o.value.details.itemType==="instantItem"?(n(),E(xn,{key:4,id:o.value.id,version:o.value.data.version,"raw-details":o.value.details,onClose:u[7]||(u[7]=m=>i.$emit("close")),onInvokeCommand:u[8]||(u[8]=m=>e("invokeCommand",m))},null,8,["id","version","raw-details"])):o.value.details.itemType==="spanItem"?(n(),E(ei,{key:5,id:o.value.id,version:o.value.data.version,"visible-timeline-data":i.visibleTimelineData,"raw-details":o.value.details,onClose:u[9]||(u[9]=m=>i.$emit("close")),onInvokeCommand:u[10]||(u[10]=m=>e("invokeCommand",m))},null,8,["id","version","visible-timeline-data","raw-details"])):(n(),r("div",si,"No inspector defined..")):(n(),E(re,{key:0,title:"Deleted Item",description:"This item has been deleted.","raw-details":o.value.details,id:o.value.id,version:0,onClose:u[0]||(u[0]=m=>i.$emit("close"))},null,8,["raw-details","id"]))])):(n(),r("div",ni,u[11]||(u[11]=[d("div",{class:"tw-animate-bounce tw-italic tw-text-neutral-500"},"Loading...",-1)])))])):(n(),r("div",oi,u[12]||(u[12]=[d("div",null,"Multiple Items Selected",-1)]))),Z(ft,{class:"tw-mb-2 tw-mt-4 tw-w-96 tw-text-neutral-500"},{header:B(()=>u[13]||(u[13]=[d("div",{class:"tw-text-sm"},"Raw Data",-1)])),default:B(()=>[d("pre",ai,[d("div",null,k(i.selectedItemAndDetails),1)])],void 0,!0),_:1})],512)],2))}}),ri={key:0,class:"tw-flex tw-items-center tw-space-x-0.5 tw-pr-1 tw-opacity-0 tw-transition-opacity group-hover:tw-opacity-100"},di={key:1,class:"tw-opacity-0 tw-transition-opacity group-hover:tw-opacity-100"},De=G({__name:"MEventTimelineNavigatorToolbar",props:{id:{},allowInspect:{type:[Boolean,String],default:!1},allowAdd:{type:[Boolean,String],default:!1},allowRemove:{type:[Boolean,String],default:!1},inspectTargetName:{default:"item"},addTargetName:{default:"item"},removeTargetName:{default:"item"},isSelected:{type:Boolean},isLocked:{type:Boolean}},emits:{itemInspected:s=>({type:"itemInspected",id:s}),close:()=>({type:"close"}),add:s=>({type:"add",id:s}),remove:s=>({type:"remove",id:s})},setup(s,{emit:a}){return(e,t)=>e.isLocked?(n(),r("div",ri,[t[5]||(t[5]=d("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 448 512",class:"tw-size-3 tw-fill-neutral-300"},[d("path",{d:"M144 144l0 48 160 0 0-48c0-44.2-35.8-80-80-80s-80 35.8-80 80zM80 192l0-48C80 64.5 144.5 0 224 0s144 64.5 144 144l0 48 16 0c35.3 0 64 28.7 64 64l0 192c0 35.3-28.7 64-64 64L64 512c-35.3 0-64-28.7-64-64L0 256c0-35.3 28.7-64 64-64l16 0z"})],-1)),e.allowInspect!==!1?(n(),E(ye,{key:0,"enabled-tooltip":`Inspect ${e.inspectTargetName}.`,"aria-label":`Inspect ${e.inspectTargetName}.`,permission:"api.general.view","disabled-tooltip":typeof e.allowInspect=="string"?e.allowInspect:void 0,variant:"neutral",onClick:t[0]||(t[0]=()=>e.isSelected?e.$emit("close"):e.$emit("itemInspected",e.id))},{default:B(()=>t[4]||(t[4]=[d("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512",fill:"currentColor",class:"tw-size-3"},[d("path",{d:"M495.9 166.6c3.2 8.7 .5 18.4-6.4 24.6l-43.3 39.4c1.1 8.3 1.7 16.8 1.7 25.4s-.6 17.1-1.7 25.4l43.3 39.4c6.9 6.2 9.6 15.9 6.4 24.6c-4.4 11.9-9.7 23.3-15.8 34.3l-4.7 8.1c-6.6 11-14 21.4-22.1 31.2c-5.9 7.2-15.7 9.6-24.5 6.8l-55.7-17.7c-13.4 10.3-28.2 18.9-44 25.4l-12.5 57.1c-2 9.1-9 16.3-18.2 17.8c-13.8 2.3-28 3.5-42.5 3.5s-28.7-1.2-42.5-3.5c-9.2-1.5-16.2-8.7-18.2-17.8l-12.5-57.1c-15.8-6.5-30.6-15.1-44-25.4L83.1 425.9c-8.8 2.8-18.6 .3-24.5-6.8c-8.1-9.8-15.5-20.2-22.1-31.2l-4.7-8.1c-6.1-11-11.4-22.4-15.8-34.3c-3.2-8.7-.5-18.4 6.4-24.6l43.3-39.4C64.6 273.1 64 264.6 64 256s.6-17.1 1.7-25.4L22.4 191.2c-6.9-6.2-9.6-15.9-6.4-24.6c4.4-11.9 9.7-23.3 15.8-34.3l4.7-8.1c6.6-11 14-21.4 22.1-31.2c5.9-7.2 15.7-9.6 24.5-6.8l55.7 17.7c13.4-10.3 28.2-18.9 44-25.4l12.5-57.1c2-9.1 9-16.3 18.2-17.8C227.3 1.2 241.5 0 256 0s28.7 1.2 42.5 3.5c9.2 1.5 16.2 8.7 18.2 17.8l12.5 57.1c15.8 6.5 30.6 15.1 44 25.4l55.7-17.7c8.8-2.8 18.6-.3 24.5 6.8c8.1 9.8 15.5 20.2 22.1 31.2l4.7 8.1c6.1 11 11.4 22.4 15.8 34.3zM256 336a80 80 0 1 0 0-160 80 80 0 1 0 0 160z"})],-1)]),void 0,!0),_:1,__:[4]},8,["enabled-tooltip","aria-label","disabled-tooltip"])):x("",!0)])):e.allowInspect!==!1||e.allowAdd!==!1||e.allowRemove!==!1?(n(),r("div",di,[e.allowAdd!==!1?(n(),E(ye,{key:0,"enabled-tooltip":`Add ${e.addTargetName}.`,"aria-label":`Add ${e.addTargetName}.`,permission:"api.liveops_timeline.edit","disabled-tooltip":typeof e.allowAdd=="string"?e.allowAdd:void 0,variant:"neutral",onClick:t[1]||(t[1]=l=>e.$emit("add",e.id))},{default:B(()=>t[6]||(t[6]=[d("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 448 512",fill:"currentColor",class:"tw-size-3"},[d("path",{d:"M256 80c0-17.7-14.3-32-32-32s-32 14.3-32 32l0 144L48 224c-17.7 0-32 14.3-32 32s14.3 32 32 32l144 0 0 144c0 17.7 14.3 32 32 32s32-14.3 32-32l0-144 144 0c17.7 0 32-14.3 32-32s-14.3-32-32-32l-144 0 0-144z"})],-1)]),void 0,!0),_:1,__:[6]},8,["enabled-tooltip","aria-label","disabled-tooltip"])):x("",!0),e.allowRemove!==!1?(n(),E(ye,{key:1,"enabled-tooltip":`Remove ${e.removeTargetName}.`,"aria-label":`Remove ${e.removeTargetName}.`,permission:"api.liveops_timeline.edit","disabled-tooltip":typeof e.allowRemove=="string"?e.allowRemove:void 0,variant:"neutral",onClick:t[2]||(t[2]=()=>e.$emit("remove",e.id))},{default:B(()=>t[7]||(t[7]=[d("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 448 512",fill:"currentColor",class:"tw-size-3"},[d("path",{d:"M135.2 17.7L128 32 32 32C14.3 32 0 46.3 0 64S14.3 96 32 96l384 0c17.7 0 32-14.3 32-32s-14.3-32-32-32l-96 0-7.2-14.3C307.4 6.8 296.3 0 284.2 0L163.8 0c-12.1 0-23.2 6.8-28.6 17.7zM416 128L32 128 53.2 467c1.6 25.3 22.6 45 47.9 45l245.8 0c25.3 0 46.3-19.7 47.9-45L416 128z"})],-1)]),void 0,!0),_:1,__:[7]},8,["enabled-tooltip","aria-label","disabled-tooltip"])):x("",!0),e.allowInspect!==!1?(n(),E(ye,{key:2,"enabled-tooltip":`Inspect ${e.inspectTargetName}.`,"aria-label":`Inspect ${e.inspectTargetName}.`,permission:"api.general.view","disabled-tooltip":typeof e.allowInspect=="string"?e.allowInspect:void 0,variant:"neutral",onClick:t[3]||(t[3]=()=>e.isSelected?e.$emit("close"):e.$emit("itemInspected",e.id))},{default:B(()=>t[8]||(t[8]=[d("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512",fill:"currentColor",class:"tw-size-3"},[d("path",{d:"M495.9 166.6c3.2 8.7 .5 18.4-6.4 24.6l-43.3 39.4c1.1 8.3 1.7 16.8 1.7 25.4s-.6 17.1-1.7 25.4l43.3 39.4c6.9 6.2 9.6 15.9 6.4 24.6c-4.4 11.9-9.7 23.3-15.8 34.3l-4.7 8.1c-6.6 11-14 21.4-22.1 31.2c-5.9 7.2-15.7 9.6-24.5 6.8l-55.7-17.7c-13.4 10.3-28.2 18.9-44 25.4l-12.5 57.1c-2 9.1-9 16.3-18.2 17.8c-13.8 2.3-28 3.5-42.5 3.5s-28.7-1.2-42.5-3.5c-9.2-1.5-16.2-8.7-18.2-17.8l-12.5-57.1c-15.8-6.5-30.6-15.1-44-25.4L83.1 425.9c-8.8 2.8-18.6 .3-24.5-6.8c-8.1-9.8-15.5-20.2-22.1-31.2l-4.7-8.1c-6.1-11-11.4-22.4-15.8-34.3c-3.2-8.7-.5-18.4 6.4-24.6l43.3-39.4C64.6 273.1 64 264.6 64 256s.6-17.1 1.7-25.4L22.4 191.2c-6.9-6.2-9.6-15.9-6.4-24.6c4.4-11.9 9.7-23.3 15.8-34.3l4.7-8.1c6.6-11 14-21.4 22.1-31.2c5.9-7.2 15.7-9.6 24.5-6.8l55.7 17.7c13.4-10.3 28.2-18.9 44-25.4l12.5-57.1c2-9.1 9-16.3 18.2-17.8C227.3 1.2 241.5 0 256 0s28.7 1.2 42.5 3.5c9.2 1.5 16.2 8.7 18.2 17.8l12.5 57.1c15.8 6.5 30.6 15.1 44 25.4l55.7-17.7c8.8-2.8 18.6-.3 24.5 6.8c8.1 9.8 15.5 20.2 22.1 31.2l4.7 8.1c6.1 11 11.4 22.4 15.8 34.3zM256 336a80 80 0 1 0 0-160 80 80 0 1 0 0 160z"})],-1)]),void 0,!0),_:1,__:[8]},8,["enabled-tooltip","aria-label","disabled-tooltip"])):x("",!0)])):x("",!0)}}),ui={class:"tw-relative tw-z-40 tw-w-64 tw-shrink-0 tw-basis-64 tw-border-r tw-border-neutral-300 tw-shadow-md","data-testid":"timeline-navigator"},mi={class:"tw-flex tw-h-14 tw-items-center tw-justify-between tw-border-b tw-border-neutral-300 tw-bg-white tw-px-4"},ci={class:"tw-font-bold tw-text-neutral-600","data-testid":"current-month-label"},wi={key:0},vi={class:"tw-relative"},pi=["onClick"],fi=["onClick"],hi={class:"tw-inline-flex tw-grow tw-items-center tw-space-x-2 tw-overflow-x-hidden tw-whitespace-nowrap tw-text-xs"},yi={class:"tw-grow tw-overflow-x-hidden tw-text-ellipsis tw-pl-3"},Ii=G({__name:"MEventTimelineNavigator",props:{visibleTimelineData:{},timelineFirstVisibleInstant:{},expandedSections:{},expandedGroups:{},selectedItemIds:{}},emits:{todayButtonClicked:()=>({type:"todayButtonClicked"}),sectionClicked:s=>({type:"sectionClicked",id:s}),groupClicked:s=>({type:"groupClicked",id:s}),invokeCommand:s=>({type:"command",command:s}),itemInspected:s=>({type:"itemInspected",id:s}),close:()=>({type:"close"})},setup(s,{emit:a}){const e=a,t=s,l=V(()=>t.visibleTimelineData===void 0?void 0:pe(t.visibleTimelineData.items));function o(v){return t.expandedGroups.includes(v)}function i(v){return t.expandedSections.includes(v)}function u(v){return t.selectedItemIds.includes(v)}function m(v){return oe.getAs(v,t.visibleTimelineData?.items).renderData.cannotRemoveReason??!0}function w(v){return we.getAs(v,t.visibleTimelineData?.items).renderData.cannotRemoveReason??!0}function f(v){return!le.getAs(v,t.visibleTimelineData?.items)?.isImmutable||"Cannot add to immutable section."}function h(v){const y={commandType:"createNewItem",itemType:"group",itemConfig:{},parentId:v,parentVersion:t.visibleTimelineData.items[v].version};e("invokeCommand",y)}function T(v){const{parentId:y,parentItem:g}=le.getParentAs(v,t.visibleTimelineData?.items),C={commandType:"deleteItems",items:[{targetId:v,currentVersion:t.visibleTimelineData.items[v].version,parentId:y,parentVersion:g.version}]};e("invokeCommand",C)}function S(v){return!oe.getAs(v,t.visibleTimelineData?.items)?.isImmutable||"Cannot add to immutable group."}function b(v){const y={commandType:"createNewItem",itemType:"row",itemConfig:{},parentId:v,parentVersion:t.visibleTimelineData.items[v].version};e("invokeCommand",y)}function p(v){const{parentId:y,parentItem:g}=oe.getParentAs(v,t.visibleTimelineData?.items),C={commandType:"deleteItems",items:[{targetId:v,currentVersion:t.visibleTimelineData.items[v].version,parentId:y,parentVersion:g.version}]};e("invokeCommand",C)}return(v,y)=>(n(),r("div",ui,[d("div",mi,[d("h2",ci,k(v.timelineFirstVisibleInstant?.toFormat("LLLL yyyy")),1)]),v.visibleTimelineData&&l.value?(n(),r("span",wi,[(n(!0),r(L,null,N(M(fe)(v.visibleTimelineData.items,l.value),([g,C])=>(n(),r("div",vi,[d("div",{class:"tw-group tw-flex tw-items-center tw-justify-between tw-space-x-2 tw-border-b tw-border-neutral-300 tw-pr-1",style:z({height:`${M(Ge)}rem`})},[d("div",{class:"tw-inline-flex tw-grow tw-cursor-pointer tw-select-none tw-items-center tw-space-x-2 tw-overflow-x-hidden tw-whitespace-nowrap tw-pl-3 tw-font-mono tw-text-xs",onClick:F=>v.$emit("sectionClicked",g)},[d("div",{class:ne(["tw-shrink-0",["tw-transition-transform",{"tw-rotate-90":i(g)}]])},y[6]||(y[6]=[d("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 320 512",class:"tw-size-3"},[d("path",{d:"M278.6 233.4c12.5 12.5 12.5 32.8 0 45.3l-160 160c-12.5 12.5-32.8 12.5-45.3 0s-12.5-32.8 0-45.3L210.7 256 73.4 118.6c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0l160 160z"})],-1)]),2),d("span",{class:ne(["tw-grow tw-content-center tw-overflow-x-hidden tw-text-ellipsis tw-transition-colors",{"tw-text-neutral-400":!i(g)}]),style:z({height:`${M(he)}rem`})},"// "+k(C.metadata.displayName),7)],8,pi),Z(De,{class:"tw-shrink-0",isLocked:!!v.visibleTimelineData.items[g].isImmutable,id:g,"allow-inspect":"","allow-add":f(g),"inspect-target-name":"section","add-target-name":"group",isSelected:u(g),onItemInspected:y[0]||(y[0]=F=>v.$emit("itemInspected",F)),onClose:y[1]||(y[1]=F=>v.$emit("close")),onAdd:()=>h(g)},null,8,["isLocked","id","allow-add","isSelected","onAdd"])],4),i(g)?(n(!0),r(L,{key:0},N(M(Re)(v.visibleTimelineData.items,C),([F,O])=>(n(),r("div",{class:ne(["tw-relative tw-select-none tw-text-nowrap odd:tw-bg-neutral-100 even:tw-bg-neutral-50",{"tw-border-l-4":!!O.metadata.color}]),style:z({borderLeftColor:O.metadata.color,backgroundColor:O.metadata.color?M(Ee)(M(xe)(O.metadata.color),.8):void 0})},[d("div",{class:ne(["tw-group tw-flex tw-cursor-pointer tw-items-center tw-space-x-2 tw-pr-1 hover:tw-backdrop-brightness-95 active:tw-backdrop-brightness-90",{"tw-pl-3":!!O.metadata.color,"tw-pl-4":!O.metadata.color}]),onClick:A=>v.$emit("groupClicked",F)},[d("div",hi,[d("div",{class:ne(["tw-shrink-0",["tw-transition-transform",{"tw-rotate-90":o(F)}]])},y[7]||(y[7]=[d("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 320 512",class:"tw-size-3"},[d("path",{d:"M278.6 233.4c12.5 12.5 12.5 32.8 0 45.3l-160 160c-12.5 12.5-32.8 12.5-45.3 0s-12.5-32.8 0-45.3L210.7 256 73.4 118.6c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0l160 160z"})],-1)]),2),d("span",{class:"tw-grow tw-content-center tw-overflow-x-hidden tw-text-ellipsis",style:z({height:`${M(he)}rem`})},k(O.metadata.displayName),5)]),Z(De,{class:"tw-shrink-0","is-locked":!!v.visibleTimelineData.items[F].isImmutable,id:F,"allow-inspect":"","allow-add":S(F),"allow-remove":m(F),"inspect-target-name":"group","add-target-name":"row","remove-target-name":"group","is-selected":u(F),onItemInspected:y[2]||(y[2]=A=>v.$emit("itemInspected",A)),onClose:y[3]||(y[3]=A=>v.$emit("close")),onAdd:()=>b(F),onRemove:()=>T(F)},null,8,["is-locked","id","allow-add","allow-remove","is-selected","onAdd","onRemove"])],10,fi),o(F)?(n(!0),r(L,{key:0},N(M(ge)(v.visibleTimelineData.items,O),([A,P])=>(n(),r("div",{class:"tw-group tw-flex tw-items-center tw-justify-between tw-space-x-2 tw-pr-1",style:z({height:`${M(Ae)}rem`})},[d("div",yi,k(P.metadata.displayName),1),Z(De,{class:"tw-shrink-0","is-locked":!!v.visibleTimelineData.items[A].isImmutable,id:A,"allow-inspect":"","allow-remove":w(A),"inspect-target-name":"row","remove-target-name":"row","is-selected":u(A),onItemInspected:y[4]||(y[4]=_=>v.$emit("itemInspected",_)),onClose:y[5]||(y[5]=_=>v.$emit("close")),onRemove:()=>p(A)},null,8,["is-locked","id","allow-remove","is-selected","onRemove"])],4))),256)):x("",!0)],6))),256)):x("",!0)]))),256))])):x("",!0)]))}});class bi{register(a,e){if(this.updateDataCallback??this.updateItemDetailsCallback)throw new Error("Register called twice");this.updateDataCallback=a,this.updateItemDetailsCallback=e}deregister(){if(!this.updateDataCallback||!this.updateItemDetailsCallback)throw new Error("Deregister called twice");this.updateDataCallback=void 0,this.updateItemDetailsCallback=void 0}updateDataCallback;updateItemDetailsCallback;setTimelineData(a){if(this.updateDataCallback)this.cachedTimelineData=Ve(a),this.updateDataCallback(this.cachedTimelineData);else throw new Error("No updateData callback was registered.")}updateItemData(a){if(console.assert(!!this.cachedTimelineData,"No timeline data exists to update!"),Object.keys(a).length>0){for(const[e,t]of Object.entries(a))t?this.cachedTimelineData.items[e]=Ve(t):delete this.cachedTimelineData.items[e];this.setTimelineData(this.cachedTimelineData)}}updateItemDetails(a){if(this.updateItemDetailsCallback)this.updateItemDetailsCallback(a);else throw new Error("No updateItemDetails callback was registered.")}cachedTimelineData}class Le{constructor(a,e,t,l){this.hasReceivedFirstRequest=!1,this.options={largestAllowedTotalWindowInDays:void 0,debounceTimeInMs:1e3,...l},a.register(e,t),this.fetchHandler=a,this.onUpdateItemDetails=t}options;fetchHandler;hasReceivedFirstRequest;onUpdateItemDetails;pollerId;nextRequestWindow;fetchedWindow;totalFetchedWindow;requestTimelineData(a,e,t,l){l??=!this.hasReceivedFirstRequest,this.hasReceivedFirstRequest=!0,this.nextRequestWindow={firstVisibleInstant:a,lastVisibleInstant:e,bufferInDays:t},clearTimeout(this.pollerId),l?this._requestTimelineData():this.pollerId=setTimeout(()=>{this._requestTimelineData()},this.options.debounceTimeInMs)}refreshTimelineData(a){this.totalFetchedWindow&&this.requestTimelineData(this.totalFetchedWindow.startInstant,this.totalFetchedWindow.endInstant,0,a)}requestItemDetails(a){this.onUpdateItemDetails(Object.fromEntries(a.map(e=>[e,void 0]))),this.fetchHandler.requestItemDetails(a)}_requestTimelineData(){if(!this.nextRequestWindow)throw new Error("Expected nextRequestWindow to be set.");const a=this.nextRequestWindow.firstVisibleInstant.minus({days:this.nextRequestWindow.bufferInDays}),e=this.nextRequestWindow.lastVisibleInstant.plus({days:this.nextRequestWindow.bufferInDays});if(!this.fetchedWindow||!Le.doesWindowContainQuery(this.fetchedWindow.startInstant,this.fetchedWindow.endInstant,a,e)){const l=a.minus({days:this.nextRequestWindow.bufferInDays}),o=e.plus({days:this.nextRequestWindow.bufferInDays}),i=o.diff(l).as("days"),u=this.totalFetchedWindow?.startInstant??l,m=this.totalFetchedWindow?.endInstant??o;let w=l<u?l:u,f=o>m?o:m;if(this.options.largestAllowedTotalWindowInDays!==void 0&&f.diff(w).as("days")>this.options.largestAllowedTotalWindowInDays)if(i>this.options.largestAllowedTotalWindowInDays)w=l,f=o,console.warn('"largestAllowedTotalWindowInDays" is not big enough to honour the request. Forcing request to be honoured.');else{let T=!1;if(l<u&&(f=w.plus({days:this.options.largestAllowedTotalWindowInDays}),T=!0),o&&(w=f.minus({days:this.options.largestAllowedTotalWindowInDays}),T=!0),!T)throw new Error("Not sure how we got here..")}this.fetchedWindow={startInstant:l,endInstant:o},this.totalFetchedWindow={startInstant:w,endInstant:f},this.fetchHandler.requestTimelineData(w,f)}this.nextRequestWindow=void 0}static doesWindowContainQuery(a,e,t,l){return t>a&&l<e}}const gi={key:0,class:"tw-rounded-lg tw-border tw-border-neutral-200 tw-bg-white tw-shadow tw-@container","data-testid":"timeline"},ki={class:"tw-px-4 tw-pb-2 tw-pt-3"},Ti={class:"tw-text-lg tw-font-bold tw-text-neutral-800"},Di={key:0,class:"tw-min-h-64 tw-content-center tw-border-t tw-border-neutral-300 tw-text-center tw-@container","data-testid":"loading-message"},Ci={key:1,class:"tw-min-h-64 tw-content-center tw-border-t tw-border-neutral-300 tw-text-center tw-@container","data-testid":"empty-message"},Si={key:2,class:"tw-flex tw-min-h-64 tw-border-t tw-border-neutral-300 tw-@container","data-testid":"timeline-container"},$i={key:0,class:"tw-space-y-2 tw-overflow-x-auto tw-bg-neutral-100 tw-p-2 tw-text-xs"},xi={key:0},Ei={key:1},Ri=G({__name:"MEventTimeline",props:{title:{default:"Timeline"},timelineDataFetchHandler:{},loadingError:{default:void 0},startExpanded:{type:Boolean},initialExpandedDataSources:{default:void 0},initialVisibleTimelineStartInstant:{default:void 0},initialZoomLevel:{default:void 0},preselectedItemId:{default:void 0},debug:{type:Boolean}},emits:["invokeCommand"],setup(s,{emit:a}){const e=s,t=a,l=W(),o=W(e.initialVisibleTimelineStartInstant??H.utc().minus({days:2})),i=W(),u=W(3);Y(()=>e.initialZoomLevel,I=>{I==="hours"?u.value=30:I==="days"?u.value=12:I==="weeks"?u.value=3:I==="months"?u.value=1:I==="years"&&(u.value=.1)},{immediate:!0});const m=V(()=>p.value?H.fromISO(p.value.startInstantIsoString,{zone:"utc"}):H.utc()),w=V(()=>p.value?H.fromISO(p.value.endInstantIsoString,{zone:"utc"}):H.utc()),f=W(28),h=V(()=>m.value.minus({days:f.value})),T=V(()=>w.value.plus({days:f.value})),S=V(()=>Math.ceil(T.value.diff(h.value,"days").days)),b=W(),p=W(),v=W({}),y=W(0),g=W(0),C=new Le(e.timelineDataFetchHandler,I=>{p.value=I,y.value++},I=>{v.value=I},{largestAllowedTotalWindowInDays:100,debounceTimeInMs:1e3});function F(I){C.requestTimelineData(I.startInstant,I.endInstant,I.bufferInDays)}function O(I){C.requestItemDetails(I)}const A=V(()=>({startInstant:o.value.startOf("day"),endInstant:(i.value??o.value.plus({days:8})).startOf("day"),bufferInDays:21}));Y(A,I=>{F(I)},{immediate:!0});const P=W([]),_=W([]);Y(p,(I,D)=>{if(I&&!D){if(Object.keys(I.items).length===0)return;if(e.initialExpandedDataSources?.length){const q=pe(I.items),se=fe(I.items,q);for(const[de,Me]of se)(Me.renderData.dataSources??[]).some(Ze=>e.initialExpandedDataSources?.includes(Ze))&&P.value.push(de)}else if(e.initialExpandedDataSources===void 0){const q=pe(I.items),se=fe(I.items,q);for(const[de,Me]of se)P.value.push(de)}e.startExpanded&&X()}},{immediate:!0});function c(I){return P.value.includes(I)}function U(I){return _.value.includes(I)}function $(I){c(I)?P.value=P.value.filter(D=>D!==I):P.value=[...P.value,I]}function R(I){U(I)?_.value=_.value.filter(D=>D!==I):_.value=[..._.value,I]}function X(){_.value=Object.entries(p.value?.items??{}).filter(([I,D])=>D?.itemType==="group").map(([I,D])=>I)}function K(){_.value=[]}Y([()=>p.value,i],([I,D])=>{!D||!I||(b.value=I)});const Q=W([]);Y(Q,(I,D)=>{I.join()!==D?.join()&&O(I)},{immediate:!0}),Y(()=>p.value,(I,D)=>{if(e.preselectedItemId&&I&&!D){const q=Array.isArray(e.preselectedItemId)?e.preselectedItemId:[e.preselectedItemId];Q.value=q.filter(se=>I.items[se])}},{immediate:!0});function ee(){Q.value=[]}const j=V(()=>{const I=Object.keys(v.value??{}),D={};return I.forEach(q=>{const se=p.value.items[q],de=v.value?.[q];D[q]={data:se,details:de}}),D});function te(I){t("invokeCommand",I)}return J(()=>{document.addEventListener("keydown",I=>{b.value&&(I.key==="o"&&I.ctrlKey&&(I.preventDefault(),X()),(I.key==="O"||I.key==="o")&&I.shiftKey&&I.ctrlKey&&(I.preventDefault(),K()))})}),(I,D)=>I.loadingError?(n(),E(ht,{key:1,error:I.loadingError},null,8,["error"])):(n(),r("div",gi,[d("div",ki,[d("div",Ti,k(I.title),1)]),d("div",null,[p.value?Object.keys(p.value.items).length===0?(n(),r("div",Ci,D[9]||(D[9]=[d("div",{class:"tw-p-4 tw-text-center tw-text-neutral-500"},"No events to display.",-1)]))):(n(),r("div",Si,[Z(Ii,{"visible-timeline-data":b.value,"expanded-sections":P.value,"expanded-groups":_.value,"timeline-first-visible-instant":o.value,"selected-item-ids":Q.value,onTodayButtonClicked:D[0]||(D[0]=q=>l.value?.scrollTimelineToToday()),onSectionClicked:$,onGroupClicked:R,onInvokeCommand:D[1]||(D[1]=q=>te(q)),onItemInspected:D[2]||(D[2]=q=>Q.value=[q]),onClose:ee},null,8,["visible-timeline-data","expanded-sections","expanded-groups","timeline-first-visible-instant","selected-item-ids"]),Z(fn,{ref_key:"timelineContentRef",ref:l,"visible-timeline-data":b.value,"timeline-start-instant":h.value,"timeline-end-instant":T.value,"timeline-length-in-days":S.value,"timeline-first-visible-instant":o.value,"number-of-timeline-buffer-days":f.value,"timeline-day-width-in-rem":u.value,"expanded-sections":P.value,"expanded-groups":_.value,"selected-item-ids":Q.value,"onUpdate:timelineFirstVisibleInstant":D[3]||(D[3]=q=>o.value=q),"onUpdate:timelineLastVisibleInstant":D[4]||(D[4]=q=>i.value=q),"onUpdate:timelineDayWidthInRem":D[5]||(D[5]=q=>u.value=q),onEventClicked:D[6]||(D[6]=q=>Q.value=[q])},null,8,["visible-timeline-data","timeline-start-instant","timeline-end-instant","timeline-length-in-days","timeline-first-visible-instant","number-of-timeline-buffer-days","timeline-day-width-in-rem","expanded-sections","expanded-groups","selected-item-ids"]),Z(li,{"selected-item-and-details":j.value,"visible-timeline-data":b.value,onClose:ee,onInvokeCommand:D[7]||(D[7]=q=>te(q))},null,8,["selected-item-and-details","visible-timeline-data"])])):(n(),r("div",Di,D[8]||(D[8]=[d("div",{class:"tw-animate-bounce tw-italic tw-text-neutral-500"},"Loading...",-1)])))]),e.debug?(n(),r("pre",$i,[D[17]||(D[17]=d("div",{class:"tw-font-bold"},"MEventTimeline Debug Info",-1)),d("div",null,[D[10]||(D[10]=d("div",{class:"tw-font-bold"},"TIMELINE",-1)),d("div",null,"Day width: "+k(u.value)+"rem",1),d("div",null,"First visible instant: "+k(o.value),1),d("div",null,"Last visible instant: "+k(i.value),1)]),d("div",null,[D[11]||(D[11]=d("div",{class:"tw-font-bold"},"TIMELINE DISPLAY OPTIONS",-1)),d("div",null,"Timeline start: "+k(h.value)+" ("+k(f.value)+" not fetched)",1),d("div",null,"Total days: "+k(S.value),1),d("div",null,"Timeline end: "+k(T.value)+" ("+k(f.value)+" not fetched)",1)]),d("div",null,[D[12]||(D[12]=d("div",{class:"tw-font-bold"},"VISIBLE RANGE (for data fetching)",-1)),d("div",null,"Data range to fetch start: "+k(A.value.startInstant),1),d("div",null,"Total days: "+k(A.value.endInstant.diff(A.value.startInstant,"days").days)+" days",1),d("div",null,"Data range to fetch end: "+k(A.value.endInstant),1)]),p.value?(n(),r("div",xi,[D[13]||(D[13]=d("div",{class:"tw-font-bold"},"FETCHED DATA",-1)),d("div",null,"Data start: "+k(p.value.startInstantIsoString),1),d("div",null,"Total days: "+k(M(H).fromISO(p.value.endInstantIsoString).diff(M(H).fromISO(p.value.startInstantIsoString),"days").days)+" days",1),d("div",null,"Data end: "+k(p.value.endInstantIsoString),1)])):(n(),r("div",Ei,D[14]||(D[14]=[d("div",{class:"tw-font-bold"},"FETCHED DATA",-1),d("div",null,"Empty",-1)]))),d("div",null,[D[15]||(D[15]=d("div",{class:"tw-font-bold"},"DATA FETCH COUNT",-1)),d("pre",null,"Data fetches completed: "+k(y.value),1),d("pre",null,"Item detail fetches completed: "+k(g.value),1)]),d("div",null,[D[16]||(D[16]=d("div",{class:"tw-font-bold"},"SELECTED ITEM",-1)),d("div",null,"Selected items: "+k(Q.value.join(", ")||"none"),1)])])):x("",!0)]))}}),zi=G({__name:"GameServerEventTimeline",props:{preselectedItemId:{default:void 0},initialVisibleTimelineStartInstant:{default:void 0},initialZoomLevel:{default:void 0},startExpanded:{type:Boolean},dataSources:{default:()=>yt()},initialExpandedDataSources:{default:void 0}},setup(s){const a=s,e=It();class t extends bi{requestTimelineData(w,f,h){if(this.initialFetchCancelTokenSource&&this.initialFetchCancelTokenSource.cancel(),this.cancelPoll(),l.value)return;this.firstInstant=w,this.lastInstant=f,this.initialFetchCancelTokenSource=ae.CancelToken.source();const T=new URLSearchParams;T.append("firstInstant",w.toISO()??"??"),T.append("lastInstant",f.toISO()??"??"),a.dataSources.forEach(S=>{T.append("dataSource",S)}),e.request({method:"GET",url:"liveOpsTimelineData",params:T,cancelToken:this.initialFetchCancelTokenSource.token}).then(S=>{this.initialFetchCancelTokenSource=void 0,this.unsubscribeFromUpdates(),this.setTimelineData(S.data.timelineData),this.continuationCursor=S.data.updateCursor,l.value?this.unsubscribeFromUpdates():this.pollForUpdates(),h?.()}).catch(S=>{if(!(ae.isAxiosError(S)&&ae.isCancel(S)))throw S instanceof Error?S:new Error("Unknown error")})}requestItemDetails(w){if(!this.continuationCursor){this.updateItemDetails({});return}const f={cursor:this.continuationCursor,itemIds:w};e.post("liveOpsTimelineItemDetails",f).then(h=>{h.data.isSuccess?this.updateItemDetails(h.data.items):this.triggerFullRefreshNow(()=>{this.requestItemDetails(w)})})}triggerFullRefreshNow(w){this.firstInstant&&this.lastInstant&&this.requestTimelineData(this.firstInstant,this.lastInstant,w)}triggerUpdatePollNow(){this.pollForUpdates()}pollForUpdates(){this.cancelPoll(),!l.value&&(this.updateCancelTokenSource=ae.CancelToken.source(),e.post("getLiveOpsTimelineDataUpdates",{cursor:this.continuationCursor},{cancelToken:this.updateCancelTokenSource.token}).then(w=>{this.updateCancelTokenSource=void 0,w.data.isSuccess?(Object.keys(w.data.itemUpdates).length&&this.updateItemData(w.data.itemUpdates),this.continuationCursor=w.data.continuationCursor,this.updatePollId=setTimeout(()=>{this.pollForUpdates()},2e3)):this.triggerFullRefreshNow()}).catch(w=>{if(!(ae.isAxiosError(w)&&ae.isCancel(w)))throw w instanceof Error?w:new Error("Unknown error")}))}cancelPoll(){this.updatePollId&&(clearTimeout(this.updatePollId),this.updatePollId=void 0),this.updateCancelTokenSource&&(this.updateCancelTokenSource.cancel(),this.updateCancelTokenSource=void 0)}unsubscribeFromUpdates(){this.continuationCursor&&(e.post("unsubscribeLiveOpsTimelineDataUpdates",{cursor:this.continuationCursor},{adapter:"fetch",fetchOptions:{keepalive:!0}}),this.continuationCursor=void 0)}firstInstant;lastInstant;continuationCursor;initialFetchCancelTokenSource;updateCancelTokenSource;updatePollId}const l=W(!1);function o(){i.cancelPoll(),i.unsubscribeFromUpdates(),l.value=!0}be(()=>{o()}),window.addEventListener("beforeunload",()=>{o()});const i=new t;async function u(m){const w={command:m};await e.post("invokeLiveOpsTimelineCommand",w),i.triggerUpdatePollNow()}return(m,w)=>(n(),E(M(Ri),{"timeline-data-fetch-handler":M(i),"initial-visible-timeline-start-instant":m.initialVisibleTimelineStartInstant,"initial-zoom-level":m.initialZoomLevel,"preselected-item-id":m.preselectedItemId,"start-expanded":m.startExpanded,"initial-expanded-data-sources":m.initialExpandedDataSources||m.dataSources,debug:!1,onInvokeCommand:u},null,8,["timeline-data-fetch-handler","initial-visible-timeline-start-instant","initial-zoom-level","preselected-item-id","start-expanded","initial-expanded-data-sources"]))}});export{zi as _};
