import{d as E,bz as M,c as y,E as N,D as d,r as S,e as k,o as v,w as r,j as s,f as a,x as I,k as c,q as u,t as p,ad as _,ae as T,a as h,y as b,_ as V}from"./index-DAyiym1a.js";import{M as n,a as o,b as F,c as g}from"./metaListUtils-B-xQ0HnD.js";import{_ as q}from"./BroadcastFormButton.vue_vue_type_script_setup_true_lang-CqsvBia4.js";import{g as z}from"./broadcasts-D7Wj3d2J.js";import{M as P}from"./MSingleColumnLayout-CUJDqBPP.js";import{_ as j}from"./MRawDataCard.vue_vue_type_script_setup_true_lang-Q1r46_CP.js";import{_ as K,a as W}from"./MViewContainer.vue_vue_type_script_setup_true_lang-DP4T6epC.js";import"./MetaGeneratedForm.vue_vue_type_script_setup_true_lang-DdaVgxEJ.js";import"./GeneratedUiFormDynamicComponent.vue_vue_type_script_setup_true_lang-BiTvhFwY.js";import"./MInputMultiSelectCheckbox.vue_vue_type_script_setup_true_lang-D6xsoOzq.js";import"./MInputCheckbox.vue_vue_type_script_setup_true_lang-CmGaUCkv.js";import"./MInputHintMessage.vue_vue_type_script_setup_true_lang-B7AbTbVm.js";import"./MInputSingleSelectDropdown.vue_vue_type_script_setup_true_lang-BRIBVSuX.js";import"./PlayerSegmentsInput.vue_vue_type_script_setup_true_lang-D-tzace6.js";import"./actionDebouncer-D31HA7Ay.js";import"./numberUtils-CkF0oMe2.js";import"./MInputToggleGroup.vue_vue_type_script_setup_true_lang-C2tbFKS_.js";import"./MInputSwitch.vue_vue_type_script_setup_true_lang-BI0IeYnL.js";import"./MInputSingleSelectSwitch.vue_vue_type_script_setup_true_lang-dEvjQEX9.js";import"./index-TQG-La0y.js";import"./MInputTextArea.vue_vue_type_script_setup_true_lang-Dxjs9C9J.js";import"./debounce-CRuraxcR.js";import"./isSymbol-BXvDeGRF.js";import"./analyticsEvents-BaCdc4qs.js";import"./MActionModalButton.vue_vue_type_script_setup_true_lang-CRnsCPt_.js";import"./MActionModal.vue_vue_type_script_setup_true_lang-XDUxofmt.js";import"./index-CVSO09yM.js";import"./MInputText.vue_vue_type_script_setup_true_lang-B9sf9LSD.js";import"./MInputDateTime.vue_vue_type_script_setup_true_lang-BaxH1mqp.js";import"./index-Byt7eTSs.js";import"./MInputDurationOrEndDateTime.vue_vue_type_script_setup_true_lang-9GyCRKjG.js";import"./MInputDuration.vue_vue_type_script_setup_true_lang-BgwwwskG.js";import"./MInputNumber.vue_vue_type_script_setup_true_lang-qrqxgTEu.js";const G={class:"tw-text-xs+ tw-font-normal tw-text-neutral-500"},H={key:0},J={key:1},Ot=E({__name:"BroadcastListView",setup(Q){const A=M(),x=y(()=>A.path),{data:f,error:B,refresh:C}=N(z()),w=y(()=>{if(!f.value)return;const t=d.utc();return f.value.map(e=>{const m=d.fromISO(e.params.startAt),l=d.fromISO(e.params.endAt);return l>t&&m<t?{...e,decoration:{status:"Active",variant:"success",icon:"broadcast-tower"}}:l>t?{...e,decoration:{status:"Scheduled",variant:"primary",icon:"calendar-alt"}}:{...e,decoration:{status:"Expired",variant:"neutral",icon:"times"}}})}),D=[new n("Time","params.startAt",o.Ascending),new n("Time","params.startAt",o.Descending),new n("Name","params.name",o.Ascending),new n("Name","params.name",o.Descending),new n("Received by","stats.receivedCount",o.Ascending),new n("Received by","stats.receivedCount",o.Descending)],$=[new F("status",[new g("Scheduled",t=>t.decoration.status==="Scheduled"),new g("Active",t=>t.decoration.status==="Active"),new g("Expired",t=>t.decoration.status==="Expired")])];function O(t){return t.params.id}function L(t){const e=x.value,m=e.endsWith("/")?"":"/";return e+m+t}function R(t){if(t.isTargeted){if(t.targetPlayers?.length&&t.targetCondition)return`Segment based and ${_(t.targetPlayers.length,"player",!0)}`;if(t.targetPlayers?.length)return _(t.targetPlayers.length,"player",!0);if(t.targetCondition)return"Segment based"}else return"everyone"}return(t,e)=>{const m=S("fa-icon"),l=S("meta-list-card");return v(),k(a(W),{permission:"api.broadcasts.view","is-loading":!a(f),error:a(B)},{overview:r(()=>[s(a(K),{title:"Create a New Broadcast","data-testid":"broadcast-list-overview-card"},{buttons:r(()=>[s(q,{class:"mr-2 tw-mt-1","button-text":"Create New","button-icon":"plus-square",onRefresh:a(C),"data-testid":"create-new-broadcast"},null,8,["onRefresh"])]),default:r(()=>[e[0]||(e[0]=u("p",{class:"tw-mb-1"},"Broadcasts are scheduled in-game mail campaigns.",-1)),e[1]||(e[1]=u("div",{class:"small text-muted"},"Players who match the targeting criteria of an active broadcast will get an in-game mail generated into their inbox when they login. A player can receive every broadcast only once to prevent duplicate mails.",-1))],void 0,!0),_:1,__:[0,1]})]),default:r(()=>[s(a(P),null,{default:r(()=>[s(l,{id:"broadcasts-list",title:"All broadcasts",getItemKey:O,itemList:w.value,searchFields:["params.id","params.name"],filterSets:$,sortOptions:D,defaultSortOption:1,pageSize:20,icon:"broadcast-tower","data-testid":"all-broadcasts-list-card"},{"item-card":r(i=>[s(a(I),null,{"top-right":r(()=>[s(a(V),{variant:i.item.decoration.variant},{icon:r(()=>[s(m,{icon:i.item.decoration.icon},null,8,["icon"])]),default:r(()=>[c(p(i.item.decoration.status),1)],void 0,!0),_:2},1032,["variant"])]),"bottom-left":r(()=>[i.item.decoration.status==="Scheduled"?(v(),h("div",H,[e[2]||(e[2]=c("Start time: ",-1)),s(a(b),{instant:a(d).fromISO(i.item.params.startAt)},null,8,["instant"])])):(v(),h("div",J,[e[3]||(e[3]=c("End time: ",-1)),s(a(b),{instant:a(d).fromISO(i.item.params.endAt)},null,8,["instant"])]))]),"bottom-right":r(()=>[u("div",null,"Received by "+p(a(_)(i.item.stats.receivedCount,"player",!0)),1),s(a(T),{to:L(i.item.params.id),"data-testid":`view-broadcast-${i.item.params.name}`},{default:r(()=>e[4]||(e[4]=[c("View broadcast",-1)]),void 0,!0),_:2,__:[4]},1032,["to","data-testid"])]),default:r(()=>[c(p(i.item.params.name)+" ",1),u("span",G,"for "+p(R(i.item.params)),1)],void 0,!0),_:2},1024)]),_:1},8,["itemList"])],void 0,!0),_:1}),s(a(j),{data:w.value,label:"decoratedBroadcasts"},null,8,["data"])],void 0,!0),_:1},8,["is-loading","error"])}}});export{Ot as default};
