import{d as M,E,h as f,c as D,r as u,e as v,o as r,w as n,j as s,f as i,s as V,q as d,t as l,x as q,I as B,k as o,a as m,m as g,y as h,D as y,U as S,bE as L,_ as R,bs as U,bt as O,bg as P}from"./index-DAyiym1a.js";import{g as F}from"./scanJobs-D3C2dgHD.js";import{_ as G}from"./MAbbreviateNumber.vue_vue_type_script_setup_true_lang-D1qNvv8f.js";import{_ as H}from"./MActionModal.vue_vue_type_script_setup_true_lang-XDUxofmt.js";import"./numberUtils-CkF0oMe2.js";import"./index-CVSO09yM.js";const K={class:"tw-space-x-0.5"},W={key:0},z={key:0},Q={key:1},X={class:"code-box border rounded bg-light"},Y={key:0},Z={key:1},ee=M({__name:"ActiveScanJobsCard",setup(te){const{data:p,refresh:C}=E(F()),b=f(),j=U(),k=D(()=>{const a=p.value.activeJobs,t=p.value.upcomingJobs;return a.concat(t)});function w(a){return a.phase==="Paused"?"danger":a.phase==="Running"?"success":a.phase==="Enqueued"?"warning":a.phase==="Scheduled"?"primary":"neutral"}const{showSuccessNotification:x}=O(),c=f();async function J(){const a=(await j.put(`/databaseScanJobs/${c.value.id}/cancel`)).data;x(a.message),C()}function T(a){c.value=a,b.value?.open(a)}function $(a){return a.id}return(a,t)=>{const _=u("fa-icon"),A=u("meta-no-seatbelts"),I=u("meta-list-card");return r(),v(I,{icon:"business-time",title:"Active Scan Jobs",itemList:k.value,getItemKey:$,emptyMessage:"No active scan jobs.","data-testid":"active-scan-jobs-card"},{"item-card":n(e=>[s(i(V),{extraMListItemMargin:"","data-testid":"scan-jobs-entry"},{header:n(()=>[s(i(q),{noLeftPadding:""},B({"top-right":n(()=>[d("span",K,[s(i(S),{content:e.item.canCancel&&!c.value?"Cancel this scan job.":void 0,"no-underline":""},{default:n(()=>[s(i(L),{variant:"danger","disabled-tooltip":e.item.cannotCancelReason,permission:"api.scan_jobs.manage","aria-label":"Cancel this scan job.",onClick:N=>T(e.item),"data-testid":`cancel-${e.item.jobTitle}-button`},{default:n(()=>[s(_,{icon:"trash-alt"})],void 0,!0),_:2},1032,["disabled-tooltip","onClick","data-testid"])],void 0,!0),_:2},1032,["content"]),e.item.anyWorkersFailed?(r(),v(i(S),{key:0,class:"mr-2 text-danger",content:"Some workers failed during this job.",noUnderline:""},{default:n(()=>[s(_,{icon:"triangle-exclamation"})],void 0,!0),_:1})):g("",!0),s(i(R),{variant:w(e.item)},{default:n(()=>[o(l(e.item.phase),1)],void 0,!0),_:2},1032,["variant"])])]),"bottom-left":n(()=>[e.item.phaseCategory==="Upcoming"?(r(),m("div",W,[o(l(e.item.jobDescription),1),e.item.startTime?(r(),m("div",z,[t[1]||(t[1]=o("Scheduled to start ",-1)),s(i(h),{instant:i(y).fromISO(e.item.startTime)},null,8,["instant"]),t[2]||(t[2]=o(".",-1))])):g("",!0)])):(r(),m("div",Q,[t[3]||(t[3]=o("Started ",-1)),s(i(h),{instant:i(y).fromISO(e.item.startTime)},null,8,["instant"]),t[4]||(t[4]=o(".",-1))]))]),default:n(()=>[o(l(e.item.jobTitle),1)],void 0,!0),_:2},[e.item.phaseCategory==="Active"?{name:"bottom-right",fn:n(()=>[d("div",null,[t[5]||(t[5]=o("Items scanned: ",-1)),s(i(G),{number:e.item.scanStatistics.numItemsScanned},null,8,["number"])]),d("div",null,"Progress: "+l(Math.round(e.item.scanStatistics.scannedRatioEstimate*1e4)/100)+"%",1)]),key:"0"}:void 0]),1024)]),default:n(()=>[d("pre",X,l(e.item),1)],void 0,!0),_:2},1024),s(i(H),{ref_key:"cancelScanJobsModal",ref:b,title:`Cancel ${c.value?.jobTitle}`,action:J,onHidden:t[0]||(t[0]=N=>c.value=null),"data-testid":"cancel-scan-job-modal"},{default:n(()=>[c.value.phaseCategory==="Upcoming"?(r(),m("div",Y,t[6]||(t[6]=[d("p",null,"This job has not yet been started. Cancelling an upcoming job will delete it, and it will not appear in the job history list.",-1),d("p",{class:"tw-mt-2 tw-text-xs+ tw-text-neutral-500"},"Note: The job may already be in progress by the time the request is processed.",-1)]))):(r(),m("p",Z,"This job has been started and may already have executed partially. Cancelling an active job will terminate it as soon as possible and move it into the job history list.")),s(A,{class:"tw-mt-2",message:"Are you sure you want to cancel this scan job?"})],void 0,!0),_:1},8,["title"])]),_:1},8,["itemList"])}}}),ce=P(ee,[["__scopeId","data-v-b0afb327"]]);export{ce as default};
