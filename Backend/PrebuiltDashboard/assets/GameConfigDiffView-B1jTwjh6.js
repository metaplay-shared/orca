import{d as A,E as I,c9 as j,c as S,a as x,o as g,q as p,m as E,t as D,k as L,j as d,f as i,D as M,y as P,h as y,cc as B,cd as z,K as q,e as k,w as v,c6 as K,ce as Q,bz as H,af as J,cf as W,cg as R,ch as X,r as Y,ae as T,bE as Z,bt as ee}from"./index-DAyiym1a.js";import{g as te,_ as ae}from"./ConfigContentsCard.vue_vue_type_script_setup_true_lang-edmOVM7O.js";import{_ as V}from"./MInputCheckbox.vue_vue_type_script_setup_true_lang-CmGaUCkv.js";import{C as oe}from"./CoreUiPlacement-Q0Nbc6Vr.js";import{_ as ie,a as ne}from"./MViewContainer.vue_vue_type_script_setup_true_lang-DP4T6epC.js";import{_ as U}from"./MInputSingleSelectDropdown.vue_vue_type_script_setup_true_lang-BRIBVSuX.js";import"./MInputHintMessage.vue_vue_type_script_setup_true_lang-B7AbTbVm.js";const se={class:"tw-py-1"},re={class:"tw-font-semibold"},le={class:"tw-text-xs"},ue={key:0,class:"tw-text-xs"},F=A({__name:"GameConfigSelectOption",props:{gameConfigId:{}},setup(G){const n=G,{data:C}=I(j()),c=S(()=>(C.value??[]).find(f=>f.id===n.gameConfigId));return(f,o)=>(g(),x("div",se,[p("p",re,D(c.value?.name||"No Name Available"),1),p("p",le,D(f.gameConfigId),1),c.value?(g(),x("p",ue,[o[0]||(o[0]=L("Built ",-1)),d(i(P),{instant:i(M).fromISO(c.value?.buildStartedAt),"disable-tooltip":""},null,8,["instant"])])):E("",!0)]))}}),h={None:1,Added:2,Modified:4,Removed:8},de={key:0},ce={key:1},fe={class:"tw-text-left sm:tw-flex sm:tw-flex-row"},me={key:0},ve=A({__name:"DiffConfigContentsCard",props:{gameConfigId:{default:"$active"},otherGameConfigId:{default:"$active"},excludeServerLibraries:{type:Boolean}},setup(G){const n=G,C=y(!0),c=y(!0),f=y(!0),o=S(()=>{let e=0;return C.value&&(e|=h.Added),c.value&&(e|=h.Removed),f.value&&(e|=h.Modified),e}),r=I(()=>B(n.gameConfigId)),b=I(()=>B(n.otherGameConfigId)),_=I(()=>z(n.gameConfigId,n.otherGameConfigId,o.value)),O=S(()=>{if(!_.isLoading.value)try{const e=_.data.value?.libraryImportErrors??r.data.value?.libraryImportErrors;let t={...r.data.value?.contents?.sharedLibraries};n.excludeServerLibraries||(t={...t,...r.data.value?.contents?.serverLibraries}),b.data.value!==void 0&&(t={...t,...b.data.value.contents?.sharedLibraries},n.excludeServerLibraries||(t={...t,...b.data.value.contents?.serverLibraries}));const a=Object.keys(t).sort((u,$)=>u.localeCompare($)).filter(u=>e?.[u]===void 0).map(u=>({id:u,numTopLevelItems:_.data.value?.libraries[u]?.count??0,changeType:_.data.value?.libraries[u]?.changeType??"None"}));return e&&Object.entries(e).forEach(([u,$])=>{a.push({id:u,error:te($),changeType:"None"})}),a.sort((u,$)=>u.id.localeCompare($.id))}catch(e){return e instanceof Error?e:new Error("Unknown error")}}),m={};function N(e){return e in m||(m[e]=y({configItems:null,error:void 0}),s(e)),m[e]}q([()=>n.gameConfigId,()=>n.otherGameConfigId,()=>o.value],()=>{for(const e in m)if(Object.prototype.hasOwnProperty.call(m,e)){const t=m[e];t.value.configItems=null,s(e)}});async function s(e){const t=m[e];try{const a=o.value,u=await K(Q(n.gameConfigId,n.otherGameConfigId,e,o.value));if(a!==o.value)return;t.value.configItems=u.config[e]?.children??[],t.value.error=u.libraryImportErrors?.[e]}catch(a){a instanceof Error?t.value.error=a:t.value.error=new Error("Unknown error: "+String(a))}}function l(){return O}const w=S(()=>[{title:"Other",description:n.otherGameConfigId??""}]);return(e,t)=>(g(),k(ae,{"additional-columns":w.value,"baseline-column":{title:"Baseline",description:e.gameConfigId},"fetch-library-overview":l,"fetch-library":N,"hide-no-diffs":!0,"show-detailed-diff-badge":!0,error:i(r).error.value??i(b).error.value??i(_).error.value},{"no-results":v(()=>[o.value!=(i(h).Added|i(h).Modified|i(h).Removed)?(g(),x("span",de,"The selected game configs are identical, or your filter options are too restrictive.")):(g(),x("span",ce,"The selected game configs are identical."))]),"header-right":v(()=>[p("div",fe,[d(i(V),{"model-value":C.value,description:"Added","onUpdate:modelValue":t[0]||(t[0]=a=>C.value=a)},null,8,["model-value"]),d(i(V),{"model-value":c.value,description:"Removed","onUpdate:modelValue":t[1]||(t[1]=a=>c.value=a)},null,8,["model-value"]),d(i(V),{"model-value":f.value,description:"Modified","onUpdate:modelValue":t[2]||(t[2]=a=>f.value=a)},null,8,["model-value"])])]),value:v(a=>[a.key.description!==void 0&&a.item.values!==void 0&&a.key.description in a.item.values?(g(),x("span",me,D(a.item.values[a.key.description]),1)):E("",!0)]),_:1},8,["additional-columns","baseline-column","error"]))}}),ge={class:"tw-flex tw-flex-col tw-items-center tw-justify-between @lg:tw-flex-row"},pe={class:"tw-w-full"},Ce={class:"text-right tw-w-full tw-text-xs"},_e={class:"tw-w-full"},we={class:"text-right tw-w-full tw-text-xs"},Ge=A({__name:"GameConfigDiffView",setup(G){const n=H(),C=J(),{data:c}=I(W()),{data:f}=I(j()),o=y(R(n.query,"baselineRoot")),r=y(R(n.query,"newRoot"));q([o,r],()=>{b()}),X(()=>{c.value&&(o.value??=c.value,r.value??=c.value)});function b(){const l=(n.path+`?baselineRoot=${o.value}&newRoot=${r.value}`).split("?"),w=l[0],e=Object.fromEntries(l[1].split("&").map(t=>t.split("=")));C.replace({path:w,query:e}).catch(t=>{if(t instanceof Error&&t.name!=="NavigationDuplicated")throw Error(t.message)})}const{showSuccessNotification:_}=ee();function O(){const s=o.value;o.value=r.value,r.value=s,_("Configs swapped.")}const m=S(()=>N.value.map(s=>{const l=f.value?.find(w=>w.id===s);return{label:`${s} - ${l?.name||"No Name Available"}`,value:s}})),N=S(()=>(f.value??[]).filter(s=>s.bestEffortStatus==="Success"&&(!s.isArchived||s.id===o.value||s.id===r.value)).map(s=>s.id));return(s,l)=>{const w=Y("fa-icon");return g(),k(i(ne),{permission:"api.game_config.view","is-loading":!i(c)||!i(f),"full-width-overview":""},{overview:v(()=>[d(i(ie),{title:"Compare Game Config Versions",subtitle:"View differences between two game config versions."},{default:v(()=>[p("div",ge,[p("div",pe,[d(i(U),{label:"Baseline Game Config","model-value":o.value,options:m.value,"onUpdate:modelValue":l[0]||(l[0]=e=>o.value=e)},{option:v(({option:e})=>[e.value?(g(),k(F,{key:0,gameConfigId:e.value},null,8,["gameConfigId"])):E("",!0)]),_:1},8,["model-value","options"]),p("div",Ce,[d(i(T),{to:`/gameConfigs/${o.value}`},{default:v(()=>l[2]||(l[2]=[L("View baseline game config",-1)]),void 0,!0),_:1,__:[2]},8,["to"])])]),d(i(Z),{class:"tw-m-4","aria-label":"Swap the baseline and new game configs.",onClick:O},{default:v(()=>[d(w,{icon:"right-left"})],void 0,!0),_:1}),p("div",_e,[d(i(U),{label:"New Game Config","model-value":r.value,options:m.value,"onUpdate:modelValue":l[1]||(l[1]=e=>r.value=e)},{option:v(({option:e})=>[e.value?(g(),k(F,{key:0,gameConfigId:e.value},null,8,["gameConfigId"])):E("",!0)]),_:1},8,["model-value","options"]),p("div",we,[d(i(T),{to:`/gameConfigs/${r.value}`},{default:v(()=>l[3]||(l[3]=[L("View new game config",-1)]),void 0,!0),_:1,__:[3]},8,["to"])])])])],void 0,!0),_:1})]),default:v(()=>[d(oe,{placementId:"GameConfig/Diff"}),d(ve,{"game-config-id":o.value,"other-game-config-id":r.value},null,8,["game-config-id","other-game-config-id"])],void 0,!0),_:1},8,["is-loading"])}}});export{Ge as default};
