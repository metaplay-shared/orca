import{d as R,E as k,h as M,c as I,i as q,e as V,o as v,f as r,ae as j,w as n,k as o,j as f,t as l,a as w,q as u,_ as $,bs as U,bt as G,K,c6 as z,r as D,m as O,x as H,U as J}from"./index-DAyiym1a.js";import{M as P,a as E,b as Q,c as B}from"./metaListUtils-B-xQ0HnD.js";import{e as C,c as L,d as X}from"./utils-DSYdgMhH.js";import{g as Y,a as Z}from"./experiments-B0m-qIFs.js";import{a as F}from"./players-CkgXyjra.js";import{_ as ee}from"./MActionModal.vue_vue_type_script_setup_true_lang-XDUxofmt.js";import"./index-CVSO09yM.js";const te={key:0},ae={class:"tw-font-semibold"},ie={key:1},se={class:"tw-font-semibold"},re=R({__name:"PlayerActionSetTester",props:{playerId:{},experimentId:{},experimentName:{}},setup(_){const p=_,b=U(),{data:i,refresh:T}=k(F(p.playerId)),m=M(!1),h=M(),c=I(()=>{if(i)return i.value.experiments[p.experimentId]});q(()=>{m.value=c.value?.isPlayerTester??!1}),I(()=>m.value?`${i.value.model.playerName} is now a tester in ${p.experimentId}`:`${i.value.model.playerName} is no longer a tester in ${p.experimentId}`);const{showSuccessNotification:S}=G();async function N(){m.value=!m.value;let d;m.value?d=`${i.value.model.playerName} is now a tester in ${p.experimentId}`:d=`${i.value.model.playerName} is no longer a tester in ${p.experimentId}`,await b.post(`/players/${i.value.id}/changeExperiment`,{ExperimentId:p.experimentId,VariantId:c.value.enrolledVariant,IsTester:m.value}),S(d),T()}return(d,t)=>(v(),V(r(j),{"trigger-button-disabled-tooltip":r(i)?"":"Waiting for player data..",variant:c.value.isPlayerTester?"warning":void 0,"confirm-permission":"api.players.edit_experiment_groups",onClick:t[0]||(t[0]=A=>h.value?.open()),"data-testid":`set-action-tester-${d.experimentId}`},{default:n(()=>[o(l(c.value.isPlayerTester?"Remove as tester":"Mark as tester"),1),f(r(ee),{ref_key:"setTesterModal",ref:h,title:"Manage Tester Status",action:N,"ok-button-label":c.value.isPlayerTester?"Remove as Tester":"Mark as Tester","data-testid":`set-action-tester-modal-${d.experimentId}`},{default:n(()=>[m.value?(v(),w("div",te,[u("span",null,[f(r($),null,{default:n(()=>[o(l(r(i).model.playerName),1)],void 0,!0),_:1}),t[1]||(t[1]=o(" is currently a ",-1)),t[2]||(t[2]=u("span",{class:"tw-font-semibold"},"tester",-1)),t[3]||(t[3]=o(" in the ",-1)),u("span",ae,l(d.experimentName),1),t[4]||(t[4]=o(" experiment.",-1))])])):(v(),w("div",ie,[u("span",null,[f(r($),null,{default:n(()=>[o(l(r(i).model.playerName),1)],void 0,!0),_:1}),t[5]||(t[5]=o(" is currently ",-1)),t[6]||(t[6]=u("span",{class:"tw-font-semibold"},"not a tester",-1)),t[7]||(t[7]=o(" in the ",-1)),u("span",se,l(d.experimentName),1),t[8]||(t[8]=o(" experiment.",-1))])])),t[9]||(t[9]=u("div",{class:"tw-mt-3 tw-text-xs+ tw-text-neutral-500"},"As a tester, the player will be able to try out the experiment before it is enabled for everyone. This is a great way to test variants before rolling them out.",-1))],void 0,!0),_:1,__:[9]},8,["ok-button-label","data-testid"])],void 0,!0),_:1},8,["trigger-button-disabled-tooltip","variant","data-testid"]))}}),ne={key:0},oe={key:1},le={class:"tw-mr-1"},de={key:2},pe={class:"tw-flex tw-flex-col"},ge=R({__name:"PlayerExperimentsCard",props:{playerId:{type:String,required:!0}},setup(_){const p=_,{data:b}=k(Y()),{data:i}=k(F(p.playerId)),T=I(()=>{if(S.value===0)return`${i.value.model.playerName||"n/a"} isn't involved in any experiments.`}),m=[new Q("isPlayerEnrolled",[new B("Player is Enrolled",s=>s.isPlayerEnrolled,!0),new B("Player is Not Enrolled",s=>!s.isPlayerEnrolled,!1)])],h=["experimentId","variantId","description"],c=[new P("Name","experimentId",E.Ascending),new P("Name","experimentId",E.Descending),new P("Phase","experimentPhase",E.Ascending),new P("Phase","experimentPhase",E.Descending)],S=I(()=>!b.value?.experiments||!i.value?.experiments?0:N.value.filter(s=>s.isPlayerEnrolled).length),N=I(()=>b.value?.experiments?i.value?.experiments?Object.entries(i.value.experiments).map(([s,e])=>{const x=(b.value?.experiments??[]).find(W=>W.experimentId===s);let y,a,g;return e.isPlayerEnrolled?e.experimentPhase!=="Ongoing"?(y=e.experimentPhase,a=C(e.experimentPhase),g="neutral"):e.whyNotActive==null?(y="Active",a=C("Active"),g="success"):(y="Interrupted",a=L(e.whyNotActive),g="warning"):e.whyNotEligible!==null?(y="Ineligible",a=X(e.whyNotEligible),g="neutral"):(y="Eligible",a=L(e.whyNotActive??"PlayerIsNotEnrolled"),g="neutral"),{experimentId:s,name:x?.displayName??"",description:x?.description??"",variantId:e.enrolledVariant,isTester:e.isPlayerTester,isPlayerEnrolled:e.isPlayerEnrolled,displayPhase:y,phaseBadgeTooltip:a,phaseBadgeVariant:g}}):[]:[]),d=I(()=>i.value?.experiments?Object.entries(i.value.experiments).filter(([s,e])=>e.isPlayerEnrolled).map(([s,e])=>s):[]),t=M({});K(d,s=>{s.forEach(e=>{z(Z(e)).then(x=>{t.value[e]=x})})},{immediate:!0});function A(s,e){return t.value[s]?.state.variants[e]?.isDisabledByAdmin??!1}return(s,e)=>{const x=D("fa-icon"),y=D("meta-list-card");return r(i)?(v(),V(y,{key:0,title:"Experiments",icon:"flask",tooltip:`Shows experiments that this ${r(i).model.playerName||"n/a"} belongs to.`,itemList:N.value,searchFields:h,filterSets:m,sortOptions:c,emptyMessage:`${r(i).model.playerName||"n/a"} isn't involved in any experiments.`,noResultsMessage:T.value,moreInfoUri:"/experiments",moreInfoLabel:"experiments",moreInfoPermission:"api.experiments.view",permission:"api.experiments.view","data-testid":"player-experiments-card"},{"item-card":n(({item:a})=>[f(r(H),null,{badge:n(()=>[a.isTester?(v(),V(r($),{key:0},{default:n(()=>e[0]||(e[0]=[o("Tester",-1)]),void 0,!0),_:1,__:[0]})):O("",!0)]),"top-right":n(()=>[f(r($),{tooltip:a.phaseBadgeTooltip,variant:a.phaseBadgeVariant},{default:n(()=>[o(l(a.displayPhase),1)],void 0,!0),_:2},1032,["tooltip","variant"])]),"bottom-left":n(()=>[o(l(a.description),1)]),"bottom-right":n(()=>[a.variantId?A(a.experimentId,a.variantId)?(v(),w("div",oe,[f(r(J),{class:"tw-text-red-500",content:"This variant has been disabled"},{default:n(()=>[u("span",le,"Variant: "+l(a.variantId),1),f(x,{icon:"triangle-exclamation"})],void 0,!0),_:2},1024)])):(v(),w("div",de,"Variant: "+l(a.variantId),1)):(v(),w("div",ne,"Variant: Control")),u("div",pe,[f(re,{playerId:_.playerId,experimentId:a.experimentId,experimentName:a.name},null,8,["playerId","experimentId","experimentName"]),f(r(j),{to:`/experiments/${a.experimentId}`},{default:n(()=>e[1]||(e[1]=[o("View experiment",-1)]),void 0,!0),_:2,__:[1]},1032,["to"])])]),default:n(()=>[o(l(a.name)+" / "+l(a.experimentId),1)],void 0,!0),_:2},1024)]),_:1},8,["tooltip","itemList","emptyMessage","noResultsMessage"])):O("",!0)}}});export{ge as default};
