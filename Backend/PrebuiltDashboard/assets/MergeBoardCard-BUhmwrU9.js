import{d as F,E as R,a3 as P,c as x,h as K,K as Q,e as U,o as r,w as h,q as l,a as o,F as C,b as B,Q as T,j as y,f as _,U as S,k as $,t as g,m as M,bj as J,ah as W}from"./index-DAyiym1a.js";import{g as X}from"./localization-DDIHoN6I.js";import{a as Y}from"./players-CkgXyjra.js";const Z={class:"tw-flex"},tt={class:"tw-mb-4 tw-flex tw-w-1/4 tw-flex-col"},et=["onClick"],at=["src"],nt={class:"tw-mx-1 tw-overflow-hidden tw-text-ellipsis tw-whitespace-nowrap tw-text-xs"},rt={class:"tw-text-xs"},ot={class:"tw-flex tw-flex-col tw-gap-1"},st={key:0,class:"tw-grid tw-grid-cols-7 tw-overflow-hidden tw-rounded tw-border tw-border-neutral-300 tw-bg-[]",style:{"background-color":"hsl(206, 64%, 33%)"}},lt=["src","alt"],it=["src","alt"],dt={class:"tw-flex tw-w-full tw-rounded tw-border tw-border-neutral-300 tw-bg-neutral-100 tw-px-1"},ct={key:0},ut={key:1,class:"tw-italic tw-text-neutral-400"},gt={key:0},wt={key:0,class:"tw-mr-1"},vt={key:1,class:"tw-italic tw-text-neutral-400"},mt={key:0},pt={key:0,class:"tw-mr-1"},ft={key:1,class:"tw-italic tw-text-neutral-400"},It=F({__name:"MergeBoardCard",props:{playerId:{}},setup(H){const z=H,{data:k}=R(()=>P(["Chains","Islands","IslandTasks"])),{data:v}=R(()=>X("$active")),{data:b}=R(()=>Y(z.playerId)),D=x(()=>{if(b.value){const e=b.value.model.islands;return Object.keys(e).map(a=>({info:e[a].info,state:e[a].state,image:`/Islands/${e[a].info}.png`}))}else return}),d=K();Q(b,e=>{e&&!d.value&&(d.value=e.model.lastIsland)},{immediate:!0});const m=x(()=>{if(b.value&&d.value)return b.value.model.islands[d.value]}),i=x(()=>{if(m.value!==void 0&&m.value?.tasks?.tasks!==void 0)for(const e in m.value?.tasks.tasks){const a=m.value?.tasks.tasks[e];if(a!==void 0)return k.value?.gameConfig.IslandTasks[e+":"+a.info.level]}}),L=x(()=>{if(!d.value||!k.value)return;const e=k.value.gameConfig.Islands[d.value].boardPattern,a=e.width,t=e.height,w=[];for(let s=t-1;s>=0;s--)for(let n=0;n<a;n++){const c=s*a+n,u=e.map[c];w.push(u)}const I=w.map((s,n)=>{const c=n%a,u=t-1-Math.floor(n/a),p=E(c,u),f=k.value?.gameConfig.Chains[`${p?.info.type}:${p?.info.level}`],N=s==="ItemHolder"||s==="Ship",A=(c^u)&1?"/Board/MergeGrid.png":"/Board/MergeGridAlternative.png";return{backgroundImage:s==="Ground"?A:void 0,tileType:s,nonItemTile:N,itemType:p?.info.type,itemLevel:p?.info.level,itemImage:O(s,p),itemHidden:!p?.isDiscovered,gridColStart:c+1,gridColSpan:f?.width||(N?2:1),gridRowStart:t-u,gridRowSpan:f?.height||1,itemMergeEventScore:f?.mergeEventScore,itemTargetIsland:f?.targetIsland,scale:f?.width>1||f?.height>1?1.015:1.03}});for(let s=0;s<I.length;++s){const n=I[s];if(n&&(n.gridColSpan>1||n.gridRowSpan>1)){for(let c=0;c<n.gridColSpan;++c)for(let u=0;u<n.gridRowSpan;++u)I[s+c-u*a]=void 0;n.gridRowStart-=n.gridRowSpan-1,I[s-(n.gridRowSpan-1)*a]=n,n.gridColSpan===2&&n.gridRowSpan===2?n.backgroundImage=n.backgroundImage==="/Board/MergeGrid.png"?"/Board/MergeGrid2x2Alternative.png":"/Board/MergeGrid2x2.png":n.gridColSpan===1&&n.gridRowSpan===2&&(n.backgroundImage=n.backgroundImage==="/Board/MergeGrid.png"?"/Board/MergeGrid1x2Alternative.png":"/Board/MergeGrid1x2.png")}}return I.filter(s=>s!==void 0)});function O(e,a){return e==="ItemHolder"?"/Board/Dock.png":e==="Ship"?"/Board/Ship.png":a?`/Board/Chains/${a.info.type+a.info.level}.png`:"/Board/Blank256x256.png"}function E(e,a){if(m.value?.mergeBoard?.items)return m.value.mergeBoard.items.find(t=>t.x===e&&t.y===a)}function q(e){return e.nonItemTile?`Type: ${e.tileType}`:e.itemType?`Type: ${e.itemType}
Level: ${e.itemLevel}
Merge Event Score: ${e.itemMergeEventScore}`:void 0}function V(e){return v.value?.locs.en.translations["Island."+e]?v.value.locs.en.translations["Island."+e]:e}function j(e){return v.value?.locs.en.translations["Hero."+e]?v.value.locs.en.translations["Hero."+e]:e}function G(e){return v.value?.locs.en.translations["Chain."+e]?v.value.locs.en.translations["Chain."+e]:e}return(e,a)=>(r(),U(_(W),{title:"Merge Boards",subtitle:"View details of the islands that the player has access to. Select an island to view its merge board."},{default:h(()=>[l("div",Z,[l("div",tt,[(r(!0),o(C,null,B(D.value,t=>(r(),o("div",{class:T(["tw-mb-1 tw-mr-1 tw-aspect-square tw-w-[5rem] tw-select-none tw-content-center tw-rounded tw-border tw-border-neutral-300 tw-text-center",{"hover:tw-brightness-90 active:tw-brightness-75 tw-cursor-pointer":t.state==="Open","tw-bg-neutral-600 tw-text-neutral-100":t.state==="Hidden"||t.state==="Revealing","tw-bg-blue-500 tw-text-white":d.value===t.info,"tw-bg-neutral-100":t.state==="Open"&&d.value!==t.info}]),key:t.info,onClick:w=>t.state==="Open"?d.value=t.info:void 0},[l("img",{class:T(["tw-pointer-events-none tw-mx-auto tw-size-7/12",{"tw-opacity-50 tw-saturate-0":t.state==="Hidden","tw-opacity-80 tw-saturate-0":t.state==="Locked"}]),src:t.image},null,10,at),l("div",nt,[y(_(S),{content:`IslandInfo: ${t.info}`},{default:h(()=>[$(g(V(t.info)),1)],void 0,!0),_:2},1032,["content"])]),l("div",rt,g(t.state),1)],10,et))),128))]),l("div",ot,[L.value?(r(),o("div",st,[(r(!0),o(C,null,B(L.value,t=>(r(),o("div",{class:"tw-relative tw-content-center tw-overflow-hidden tw-bg-cover tw-bg-center",style:J({scale:t.scale,backgroundImage:`url(${t.backgroundImage})`,gridColumn:`${t.gridColStart} / ${t.gridColStart+t.gridColSpan}`,gridRow:`${t.gridRowStart} / ${t.gridRowStart+t.gridRowSpan}`})},[y(_(S),{content:q(t)},{default:h(()=>[t.nonItemTile?(r(),o("img",{key:1,class:"tw-my-[-25%] tw-scale-[60%] tw-opacity-50",src:t.itemImage,alt:t.itemType,draggable:!1},null,8,it)):(r(),o("img",{key:0,class:T(["tw-scale-[80%] tw-transform tw-transition-transform hover:tw-scale-95",{"tw-opacity-50 tw-saturate-0":t.itemHidden}]),src:t.itemImage,alt:t.itemType,draggable:!1},null,10,lt))],void 0,!0),_:2},1032,["content"])],4))),256))])):M("",!0),l("div",dt,[l("table",null,[l("tbody",null,[l("tr",null,[a[0]||(a[0]=l("td",{class:"tw-align-top"},"Current Task:",-1)),i.value?(r(),o("td",ct,[y(_(S),{content:`Current Islander: ${i.value.islander}
Task ID: ${i.value.id}`},{default:h(()=>[$(g(j(i.value.islander))+":"+g(i.value.id),1)],void 0,!0),_:1},8,["content"])])):(r(),o("td",ut,"No task available"))]),l("tr",null,[a[1]||(a[1]=l("td",{class:"tw-align-top"},"Requirements:",-1)),i.value?(r(),o("td",gt,[(r(!0),o(C,null,B(i.value.items,(t,w)=>(r(),o("span",null,[y(_(S),{content:`Requirement Type: ${t.type}
Level: ${t.level}
Count: ${t.count}`},{default:h(()=>[$(g(G(t.type))+":"+g(t.level)+" x"+g(t.count),1)],void 0,!0),_:2},1032,["content"]),w<i.value.items.length-1?(r(),o("span",wt,",")):M("",!0)]))),256))])):(r(),o("td",vt,"No requirements"))]),l("tr",null,[a[2]||(a[2]=l("td",{class:"tw-align-top"},"Rewards:",-1)),i.value&&i.value.rewardItems.length!=0?(r(),o("td",mt,[(r(!0),o(C,null,B(i.value.rewardItems,(t,w)=>(r(),o("span",null,[y(_(S),{content:`Reward Type: ${t.type}
Count: ${t.count}`},{default:h(()=>[$(g(G(t.type))+" x"+g(t.count),1)],void 0,!0),_:2},1032,["content"]),w<i.value.rewardItems.length-1?(r(),o("span",pt,",")):M("",!0)]))),256))])):(r(),o("div",ft,"No reward"))])])])])])])],void 0,!0),_:1}))}});export{It as default};
