import{d as S,E,h as D,c as N,r as b,a as d,o as n,j as e,w as p,q as l,e as P,k as s,f as a,_ as y,t as f,bk as O,m as $,a6 as z,bs as A,by as I}from"./index-DAyiym1a.js";import{r as B}from"./utils-DSYdgMhH.js";import{a as C}from"./players-CkgXyjra.js";import{_ as c}from"./MAbbreviateNumber.vue_vue_type_script_setup_true_lang-D1qNvv8f.js";import{_ as V}from"./MActionModalButton.vue_vue_type_script_setup_true_lang-CRnsCPt_.js";const j={class:"tw-mb-1"},F={class:"tw-mb-1"},J={key:0},L={class:"code-box tw-h-[10rem] tw-text-wrap tw-rounded-md tw-border tw-border-neutral-200 tw-bg-neutral-100 tw-text-neutral-600"},T={key:0,"data-testid":"export-payload"},Y={key:1},q={key:0,class:"tw-mb-4 tw-mt-2 tw-w-full tw-text-right tw-text-xs tw-text-neutral-500"},v=3e5,R=S({__name:"PlayerActionExport",props:{playerId:{},allowDebugExport:{type:Boolean}},setup(x){const u=x,g=A(),{data:m}=E(C(u.playerId)),o=D(),w=N(()=>B(o.value));async function _(){o.value=void 0;const r={player:[u.playerId]};m.value?.guild&&(r.guild=[m.value.guild.id]);const t={entities:r,allowExportOnFailure:u.allowDebugExport};o.value=JSON.stringify((await g.post("/entityArchive/export",t)).data)}function k(){const r=`${u.playerId.replace(":","_")}.export`;I(o.value,r)}return(r,t)=>{const i=b("b-skeleton"),h=b("fa-icon");return n(),d("div",null,[e(a(V),{"trigger-button-disabled-tooltip":a(m)?"":"Waiting for player data..","modal-title":"Export Player",action:k,"trigger-button-label":"Export Player",variant:"danger","ok-button-label":"Download","ok-button-disabled-tooltip":o.value?void 0:"No data to export.","disable-safety-lock":"",permission:"api.entity_archive.export",onShow:t[0]||(t[0]=G=>_()),"data-testid":"export-player"},{default:p(()=>[l("p",j,[t[2]||(t[2]=s("This is the persisted player data for ",-1)),e(a(y),null,{default:p(()=>[s(f(a(m)?.model.playerName||"n/a"),1)],void 0,!0),_:1}),t[3]||(t[3]=s(" as an ",-1)),e(a(y),null,{default:p(()=>t[1]||(t[1]=[s("entity archive",-1)]),void 0,!0),_:1,__:[1]}),t[4]||(t[4]=s(". You can use it for raw debugging as well as copying players between deployments.",-1))]),t[10]||(t[10]=l("p",{class:"tw-mb-4 tw-text-sm tw-text-neutral-500"},"Please note that you are taking a copy of a player's personally identifiable information (PII) and you should only do this if you have a legitimate reason or the player's consent.",-1)),l("h6",F,[t[5]||(t[5]=s("Serialized Player Data",-1)),e(a(O),{class:"tw-ml-1",contents:o.value,disabled:w.value>=v,"data-testid":"copy-player-to-clipboard"},null,8,["contents","disabled"])]),w.value<v?(n(),d("div",J,[l("pre",L,[o.value?(n(),d("span",T,f(o.value),1)):(n(),d("span",Y,[e(i,{width:"85%"}),e(i,{width:"55%"}),e(i,{width:"70%"}),e(i,{class:"tw-mt-4",width:"80%"}),e(i,{width:"65%"})]))]),o.value?(n(),d("div",q,[t[6]||(t[6]=l("span",null,"Export archive size: ",-1)),e(a(c),{number:w.value},null,8,["number"])])):$("",!0)])):(n(),P(a(z),{key:1,title:"Export Preview Disabled"},{default:p(()=>[l("p",null,[t[7]||(t[7]=s("Export preview and copying disabled because of its large size of ",-1)),e(a(c),{number:w.value},null,8,["number"]),t[8]||(t[8]=s("b! You can still download the data 👍",-1))]),t[9]||(t[9]=l("p",{class:"tw-text-sm tw-text-orange-800"},"Some OS & browser combinations are known to have performance issues parsing large blobs of data. Let us know if you are one of them and we'll figure it out!",-1))],void 0,!0),_:1,__:[9]}))]),"ok-button-icon":p(()=>[e(h,{class:"tw-mb-[0.05rem] tw-h-3.5 tw-w-4",icon:"file-download"})]),_:1},8,["trigger-button-disabled-tooltip","ok-button-disabled-tooltip"])])}}});export{R as _};
