import{d as A,E as N,c as y,ab as M,r as h,e as k,m as c,f as a,o as s,w as n,j as i,x as T,k as d,t as l,a as m,B as F,A as U,ae as O,q as _,y as V,D as B}from"./index-DAyiym1a.js";import{M as w,a as g,b as C}from"./metaListUtils-B-xQ0HnD.js";import{b as E,i as K}from"./utils-DSYdgMhH.js";import{a as P}from"./players-CkgXyjra.js";import{_ as q}from"./MCountryCode.vue_vue_type_script_setup_true_lang-BXb2nCN7.js";import{_ as G}from"./MIpAddress.vue_vue_type_script_setup_true_lang-BHYz5nAk.js";const H={class:"tw-mt-0.5 tw-text-xs+ tw-text-neutral-500"},j={key:0},z={key:1},J={key:0},Q={key:1},R=1,oe=A({__name:"PlayerLoginHistoryCard",props:{playerId:{}},setup(b){const v=b,{data:S}=N(P(v.playerId)),p=y(()=>S.value.model.loginHistory.map(t=>({...t,countryName:t.location?K(t.location.country.isoCode):"Unknown",countryFlag:t.location?E(t.location.country.isoCode):void 0}))),r=M(),x=y(()=>!!r.environmentInfo.grafanaUri);function I(t){if(r.environmentInfo.grafanaUri){const o=new Date(t.timestamp),u=new Date(+o+15*6e4),f=r.environmentInfo.kubernetesNamespace?`,namespace=\\"${r.environmentInfo.kubernetesNamespace}\\"`:"";return`${r.environmentInfo.grafanaUri}/explore?orgId=1&left={"datasource": "Loki", "queries":[{"expr":"{app=\\"metaplay-server\\"${f}} |= \\"${v.playerId}\\""}],"range":{"from":"${+o-3e3}","to":"${+u+3e3}"}}`}else return}const D=["deviceModel","countryName","countryFlag"],L=[new w("Time","timestamp",g.Ascending),new w("Time","timestamp",g.Descending)],$=y(()=>[C.asDynamicFilterSet(p.value,"device-model",t=>t.deviceModel),C.asDynamicFilterSet(p.value,"country-name",t=>t.countryName)]);return(t,o)=>{const u=h("fa-icon"),f=h("meta-list-card");return a(S)?(s(),k(f,{key:0,title:"Latest Logins",icon:"clipboard-list",tooltip:"Shows 20 latest logins and their source.",itemList:p.value,searchFields:D,filterSets:$.value,sortOptions:L,defaultSortOption:R,emptyMessage:"No logins yet!","data-testid":"player-login-history-card"},{"item-card":n(({item:e})=>[i(a(T),null,{badge:n(()=>[_("span",H,"(client "+l(e.clientVersion)+")",1)]),"top-right":n(()=>[i(a(V),{instant:a(B).fromISO(e.timestamp),showAs:"relativeSentenceCase"},null,8,["instant"])]),"bottom-left":n(()=>[_("div",null,[e.authenticationKey?(s(),m("span",j,"Authentication: "+l(e.authenticationKey.platform==="DeviceId"?"Client token":e.authenticationKey.platform),1)):c("",!0),e.ipAddress?(s(),m("span",z,[o[0]||(o[0]=d("| IP: ",-1)),i(a(G),{"ip-address":e.ipAddress},null,8,["ip-address"])])):c("",!0)]),_("div",null,"OS: "+l(e.operatingSystem??"Unknown"),1)]),"bottom-right":n(()=>[e.sessionLengthApprox?(s(),m("div",J,[o[1]||(o[1]=d("Session length: ",-1)),i(a(F),{duration:a(U)(e.sessionLengthApprox),showAs:"exactDuration",hideMilliseconds:""},null,8,["duration"])])):(s(),m("div",Q,"Session length: Unknown")),i(a(O),{permission:"dashboard.grafana.view","disabled-tooltip":x.value?void 0:"Grafana is not configured for this environment",to:I(e)},{default:n(()=>[i(u,{class:"tw-mr-1",icon:"external-link-alt",size:"sm"}),o[2]||(o[2]=d(" View logs",-1))],void 0,!0),_:2,__:[2]},1032,["disabled-tooltip","to"])]),default:n(()=>[e.location?(s(),k(a(q),{key:0,isoCode:e.location.country.isoCode},null,8,["isoCode"])):c("",!0),d(" "+l(e.deviceModel),1)],void 0,!0),_:2},1024)]),_:1},8,["itemList","filterSets"])):c("",!0)}}});export{oe as default};
