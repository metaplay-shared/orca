import{d as we,h as o,K as ce,bs as ye,r as Ue,e as R,o as v,f as a,w as r,j as i,x as Ne,a as h,t as D,_ as xe,k as z,q as N,by as Be,af as Ae,E as be,c as $,dN as Q,b7 as Fe,dz as U,z as C,n as S,F as Re,bj as ze,m as K,D as E,bt as He,dO as je}from"./index-DAyiym1a.js";import We from"./MetaListCard-CjpVaEvN.js";import{d as qe}from"./debounce-CRuraxcR.js";import{_ as Se}from"./MActionModalButton.vue_vue_type_script_setup_true_lang-CRnsCPt_.js";import{_ as Ee}from"./MInputTextArea.vue_vue_type_script_setup_true_lang-Dxjs9C9J.js";import{m as Ge}from"./actionDebouncer-D31HA7Ay.js";import{m as Je}from"./axiosActionHandler-C84uzh5g.js";import{a as Ke,b as Xe}from"./liveOpsEvents-CrjtIbOt.js";import{_ as Ze}from"./MetaGeneratedForm.vue_vue_type_script_setup_true_lang-DdaVgxEJ.js";import{_ as Qe}from"./PlayerSegmentsInput.vue_vue_type_script_setup_true_lang-D-tzace6.js";import{_ as de}from"./MInputSingleSelectDropdown.vue_vue_type_script_setup_true_lang-BRIBVSuX.js";import{_ as Ye}from"./MInputText.vue_vue_type_script_setup_true_lang-B9sf9LSD.js";import{_ as X}from"./MInputHintMessage.vue_vue_type_script_setup_true_lang-B7AbTbVm.js";import{_ as et}from"./MInputSingleSelectSwitch.vue_vue_type_script_setup_true_lang-dEvjQEX9.js";import{_ as ve}from"./MInputDuration.vue_vue_type_script_setup_true_lang-BgwwwskG.js";import{_ as he}from"./MInputDateTime.vue_vue_type_script_setup_true_lang-BaxH1mqp.js";import{_ as tt}from"./MInputToggleGroup.vue_vue_type_script_setup_true_lang-C2tbFKS_.js";const lt={key:0},at={key:1},ot={key:0},nt={key:1},Pt=we({__name:"LiveOpsEventActionExport",props:{prefillText:{}},setup(Y){const ee=ye(),te=Y,c=o(""),A=o(),T=o([]),d=o("Enter IDs of the LiveOps events to export.");function le(p){H(p),d.value="Validating IDs.",T.value=void 0}const H=qe(p=>{c.value=p},300);ce(c,async p=>{const s=p.split(/,+/).map(m=>m.trim()).filter(m=>m!=="");await j(s)});async function j(p){if(p.length===0)T.value=[],d.value="Enter IDs to export.";else{T.value=void 0;const s={eventIds:p},m=(await ee.post("/exportLiveOpsEvents",s)).data;m.isValid?(T.value=m.eventResults,A.value=m.package,d.value=void 0):(T.value=m.eventResults.sort((u,q)=>u.isValid===q.isValid?0:u.isValid?1:-1),d.value="Review the ID errors to enable download.")}}function ae(){Be(A.value,"live-ops-event.export")}function I(){c.value=te.prefillText??""}function W(){T.value=[],A.value=void 0,c.value=""}return(p,s)=>{const m=Ue("fa-icon");return v(),R(a(Se),{"modal-title":"Export LiveOps Events",action:ae,"trigger-button-label":"Export","ok-button-label":"Download","ok-button-disabled-tooltip":d.value,"disable-safety-lock":"",permission:"api.liveops_events.export","trigger-button-full-width":"",onShow:I,onHide:W},{default:r(()=>[s[1]||(s[1]=N("div",{class:"tw-mb-3 tw-text-sm"},"Enter the IDs of the LiveOps Events you want to export in to the text area below.",-1)),i(a(Ee),{"model-value":c.value,rows:5,placeholder:`Comma separated list of IDs:
03cf3f5a4e5cca0-0-c3be913379de7a6a, 03cf3f7539b7cd0-0-a33bcde46cabb06e, ...`,"onUpdate:modelValue":s[0]||(s[0]=u=>le(u))},null,8,["model-value"])]),"right-panel":r(()=>[i(a(We),{title:"Export Preview","item-list":T.value,"page-size":4,"empty-message":"No events available to preview yet.",dangerous:!!d.value},{"item-card":r(({item:u})=>[i(a(Ne),null,{"bottom-left":r(()=>[z(D(u.eventId),1)]),"top-right":r(()=>[i(a(xe),{variant:u.isValid?"success":"danger"},{default:r(()=>[u.isValid?(v(),h("span",ot,"Event Found")):(v(),h("span",nt,"Error"))],void 0,!0),_:2},1032,["variant"])]),default:r(()=>[u.isValid?(v(),h("span",lt,D(u.eventInfo?.displayName),1)):(v(),h("span",at,D(u.error),1))],void 0,!0),_:2},1024)]),_:1},8,["item-list","dangerous"])]),"ok-button-icon":r(()=>[i(m,{class:"tw-mb-[0.05rem] tw-h-3.5 tw-w-4",icon:"file-download"})]),_:1},8,["ok-button-disabled-tooltip"])}}}),it={key:0},st={key:1},ut={class:"tw-flex tw-items-center"},rt={key:1,class:"tw-h-4 tw-w-4 tw-rounded tw-border tw-border-neutral-300",style:{background:"linear-gradient(to bottom right, white, white 45%, red 45%, red 55%, white 55%, white)"}},dt={class:"tw-ml-1"},vt={key:0},ct={class:"tw-flex tw-items-center tw-justify-between"},mt={key:1,class:"tw-rounded-md tw-border tw-border-neutral-200 tw-bg-neutral-100 tw-p-3 tw-text-neutral-500"},pt=500,Vt=we({__name:"LiveOpsEventFormModalButton",props:{formMode:{},prefillData:{default:void 0},eventId:{default:void 0}},setup(Y){const ee=ye(),te=Ae(),c=Y,{data:A}=be(Ke()),{refresh:T}=be(Xe()),d=o(""),le=$(()=>d.value.split(",")[0]),H=$(()=>A.value?.find(e=>e.contentClass===d.value)),j=$(()=>A.value?.map(e=>({label:e.eventTypeName,value:e.contentClass}))??[]);function ae(){I.value=W.value[0]?.value}const I=o(""),W=$(()=>Object.keys(H.value?.templates??{}).map(e=>({label:e,value:e}))),p=$(()=>H.value?.templates[I.value]);ce(()=>p.value,e=>{e?(x.value=e.content,J.value=!0):(x.value=void 0,J.value=!1),c.formMode==="create"&&((!m.value||!s.value)&&(s.value=e?.defaultDisplayName??""),(!q.value||!u.value)&&(u.value=e?.defaultDescription??""))});const s=o(""),m=o(!1),u=o(""),q=o(!1),G=o(Q.Metaplay),me=o(!1),De=Object.entries(Q).map(([e,t])=>({label:e,value:t})),x=o(),J=o(),F=o(!1),f=o("utc"),Te=[{label:"UTC",value:"utc"},{label:"Player local",value:"local"}],g=o(),w=o(),Ie=$(()=>{if(g.value&&w.value)return w.value.diff(g.value,["days","hours","minutes"])}),L=o(),oe=o(!0),M=o(),ne=o(!0),P=o(),ie=o(!0),_=o({targetPlayers:[],targetCondition:null,valid:!0}),se=$(()=>{const e={create:{modalTitle:"Create New LiveOps Event",triggerButtonLabel:"New LiveOps Event",okButtonLabel:"Create Event"},edit:{modalTitle:"Edit LiveOps Event",triggerButtonLabel:"Edit",okButtonLabel:"Save Changes"},duplicate:{modalTitle:"Duplicate LiveOps Event",triggerButtonLabel:"Duplicate",okButtonLabel:"Create Duplicate"}};if(c.formMode in e)return e[c.formMode];throw new Error(`Invalid form mode: ${c.formMode}`)});function _e(){let e;c.prefillData?e=U(c.prefillData):e={displayName:"",description:"",color:null,eventType:"",templateId:"",content:{},useSchedule:!1,schedule:null,targetPlayers:[],targetCondition:null},c.formMode==="duplicate"&&(e.displayName+=" (copy)"),$e(e),c.formMode==="create"&&j.value.length>0&&pe(j.value[0].value)}const ue=o([]),B=o();function n(e){const t=Object.keys(B?.value??{});if(t.includes(e)){const l={Error:0,Warning:1,Uneditable:2,Info:3},b=B.value[e].sort((k,re)=>l[k.level]-l[re.level])[0],O=b.level==="Uneditable";return{hintMessage:b.message??void 0,disabled:O,disabledTooltip:O?b.message??"Disabled":void 0,variant:b.level==="Error"?"danger":void 0}}else{const l=e.split(".");for(;l.pop();){const y=l.slice(0).join("."),b=t.filter(O=>O===y);if(b.length){const k=B.value[b[0]].some(re=>re.level==="Uneditable");return{disabled:k,disabledTooltip:k?"Disabled":void 0}}}}return{}}function V(e,t){const l=B.value?.[e];if(l){for(const y of l)if(y.level===t)return y.message??void 0}}function pe(e){d.value=e,ae()}function Oe(e){s.value=e,m.value=!0}function ke(e){u.value=e,q.value=!0}function Ce(e){G.value=e??Q.Metaplay,me.value=!0}const Z=o(),Le=$(()=>{if(Z.value===void 0)return"Validating...";if(!d.value||!s.value||!oe.value||!ne.value||!ie.value)return"Fill in the required fields to proceed.";if(!Z.value)return"Server validation failed. Check that you have filled in all required fields correctly.";if(!J.value)return"The event content is invalid. Check that it is filled in correctly to proceed.";if(!_.value.valid)return"The audience targeting is invalid. Check that it is filled in correctly to proceed."});ce([d,I,s,u,G,x,F,f,g,w,L,oe,M,ne,P,ie,_],()=>{fe(c.formMode,!0)},{deep:!0});const{showSuccessNotification:Me,showErrorNotification:Pe}=He();async function fe(e,t){Z.value=void 0,ue.value=[],B.value=void 0;let l,y,b,O;switch(e){case"create":case"duplicate":l="/createLiveOpsEvent",y={validateOnly:t,parameters:ge()},b=`New ${s.value} event created.`,O="Failed to create event!";break;case"edit":if(!Fe().doesHavePermission("api.liveops_events.edit"))return;l="/updateLiveOpsEvent",y={validateOnly:t,occurrenceId:c.eventId,parameters:ge()},b=`${s.value} event updated.`,O="Failed to update event!";break}if(t)Ve.requestAction({url:l,method:"post",data:y});else{const k=(await ee.post(l,y)).data;k.isValid?(Me(b),e==="duplicate"&&await te.push(`/liveOpsEvents/${k.eventId}`)):Pe(O),ue.value=k.relatedEvents,B.value=k.diagnostics,T()}}const Ve=Ge(Je(),e=>{const t=e.data;ue.value=t.relatedEvents,B.value=t.diagnostics,Z.value=t.isValid},()=>{},pt);function $e(e){d.value=e.eventType,I.value="",s.value=e.displayName,m.value=!1,u.value=e.description,q.value=!1,G.value=e.color?je(e.color):Q.Metaplay,me.value=!1,x.value=U(e.content),J.value=!0,F.value=e.useSchedule,e.schedule?(f.value=e.schedule.isPlayerLocalTime?"local":"utc",g.value=e.schedule.enabledStartTime===""?E.utc().startOf("minute"):E.fromISO(e.schedule.enabledStartTime).toUTC(),w.value=e.schedule.enabledEndTime===""?E.utc().startOf("minute").plus({days:1}):E.fromISO(e.schedule.enabledEndTime).toUTC(),L.value=C.fromISO(e.schedule.previewDuration).toMillis()===0?void 0:C.fromISO(e.schedule.previewDuration),M.value=C.fromISO(e.schedule.endingSoonDuration).toMillis()===0?void 0:C.fromISO(e.schedule.endingSoonDuration),P.value=C.fromISO(e.schedule.reviewDuration).toMillis()===0?void 0:C.fromISO(e.schedule.reviewDuration)):(f.value="utc",g.value=E.utc().startOf("minute"),w.value=E.utc().startOf("minute").plus({days:1}),L.value=void 0,M.value=void 0,P.value=void 0),_.value={targetPlayers:U(e.targetPlayers)??[],targetCondition:U(e.targetCondition),valid:!0}}function ge(){const e={eventType:d.value,templateId:I.value,displayName:s.value,description:u.value,color:G.value??null,content:U(x.value??{}),useSchedule:F.value,schedule:null,targetPlayers:_.value.valid?U(_.value.targetPlayers):[],targetCondition:_.value.valid?U(_.value.targetCondition):null};return e.useSchedule&&(e.schedule={isPlayerLocalTime:f.value==="local",enabledStartTime:g.value?.toISO()??"",enabledEndTime:w.value?.toISO()??"",previewDuration:L.value?.toISO()??C.fromMillis(0).toISO(),endingSoonDuration:M.value?.toISO()??C.fromMillis(0).toISO(),reviewDuration:P.value?.toISO()??C.fromMillis(0).toISO()}),e}return(e,t)=>(v(),R(a(Se),{"modal-title":se.value.modalTitle,action:()=>fe(e.formMode,!1),"trigger-button-label":se.value.triggerButtonLabel,"ok-button-label":se.value.okButtonLabel,"ok-button-disabled-tooltip":Le.value,"confirm-permission":"api.liveops_events.edit","trigger-button-full-width":"",onShow:_e,"data-testid":"live-ops-event-form"},{default:r(()=>[e.formMode==="edit"?(v(),h("div",it,[t[14]||(t[14]=N("div",{class:"tw-text-sm tw-font-bold tw-leading-6"},"Event Type",-1)),N("p",null,D(H.value?.eventTypeName??"Unknown"),1)])):(v(),h("div",st,[i(a(de),S(n("eventType"),{label:"Event Type","model-value":d.value,options:j.value,placeholder:"Select a type","onUpdate:modelValue":pe}),null,16,["model-value","options"])])),i(a(Ye),S(n("displayName"),{class:"tw-mb-2"},{label:"Name","model-value":s.value,placeholder:"Double XP Weekend","onUpdate:modelValue":Oe}),null,16,["model-value"]),i(a(Ee),{label:"Description","model-value":u.value,placeholder:"This event is for players who have completed the tutorial.","onUpdate:modelValue":ke},null,8,["model-value"]),i(a(de),{class:"tw-mb-3",label:"Color","model-value":G.value,options:a(De),placeholder:"Select a color","onUpdate:modelValue":Ce},{option:r(({option:l})=>[N("div",ut,[l?.value?(v(),h("div",{key:0,class:"tw-h-4 tw-w-4 tw-rounded-sm tw-border tw-border-neutral-800",style:ze(`background-color: ${l?.value}`)},null,4)):(v(),h("div",rt)),N("div",dt,D(l?.label),1)])]),_:1},8,["model-value","options"]),i(a(tt),S(n("useSchedule"),{"on-state-label":"Scheduling Enabled","off-state-label":"Enable Scheduling","model-value":F.value,size:"small","hide-content":!0,"on-state-hint-message":"With scheduling enabled the event will be active only during the specified time. Disable scheduling to make the event active immediately without any time limits.","off-state-hint-message":"Enable scheduling to limit how long an event is active.","onUpdate:modelValue":t[9]||(t[9]=l=>F.value=l)}),{offStateContent:r(()=>[V("useSchedule","Info")?(v(),R(a(X),{key:0,variant:"warning"},{default:r(()=>[z(D(V("useSchedule","Info")),1)],void 0,!0),_:1})):K("",!0),V("schedule","Warning")?(v(),R(a(X),{key:1,variant:"warning"},{default:r(()=>[z(D(V("schedule","Warning")),1)],void 0,!0),_:1})):K("",!0)]),default:r(()=>[F.value?(v(),h("div",vt,[V("useSchedule","Info")?(v(),R(a(X),{key:0,variant:"warning"},{default:r(()=>[z(D(V("useSchedule","Info")),1)],void 0,!0),_:1})):K("",!0),V("schedule","Warning")?(v(),R(a(X),{key:1,variant:"warning"},{default:r(()=>[z(D(V("schedule","Warning")),1)],void 0,!0),_:1})):K("",!0),N("div",ct,[t[15]||(t[15]=N("div",{class:"tw-text-sm tw-font-bold"},"Time Zone",-1)),i(a(et),S(n("schedule.isPlayerLocalTime"),{"model-value":f.value,options:Te,size:"small","onUpdate:modelValue":t[0]||(t[0]=l=>f.value=l)}),null,16,["model-value"])]),i(a(X),null,{default:r(()=>[z(D(f.value==="local"?"Event will run at a different time for each player.":"Event will run at the same time for all players."),1)],void 0,!0),_:1}),i(a(ve),S(n("schedule.previewDuration"),{label:"1. Preview Phase","model-value":L.value,"allow-empty":"","hint-message":n("schedule.previewDuration").variant==="danger"?n("schedule.previewDuration").hintMessage:L.value?`Event will be visible for ${L.value.toHuman({listStyle:"short",unitDisplay:"short"})} before starting.`:"Event will not be visible until it starts.","onUpdate:modelValue":t[1]||(t[1]=l=>L.value=l??void 0),onIsValid:t[2]||(t[2]=l=>oe.value=l)}),null,16,["model-value","hint-message"]),i(a(he),S(n("schedule.enabledStartTime"),{label:`2. Start Time (${f.value==="utc"?"UTC":"player local"})`,"model-value":g.value,"hint-message":n("schedule.enabledStartTime").variant==="danger"?n("schedule.enabledStartTime").hintMessage:f.value==="utc"?`Event will start at ${g.value?.toLocaleString(a(E).DATETIME_FULL)}.`:`Event will start at ${g.value?.toLocaleString(a(E).DATETIME_FULL).slice(0,-4)} in player local time.`,"onUpdate:modelValue":t[3]||(t[3]=l=>g.value=l)}),null,16,["label","model-value","hint-message"]),i(a(ve),S(n("schedule.endingSoonDuration"),{label:"3. Ending Soon Phase","model-value":M.value,"allow-empty":"","hint-message":n("schedule.endingSoonDuration").variant==="danger"?n("schedule.endingSoonDuration").hintMessage:M.value?`Event will be marked as ending soon ${M.value.toHuman({listStyle:"short",unitDisplay:"short"})} before ending.`:"Event will not be marked as ending soon before it ends.","onUpdate:modelValue":t[4]||(t[4]=l=>M.value=l??void 0),onIsValid:t[5]||(t[5]=l=>ne.value=l)}),null,16,["model-value","hint-message"]),i(a(he),S(n("schedule.enabledEndTime"),{label:`4. End Time (${f.value==="utc"?"UTC":"player local"})`,"model-value":w.value,minDateTime:g.value,"hint-message":n("schedule.enabledEndTime").variant==="danger"?n("schedule.enabledEndTime").hintMessage:f.value==="utc"?`Event will end at ${w.value?.toLocaleString(a(E).DATETIME_FULL)} after running for ${Ie.value?.toHuman()}.`:`Event will end at ${w.value?.toLocaleString(a(E).DATETIME_FULL).slice(0,-4)} in player local time.`,"onUpdate:modelValue":t[6]||(t[6]=l=>w.value=l)}),null,16,["label","model-value","minDateTime","hint-message"]),i(a(ve),S(n("schedule.reviewDuration"),{label:"5. Review Phase","model-value":P.value,"allow-empty":"","hint-message":n("schedule.reviewDuration").variant==="danger"?n("schedule.reviewDuration").hintMessage:P.value?`Event will be visible for review ${P.value.toHuman({listStyle:"short",unitDisplay:"short"})} after ending.`:"Event will not be visible for review after it ends.","onUpdate:modelValue":t[7]||(t[7]=l=>P.value=l??void 0),onIsValid:t[8]||(t[8]=l=>ie.value=l)}),null,16,["model-value","hint-message"])])):K("",!0)]),_:1},16,["model-value"]),i(Qe,{class:"tw-mt-3","model-value":_.value,"onUpdate:modelValue":t[10]||(t[10]=l=>_.value=a(U)(l))},null,8,["model-value"])]),"right-panel":r(()=>[t[16]||(t[16]=N("h6",{class:"tw-mb-1 tw-text-sm tw-font-bold tw-leading-6 tw-text-neutral-900"},"Event Configuration",-1)),d.value!==""?(v(),h(Re,{key:0},[i(a(de),S(n("content"),{class:"tw-mb-2"},{label:"Preset","model-value":I.value,options:W.value,placeholder:d.value?"Select a preset...":"Select a type",disabled:W.value.length===0,"onUpdate:modelValue":t[11]||(t[11]=l=>I.value=l)}),null,16,["model-value","options","placeholder","disabled"]),i(Ze,{typeName:le.value,value:x.value,page:"LiveOpsEventForm",addTypeSpecifier:"","is-targeting-multiple-players":"",onInput:t[12]||(t[12]=l=>x.value=l),onStatus:t[13]||(t[13]=l=>J.value=l)},null,8,["typeName","value"])],64)):(v(),h("div",mt,"Choose an event type to start configuring it."))]),_:1},8,["modal-title","action","trigger-button-label","ok-button-label","ok-button-disabled-tooltip"]))}});export{Vt as _,Pt as a};
