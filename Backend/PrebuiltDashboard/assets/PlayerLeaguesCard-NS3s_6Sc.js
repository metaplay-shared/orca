import{d as ie,E as Y,h as w,K as ne,dT as E,aX as se,cn as oe,c as re,r as x,e as b,o as d,w as r,j as c,f as s,s as le,q as u,a as f,k as i,m as $,t as o,bx as D,x as F,a6 as de,ae as P,_ as T,e2 as ue,bs as pe,bt as ce}from"./index-DAyiym1a.js";import{M as U,a as B,b as ve,c as M}from"./metaListUtils-B-xQ0HnD.js";import{g as ge}from"./leagueUtils-BqF6ffxm.js";import{e as fe,a as me,b as ye}from"./leagues-B22oLAaC.js";import{a as he}from"./players-CkgXyjra.js";import{_ as j}from"./MActionModalButton.vue_vue_type_script_setup_true_lang-CRnsCPt_.js";import{_ as be}from"./MInputSingleSelectDropdown.vue_vue_type_script_setup_true_lang-BRIBVSuX.js";import{_ as Se}from"./MInputNumber.vue_vue_type_script_setup_true_lang-qrqxgTEu.js";import"./MActionModal.vue_vue_type_script_setup_true_lang-XDUxofmt.js";import"./index-CVSO09yM.js";import"./MInputHintMessage.vue_vue_type_script_setup_true_lang-B7AbTbVm.js";import"./index-Byt7eTSs.js";const we={key:0},_e={key:1},ke={key:0},Pe={key:1},Ne={key:2},Ie={class:"tw-font-semibold"},Le={key:3},xe={class:"tw-font-semibold"},$e={class:"tw-font-semibold"},De={class:"tw-font-semibold"},Te={class:"border rounded-sm bg-light py-2 tw-px-4"},Me={class:"font-weight-bold tw-mb-1"},Re={key:0,class:"small text-muted my-2"},Ae={key:1,class:"small text-muted my-2"},Oe={class:"tw-mt-3 tw-inline-flex tw-w-full tw-justify-end tw-space-x-2"},Ce={key:0},Ve={class:"font-weight-bold"},Ye={class:"font-weight-bold"},Ee={class:"font-weight-bold"},Fe={class:"font-weight-bold"},Ue={key:1},aa=ie({__name:"PlayerLeaguesCard",props:{playerId:{}},setup(H){const _=H,N=pe(),{data:R}=Y(he(_.playerId)),{data:y,refresh:A}=Y(fe(_.playerId)),k=w([]),h=w([]),q=ne(()=>y.value,()=>{if(y.value){let t=0;y.value.forEach(e=>{k.value.push(E(me(e.leagueId))),S(t)?h.value.push(E(ye(e.leagueId,"$active"))):h.value.push(void 0),t++}),se(()=>{q()})}},{immediate:!0});oe(()=>{for(;k.value.length;){const t=k.value.shift();t&&t.unsubscribe()}for(;h.value.length;){const t=h.value.shift();t&&t.unsubscribe()}});function S(t){return y.value[t].hasActiveSeason}const I=re(()=>{const t=[];for(let e=0;e<y.value?.length;++e){const n=y.value[e],l=k.value[e].data,p=S(e),a=p?h.value[e]?.data:void 0;n&&l&&(!p||a)&&t.push({leagueIndex:e,leagueName:n.leagueName,leagueId:n.leagueId,enabled:l.enabled,season:n.divisionIndex.season,currentSeasonPhase:p?l.currentOrNextSeasonSchedule?.currentPhase?.phase:"Inactive",participantStatus:n.participantStatus,rankName:p?a.ranks[n.divisionIndex.rank].rankName:"No Current Season",divisionIndex:n.divisionIndex.division,divisionId:n.divisionId,placeInDivision:n.placeInDivision,divisionsPerRank:p?a.ranks.map(g=>g.numDivisions):[]})}return t}),O=w([]);function G(t){v.value=t,m.value=void 0}function K(t){v.value=void 0,m.value=void 0;const e=h.value[t].data;let n=0;O.value=e?.ranks.map(l=>({label:l.rankName,value:{index:n++,rankName:l.rankName,description:l.description}}))??[]}const v=w(),m=w();function L(t,e,n){let l=!1;if(S(t)&&e!==void 0){const p=I.value[t];if(p.participantStatus==="Participant"){const a=h.value[t].data;p.rankName===a?.ranks[e].rankName&&(n==null?p.divisionsPerRank[e]===1&&(l=!0):n===p.divisionIndex&&(l=!0))}}return l}function X(t,e){if(!v.value)return"Select a rank to proceed.";if(L(t,v.value.index,m.value))return"This player is already in the selected division.";if(e==="Inactive")return"This league is currently inactive.";if(!S(t))return"No active season for this league."}function z(t){return t.enabled?S(t.leagueIndex)?void 0:"Cannot add or move participants while a league is inactive.":"Cannot add or move participants while a league is disabled."}const{showSuccessNotification:C,showErrorNotification:V}=ce();async function J(t,e,n){let l;const p=I.value[t],a=p.leagueId;if(n==null)l=`/leagues/${a}/participant/${_.playerId}/addRank/${e}`;else{const te=(await N.get(`/divisions/id/${a}/${p.season}/${e}/${n}/`)).data;l=`/leagues/${a}/participant/${_.playerId}/add/${te}`}const g=await N.post(l);g.data.success?(C("Player successfully added to division!"),A()):V(g.data.errorMessage)}function Q(t){return t.enabled?t.participantStatus==="Participant"?void 0:"This player is not a participant in this league.":"You cannot remove participants while a league is disabled."}async function W(t,e){if(y.value){const n=await N.post(`/leagues/${t}/participant/${e}/remove`);n.data.success?(C("Participant successfully removed from division."),A()):V(n.data.errorMessage)}}const Z=["leagueName"],ee=[new U("League name","leagueName",B.Descending),new U("League name","leagueName",B.Ascending)],ae=[new ve("participating",[new M("Participating",t=>t.participantStatus==="Participant"),new M("Not participating",t=>t.participantStatus==="NotParticipant"),new M("Never participated",t=>t.participantStatus==="NeverParticipated")])];return(t,e)=>{const n=x("fa-icon"),l=x("meta-no-seatbelts"),p=x("meta-list-card");return d(),b(p,{title:"Player Leagues",icon:"trophy",itemList:I.value,searchFields:Z,filterSets:ae,sortOptions:ee,emptyMessage:`${s(R).model.playerName} isn't participating in any player leagues.`,permission:"api.leagues.view","data-testid":"player-leagues-card"},{"item-card":r(({item:a})=>[c(s(le),{extraMListItemMargin:""},{header:r(()=>[c(s(F),{noLeftPadding:"","data-testid":"player-leagues-list-entry"},{badge:r(()=>[a.participantStatus==="Participant"?(d(),b(s(T),{key:0,variant:"success"},{default:r(()=>e[1]||(e[1]=[i("Participating",-1)]),void 0,!0),_:1,__:[1]})):$("",!0)]),"top-right":r(()=>[e[3]||(e[3]=u("span",{class:"tw-mr-1"},"Phase:",-1)),a.enabled?(d(),f("span",we,[c(s(T),{variant:s(ge)(a.currentSeasonPhase)},{default:r(()=>[i(o(s(ue)(a.currentSeasonPhase)),1)],void 0,!0),_:2},1032,["variant"])])):(d(),f("span",_e,[c(s(T),null,{default:r(()=>e[2]||(e[2]=[i("Disabled",-1)]),void 0,!0),_:1,__:[2]})]))]),"bottom-left":r(()=>[a.participantStatus==="NeverParticipated"?(d(),f("span",ke,"This player has never participated in "+o(a.leagueName)+".",1)):a.participantStatus==="NotParticipant"?(d(),f("span",Pe,"This player has previously participated in the "+o(a.leagueName)+" but is not part of the ongoing season.",1)):a.participantStatus==="Participant"&&!a.enabled?(d(),f("span",Ne,[i("This player participated in the last active season of the "+o(a.leagueName)+" and was ranked "+o(s(D)(a.placeInDivision))+" place in ",1),u("span",Ie,"Division "+o(a.divisionIndex),1),e[4]||(e[4]=i(" of ",-1)),u("strong",null,o(a.rankName),1),e[5]||(e[5]=i(" in ",-1)),c(s(P),{to:`/leagues/${a.leagueId}/${a.season}`},{default:r(()=>[i("season "+o(a.season),1)],void 0,!0),_:2},1032,["to"]),e[6]||(e[6]=i(".",-1))])):(d(),f("span",Le,[i("This player is currently part of "+o(a.leagueName)+" and is ranked ",1),u("span",xe,o(s(D)(a.placeInDivision)),1),e[7]||(e[7]=i(" place in ",-1)),u("span",$e,"Division "+o(a.divisionIndex),1),e[8]||(e[8]=i(" of ",-1)),u("span",De,o(a.rankName),1),e[9]||(e[9]=i(" in ",-1)),c(s(P),{to:`/leagues/${a.leagueId}/${a.season}`},{default:r(()=>[i("Season "+o(a.season),1)],void 0,!0),_:2},1032,["to"]),e[10]||(e[10]=i(".",-1))]))]),"bottom-right":r(()=>[a.participantStatus!=="Participant"?(d(),b(s(P),{key:0,to:`/leagues/${a.leagueId}`},{default:r(()=>e[11]||(e[11]=[i("View league",-1)]),void 0,!0),_:2,__:[11]},1032,["to"])):a.participantStatus==="Participant"?(d(),b(s(P),{key:1,to:`/leagues/${a.leagueId}/${a.season}/${a.divisionId}`},{default:r(()=>e[12]||(e[12]=[i("View division",-1)]),void 0,!0),_:2,__:[12]},1032,["to"])):$("",!0)]),default:r(()=>[i(o(a.leagueName),1)],void 0,!0),_:2},1024)]),default:r(()=>[u("div",Te,[u("div",Me,[c(n,{icon:"wrench"}),e[13]||(e[13]=i(" Admin Controls",-1))]),a.enabled?(d(),f("div",Ae,"You can add or remove this player from the league or change their rank and/or division.")):(d(),f("div",Re,"This league is currently disabled and there are no active seasons. You cannot add or remove a player from a disabled league.")),u("div",Oe,[c(s(j),{"modal-title":a.participantStatus!=="Participant"?"Add to League":"Modify Rank or Division",action:()=>J(a.leagueIndex,v.value?.index,m.value),"trigger-button-label":a.participantStatus!=="Participant"?"Add to League":"Modify Rank or Division","trigger-button-disabled-tooltip":z(a),variant:"warning","ok-button-disabled-tooltip":X(a.leagueIndex,a.currentSeasonPhase),permission:"api.leagues.participant_edit",onShow:g=>K(a.leagueIndex),"data-testid":"action-add-participant"},{default:r(()=>[a.participantStatus==="Participant"?(d(),f("p",Ce,[e[14]||(e[14]=i("This player is already part of ",-1)),u("span",Ve,o(a.leagueName),1),e[15]||(e[15]=i(" and is ranked ",-1)),u("span",Ye,o(s(D)(a.placeInDivision)),1),e[16]||(e[16]=i(" place in ",-1)),u("span",Ee,"Division "+o(a.divisionIndex),1),e[17]||(e[17]=i(" of ",-1)),u("span",Fe,o(a.rankName),1),e[18]||(e[18]=i(". You can move this player to another rank or division in this league.",-1))])):(d(),f("p",Ue,"You are about to add this player to "+o(a.leagueName)+".",1)),e[20]||(e[20]=u("p",null,"If the player is currently playing the game, they will be immediately disconnected so that the changes can be applied.",-1)),e[21]||(e[21]=u("div",{class:"tw-font-semi-bold tw-mb-1"},"New Rank",-1)),c(s(be),{"model-value":v.value,options:O.value,placeholder:"Select a rank ...","onUpdate:modelValue":G},{option:r(({option:g})=>[c(s(F),{class:"!tw-py-1",noLeftPadding:"",noRightPadding:""},{"top-right":r(()=>[i(o(g.value?.description),1)]),default:r(()=>[i(o(g.value?.rankName),1)],void 0,!0),_:2},1024)]),_:1},8,["model-value","options"]),c(s(Se),{class:"tw-mt-1",label:"New Division","model-value":m.value,disabled:!v.value||a.divisionsPerRank[v.value?.index||0]===0,min:0,max:a.divisionsPerRank[v.value?.index||0]-1,placeholder:a.divisionsPerRank[v.value?.index||0]>0?"Assigned randomly":"There are no divisions in this rank. A new division will be created.",allowUndefined:"",variant:L(a.leagueIndex,v.value?.index,m.value)?"danger":"default","hint-message":L(a.leagueIndex,v.value?.index,m.value)?"Player is already in this division. You cannot move a player to a division that they are already in.":void 0,"onUpdate:modelValue":e[0]||(e[0]=g=>m.value=g)},null,8,["model-value","disabled","max","placeholder","variant","hint-message"]),a.currentSeasonPhase==="Inactive"?(d(),b(s(de),{key:2,title:"Past Season",variant:"danger"},{default:r(()=>e[19]||(e[19]=[i("The season has now concluded. You can no longer add participants to this division.",-1)]),void 0,!0),_:1,__:[19]})):a.participantStatus==="Participant"?(d(),b(l,{key:3,class:"tw-mt-3",message:"This action cannot be undone. The player will lose all their progress in the league and will have to start again from scratch."})):$("",!0)],void 0,!0),_:2,__:[20,21]},1032,["modal-title","action","trigger-button-label","trigger-button-disabled-tooltip","ok-button-disabled-tooltip","onShow"]),c(s(j),{"modal-title":"Remove Player from League",action:()=>W(a.leagueId,t.playerId),"trigger-button-label":"Remove Player","trigger-button-disabled-tooltip":Q(a),variant:"warning",permission:"api.leagues.participant_edit","data-testid":"action-remove-participant"},{default:r(()=>[u("p",null,"You are about to remove this player from "+o(a.leagueName)+".",1),c(l,{class:"tw-mt-3",message:"This action can't be undone. The participant will lose all their progress in the league.",name:s(R).model.playerName},null,8,["name"])],void 0,!0),_:2},1032,["action","trigger-button-disabled-tooltip"])])])],void 0,!0),_:2},1024)]),_:1},8,["itemList","emptyMessage"])}}});export{aa as default};
