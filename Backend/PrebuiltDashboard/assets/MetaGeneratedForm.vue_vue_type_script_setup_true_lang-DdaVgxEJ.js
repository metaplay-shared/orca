import{d as $,h as f,E as S,a3 as _,H as D,c as v,J as E,ca as G,K as m,r as K,a as y,f as L,o as g,j as h,m as N,e as q,q as T,t as A,cb as J,c7 as R,bs as U}from"./index-DAyiym1a.js";import{_ as H}from"./GeneratedUiFormDynamicComponent.vue_vue_type_script_setup_true_lang-BiTvhFwY.js";import{_ as Q}from"./MInputMultiSelectCheckbox.vue_vue_type_script_setup_true_lang-D6xsoOzq.js";import{_ as W}from"./MInputSingleSelectDropdown.vue_vue_type_script_setup_true_lang-BRIBVSuX.js";const X={key:0,class:"pt-5 tw-w-full tw-text-center"},Y={key:1},Z={key:0},ee={key:1,class:"tw-text-red-500"},oe=$({__name:"MetaGeneratedForm",props:{typeName:{type:String,required:!0},value:{type:null,required:!1,default:void 0},page:{type:String,default:void 0},addTypeSpecifier:{type:Boolean,default:!1},forcedLocalization:{type:String,default:void 0},abstractTypeFilter:{type:Function,default:void 0},logicVersion:{type:Number,default:void 0},isTargetingMultiplePlayers:{type:Boolean,default:!1}},emits:["input","status"],setup(i,{emit:V}){const t=i,o=f(),n=f(),p=f(null);f();const{data:s}=S(_(["Languages"])),{data:u}=S(D()),z=U(),b=V;function I(){t.typeName!==""&&R(t.typeName).then(e=>{o.value=e}).catch(e=>{console.error(JSON.stringify(e))})}async function w(e){if(o.value){t.addTypeSpecifier&&(e.$type=o.value.jsonType);const a=await J(e,o.value);b("input",a)}}const C=v(()=>({fieldName:void 0,fieldType:t.typeName,typeKind:o.value?.typeKind??E.Class,isLocalized:o.value?.isLocalized,addedInVersion:o.value?.addedInVersion,removedInVersion:void 0})),O=v(()=>{let e=[];if(!s.value||!u.value)return e;const a=u.value.defaultLanguage;a&&!e.includes(a)&&e.push(a);const l=G(t.value,s.value);for(const d of l)e.includes(d)||e.push(d);if(l.length===0)for(const d in s.value.gameConfig.Languages)e.includes(d)||e.push(d);return t.forcedLocalization&&(e=[t.forcedLocalization]),e}),r=f(""),c=f([]);function k(e){c.value=e,e.includes(r.value)||(r.value=e[0])}const F=v(()=>s.value?.gameConfig.Languages??{}),j=v(()=>Object.values(F.value).sort((a,l)=>a.languageId===u.value?.defaultLanguage?-1:l.languageId===u.value?.defaultLanguage?1:0).filter(a=>!t.forcedLocalization||a.languageId===t.forcedLocalization).map(a=>({label:a.displayName,value:a.languageId,disabled:a.languageId===u.value?.defaultLanguage||!!t.forcedLocalization}))),B=v(()=>{const e=c.value.map(a=>({label:s.value?.gameConfig.Languages[a].displayName,value:a}));return e.unshift({label:"Show all",value:"all"}),e}),x=v(()=>n.value?n.value.length===0:void 0),M=v(()=>n.value?.length>0?n.value[0].path+": "+n.value[0].reason:"");async function P(e){if(typeof e=="object"&&Object.keys(e).length===0)return;let a=`forms/schema/${t.typeName}/validate`;t.logicVersion!==void 0&&(a+=`/${t.logicVersion}`);const l=await z.post(a,e);l.status===200?(n.value=l.data,b("status",n.value.length===0)):(console.error("Server validation failed: ",l),b("status",!1))}return m(()=>t.value,e=>{p.value!==null&&clearTimeout(p.value),p.value=setTimeout(()=>{P(e).then(()=>{p.value=null}).catch(a=>{console.error(JSON.stringify(a))})},200)}),m(()=>t.typeName,()=>{I()},{immediate:!0}),m(s,e=>{e&&c.value.length===0&&(c.value=O.value)},{immediate:!0}),m(u,e=>{e&&(r.value=t.forcedLocalization??e.defaultLanguage)},{immediate:!0}),(e,a)=>{const l=K("b-spinner");return!o.value||!L(s)||!L(u)?(g(),y("div",X,[h(l,{class:"mt-5",label:"Loading..."})])):(g(),y("div",Y,[o.value.isLocalized&&!i.forcedLocalization?(g(),y("div",Z,[a[1]||(a[1]=T("div",{class:"font-weight-bold tw-mb-1"},"Selected Locales",-1)),h(L(Q),{class:"mb-2","model-value":c.value,options:j.value,variant:c.value.length===0?"danger":"default","logic-version":i.logicVersion,"onUpdate:modelValue":k,"data-testid":"localizations-selection-input"},null,8,["model-value","options","variant","logic-version"]),a[2]||(a[2]=T("div",{class:"font-weight-bold tw-mb-1"},"Current Locale",-1)),h(L(W),{class:"mb-2","model-value":r.value,options:B.value,"onUpdate:modelValue":a[0]||(a[0]=d=>r.value=d),"data-testid":"currentlocale-input"},null,8,["model-value","options"])])):N("",!0),(g(),q(H,{key:i.typeName,fieldInfo:C.value,value:i.value,editLocales:c.value,previewLocale:r.value==="all"?void 0:r.value,fieldPath:"",serverValidationResults:n.value,page:i.page,abstractTypeFilter:i.abstractTypeFilter,contextObj:i.value,logicVersion:t.logicVersion,isTargetingMultiplePlayers:i.isTargetingMultiplePlayers,onInput:w},null,8,["fieldInfo","value","editLocales","previewLocale","serverValidationResults","page","abstractTypeFilter","contextObj","logicVersion","isTargetingMultiplePlayers"])),x.value?N("",!0):(g(),y("div",ee,A(M.value),1))]))}}});export{oe as _};
