import{d as V,E as B,h as f,c as F,r as d,e as _,o as v,w as a,j as s,f as t,s as P,x as j,k as l,t as c,q as m,y as E,D as H,bE as q,m as z,_ as b,bs as G,bt as K}from"./index-DAyiym1a.js";import{M as y,a as g,b as J,c as w}from"./metaListUtils-B-xQ0HnD.js";import{a as Q}from"./players-CkgXyjra.js";import{_ as U}from"./MetaGeneratedContent.vue_vue_type_script_setup_true_lang-DR9f3Dqo.js";import{_ as W}from"./MActionModal.vue_vue_type_script_setup_true_lang-XDUxofmt.js";import"./index-CVSO09yM.js";const X={class:"tw-text-sm tw-text-neutral-500"},Y={class:"tw-mb-4"},Z=1,ie=V({__name:"PlayerInboxCard",props:{playerId:{}},setup(x){const h=x,M=G(),{data:o,refresh:S}=B(Q(h.playerId)),$=["contents.description"],D=[new J("attachments",[new w("Has attachments",e=>e.contents.consumableRewards.length>0),new w("No attachments",e=>e.contents.consumableRewards.length===0)])],I=[new y("Time","sentAt",g.Ascending),new y("Time","sentAt",g.Descending)],r=f(null),p=f();function L(e){r.value=e,p.value?.open(e)}const k=F(()=>r.value?r.value.contents.description:"");function C(e){return e.id}const{showSuccessNotification:N}=K();async function A(e){await M.delete(`/players/${o.value.id}/deleteMail/${e.id}`);const n=`${e.contents.description}' deleted from ${o.value.model.playerName||"n/a"}.`;N(n),S()}return(e,n)=>{const u=d("fa-icon"),O=d("meta-no-seatbelts"),T=d("meta-list-card");return v(),_(T,{title:"Inbox",icon:"inbox",itemList:t(o).model.mailInbox,getItemKey:C,tooltip:"Messages currently waiting in the player's inbox.",searchFields:$,filterSets:D,sortOptions:I,defaultSortOption:Z,emptyMessage:"Inbox empty.","data-testid":"player-inbox-list-card"},{"item-card":a(({item:i})=>[s(t(P),{extraMListItemMargin:""},{header:a(()=>[s(t(j),{noLeftPadding:"","data-testid":"player-inbox-mail-item"},{badge:a(()=>[Object.keys(i.contents.consumableRewards).length>0?(v(),_(u,{key:0,class:"tw-mt-1 tw-text-neutral-500",icon:"paperclip",size:"sm"})):z("",!0)]),"top-right":a(()=>[m("span",X,c(i.id),1),s(t(q),{permission:"api.players.mail",variant:"danger","aria-label":"Delete this mail.",onClick:R=>L(i),"data-testid":"confirm-mail-delete"},{default:a(()=>[s(u,{icon:"trash-alt"})],void 0,!0),_:2},1032,["onClick"])]),"bottom-right":a(()=>[m("span",null,[n[1]||(n[1]=l("Received ",-1)),s(t(E),{instant:t(H).fromISO(i.sentAt),showAs:"relativeSentenceCase"},null,8,["instant"])])]),default:a(()=>[l(c(i.contents.description),1)],void 0,!0),_:2},1024)]),default:a(()=>[s(U,{value:i.contents,previewLocale:t(o).model.language,"logic-version":t(o).model.logicVersion,"data-testid":"player-inbox-mail-content"},null,8,["value","previewLocale","logic-version"])],void 0,!0),_:2},1024),s(t(W),{ref_key:"deleteInboxModal",ref:p,title:"Delete Mail",action:()=>A(r.value),onHidden:n[0]||(n[0]=R=>r.value=null),"data-testid":"confirm-mail-delete"},{default:a(()=>[m("p",Y,[s(t(b),null,{default:a(()=>[l(c(t(o).model.playerName||"n/a"),1)],void 0,!0),_:1}),n[2]||(n[2]=l(" has not claimed this mail yet. Are you sure that you want to delete the mail ",-1)),s(t(b),null,{default:a(()=>[l(c(k.value),1)],void 0,!0),_:1}),n[3]||(n[3]=l("?",-1))]),s(O)],void 0,!0),_:1},8,["action"])]),_:1},8,["itemList"])}}});export{ie as default};
