import{bD as Ie,d as Pe,i as xe,h as b,D as te,c as f,b7 as Oe,K as Fe,r as x,e as k,o as s,w as u,j as a,a as o,Q as se,q as v,f as m,U as Me,m as p,t as g,_ as le,k as w,bE as Be,bF as Ae,F as j,b as R,a7 as G,aS as ve,y as ce,bd as me,ae as fe,v as ze,bj as Ne,aj as Ue,aP as pe,bg as Ee}from"./index-DAyiym1a.js";import{a as ge}from"./metaListUtils-B-xQ0HnD.js";import{a as we}from"./utils-DSYdgMhH.js";import{b as Ke}from"./_baseIteratee-CfhjPvCd.js";import{_ as Te}from"./MInputText.vue_vue_type_script_setup_true_lang-B9sf9LSD.js";import{_ as De}from"./MInputMultiSelectCheckbox.vue_vue_type_script_setup_true_lang-D6xsoOzq.js";import{_ as Ve}from"./MInputSingleSelectRadio.vue_vue_type_script_setup_true_lang-CGM7lb3s.js";import{B as qe,c as ye}from"./button-group-DBs956_t.js";import"./isSymbol-BXvDeGRF.js";import"./identity-DKeuBCMA.js";import"./MInputHintMessage.vue_vue_type_script_setup_true_lang-B7AbTbVm.js";import"./debounce-CRuraxcR.js";import"./MInputCheckbox.vue_vue_type_script_setup_true_lang-CmGaUCkv.js";import"./index-TQG-La0y.js";var He=4;function he(y){return Ie(y,He)}function je(y,l){for(var S,A=-1,z=y.length;++A<z;){var P=l(y[A]);P!==void 0&&(S=S===void 0?P:S+P)}return S}var Re=NaN;function Ge(y,l){var S=y==null?0:y.length;return S?je(y,l)/S:Re}function Ye(y,l){return Ge(y,Ke(l))}const Qe={key:1,class:"tw-overflow-hidden tw-overflow-ellipsis tw-text-lg tw-font-bold"},Je={key:2},We={style:{"margin-top":"-1rem"}},Xe={key:0,class:"text-muted mr-2 tw-italic"},Ze={key:1,class:"text-muted mr-2 tw-italic"},et={key:2,class:"text-muted mr-2 tw-italic"},tt={key:0,class:"mb-4 pt-4 small text-muted tw-text-center"},st={key:1,class:"card-manual-content-padding pt-2 tw-w-full"},lt={key:2,class:"d-flex flex-column justify-content-between h-100"},at={key:0,class:"bg-light card-manual-content-padding border-top border-bottom tw-w-full"},ot={class:"mb-3 tw-mt-4"},nt={class:"mb-2"},it={key:1,class:"tw-relative tw-bottom-1 tw-text-xs+ tw-text-neutral-500"},rt={key:1,class:"tw-relative tw-bottom-1 tw-text-xs+ tw-text-neutral-500"},ut={key:1,class:"tw-relative tw-bottom-1 tw-text-xs+ tw-text-neutral-500"},dt={key:0,class:"small card-manual-content-padding"},vt={class:"small card-manual-content-padding"},ct={key:1,class:"tw-mt-1 tw-space-x-1 tw-pb-2 tw-text-center tw-text-xs+ tw-text-neutral-500"},mt={key:2},ft={key:1,class:"d-flex flex-wrap card-manual-content-padding tw-my-4"},pt={style:{"font-size":"0.7rem"}},gt={class:"small text-muted","data-testid":"meta-list-card-no-results-message"},wt={key:0,class:"tw-mb-4 tw-mt-4"},yt={key:0,class:"mb-2 tw-w-full tw-text-center"},ht={class:"small text-muted"},bt={key:1,class:"tw-mb-1 tw-text-center"},_t={class:"px-3 bg-secondary text-light pagination-shadow",style:{"padding-top":"0.3rem","min-width":"4rem"}},kt={key:3},St={key:0,class:"small card-manual-content-padding"},Lt={class:"mb-2"},Ct={class:"pb-4 my-5 text-muted tw-px-4 tw-text-center"},$t=Pe({__name:"MetaListCard",props:{title:{},icon:{default:void 0},tooltip:{default:void 0},dangerous:{type:Boolean},itemList:{default:void 0},getItemKey:{type:Function,default:void 0},pageSize:{default:8},searchFields:{default:void 0},searchPlaceholder:{default:"Type your search here..."},filterSets:{default:void 0},sortOptions:{default:void 0},defaultSortOption:{default:0},emptyMessage:{default:"Nothing to list!"},noResultsMessage:{default:"No items found. Try a different search string or filters? ðŸ¤”"},moreInfoUri:{default:void 0},moreInfoLabel:{default:"relevant"},moreInfoPermission:{default:void 0},listLayout:{default:"list"},clickable:{type:Boolean,default:!1},permission:{default:void 0},description:{default:void 0},allowPausing:{type:Boolean,default:!1},alternativeTitleStyle:{type:Boolean,default:!1}},setup(y){const l=y,S=Oe(),A=Ue;xe(()=>{if(setTimeout(Y,0),l.filterSets){const e=l.filterSets.map(n=>n.key),t=Array.from(new Set(e));e.length!==t.length&&console.warn(`Duplicate filter keys found in MetaListCard '${l.title}'`)}l.filterSets&&l.filterSets.forEach(e=>{e.filterOptions.forEach(t=>{t.initiallyActive&&O.value.push(D(e,t))})}),U.value=l.defaultSortOption,$.value=he(l.itemList)??[],q.value=!1,H.value=te.utc()});const z=b([]),P=b(10);function Y(){const e=Ye(z.value,t=>t.clientHeight);e>P.value&&(P.value=e)}const Q=f(()=>l.permission?S.doesHavePermission(l.permission):!0),M=f(()=>($.value?.length??0)>0),J=f(()=>(l.searchFields&&l.searchFields.length>0)??(l.sortOptions&&l.sortOptions.length>1)??!!(l.filterSets&&l.filterSets.length>0)),W=b(!1);function ae(){W.value=!W.value}const N=b("");function be(e){return e.filterOptions.map(t=>{const n=D(e,t);return{label:`${t.displayName} (${ne([n]).length})`,value:n}})}const O=b([]),U=b(0),E=f(()=>{let e=ne(O.value);if(l.sortOptions){const t=l.sortOptions[U.value],n=t.sortKey;let h;n===null?h=d=>0:typeof n=="string"?h=d=>{let i=n?we(d,n):d;return typeof i=="string"&&(i=i.toLowerCase()),i}:typeof n=="function"&&(h=d=>{let i=n(d);return typeof i=="string"&&(i=i.toLowerCase()),i});const _=t.direction;e=[...e].sort((d,i)=>{let c=0;const I=h(d),r=h(i);return I>r?c=1:I<r&&(c=-1),c=c*_,c})}return e}),_e=f(()=>l.sortOptions?l.sortOptions.map((e,t)=>({value:t,label:e.displayName+(e.direction===ge.Descending?" â†“":e.direction===ge.Ascending?" â†‘":"")})):[]),K=f(()=>N.value.length>0),T=f(()=>O.value.length>0||K.value),X=f(()=>M.value&&l.sortOptions!==void 0),ke=f(()=>T.value||X.value);function D(e,t){return`${e.key}-${t.displayName}`}function oe(e,t){return e.filterOptions.some(n=>t.includes(D(e,n)))}function ne(e){let t=$.value??[];const n=l.filterSets;n&&(t=t.filter(_=>{let d=!0;return n.forEach(i=>{if(oe(i,e)){let c=!1;i.filterOptions.forEach(I=>{e.includes(D(i,I))&&I.filterFn(_)&&(c=!0)}),c||(d=!1)}}),d}));const h=l.searchFields;if(K.value&&h){const _=N.value.toLowerCase();t=t.filter(d=>h.some(i=>{if(i){const c=we(d,i);return c===void 0?(ie.value.includes(i)||(console.warn(`Could not find search field '${i}' inside item for meta-list-card '${l.title}'`),ie.value.push(i)),!1):String(c).toLowerCase().includes(_)}else return String(d).toLowerCase().includes(_)}))}return t}const ie=b([]),Se=f(()=>{const e=$.value?.length??0;return K.value||T.value?`${E.value.length||0} / ${e}`:`${e}`}),Le=f(()=>($.value?.length??0)===0?"neutral":l.dangerous?"danger":"primary"),Z=b(0),V=f(()=>{if(ee.value){const e=C.value*l.pageSize;return E.value.slice(e,e+l.pageSize)}else return E.value}),ee=f(()=>L.value>1),L=f(()=>{const e=E.value.length;return Math.ceil(e/l.pageSize)}),C=f(()=>Math.min(Z.value,L.value-1));function re(e){Z.value=ye(e,0,L.value-1),Y()}function ue(e){Z.value=ye(C.value+e,0,L.value-1),Y()}const F=b(!1),q=b(!1),H=b(te.utc());function Ce(){F.value=!F.value}const $=b();Fe([()=>l.itemList,F],([e,t],[n,h])=>{t?h&&(pe($.value,e)||(q.value=!0)):($.value=he(e)??[],q.value=!1,H.value=te.utc())});function de(e){const t=$.value?.findIndex(n=>pe(n,e))??-1;return console.assert(t>=0,"Cannot find index for item that cannot be found in the list."),t}return(e,t)=>{const n=x("fa-icon"),h=x("b-card-title"),_=x("b-row"),d=x("b-skeleton"),i=x("b-col"),c=x("b-button"),I=x("b-card");return s(),k(I,{class:se(["shadow-sm",{"bg-light":!M.value||!Q.value}]),style:{"min-height":"12rem"},"no-body":""},{default:u(()=>[a(_,{class:se(["card-manual-title-padding",{"table-row-link":M.value&&J.value}]),"align-h":"between","align-v":"center","no-gutters":"",onClick:ae},{default:u(()=>[a(m(Me),{content:e.tooltip,"no-underline":""},{default:u(()=>[a(h,{class:"d-flex align-items-center"},{default:u(()=>[e.icon?(s(),k(n,{key:0,class:"mr-2",icon:e.icon},null,8,["icon"])):p("",!0),e.alternativeTitleStyle?(s(),o("div",Qe,g(e.title),1)):(s(),o("div",Je,g(e.title),1)),e.itemList&&Q.value?(s(),k(m(le),{key:3,class:"tw-ml-1",shape:"pill",variant:Le.value},{default:u(()=>[w(g(Se.value),1)],void 0,!0),_:1},8,["variant"])):p("",!0)],void 0,!0),_:1})],void 0,!0),_:1},8,["content"]),v("span",We,[T.value&&X.value?(s(),o("small",Xe,"filtered & sorted")):T.value?(s(),o("small",Ze,"filtered")):X.value?(s(),o("small",et,"sorted")):p("",!0),J.value?(s(),k(m(Be),{key:3,"disabled-tooltip":M.value?void 0:"There is nothing to search, filter or sort.",variant:ke.value?"primary":"neutral","aria-label":"Toggle the utilities menu",onClick:ae},{default:u(()=>[a(n,{class:"tw-mr-1",icon:"angle-right",size:"sm"}),a(n,{icon:"search",size:"sm"})],void 0,!0),_:1},8,["disabled-tooltip","variant"])):p("",!0)])],void 0,!0),_:1},8,["class"]),Q.value?e.itemList?M.value?(s(),o("div",lt,[v("div",null,[a(m(Ae),null,{default:u(()=>[J.value&&W.value?(s(),o("div",at,[v("div",ot,[v("div",nt,[t[9]||(t[9]=v("div",{class:"tw-mb-1 tw-text-sm tw-font-semibold"},"Search",-1)),e.searchFields?(s(),k(m(Te),{key:0,"model-value":N.value,placeholder:e.searchPlaceholder,variant:K.value?"success":"default",debounce:200,showClearButton:"","onUpdate:modelValue":t[0]||(t[0]=r=>N.value=r)},null,8,["model-value","placeholder","variant"])):(s(),o("span",it,"Search not available for this card."))]),a(_,null,{default:u(()=>[a(i,null,{default:u(()=>[t[10]||(t[10]=v("div",{class:"tw-mb-1 tw-text-sm tw-font-semibold"},"Filter",-1)),e.filterSets?(s(!0),o(j,{key:0},R(e.filterSets,(r,B)=>(s(),k(m(De),{key:B,"model-value":O.value,options:be(r),size:"small",class:se(["tw-mb-0.5",{"tw-text-neutral-500":!oe(r,O.value)}]),"onUpdate:modelValue":t[1]||(t[1]=$e=>O.value=$e)},null,8,["model-value","options","class"]))),128)):(s(),o("span",rt,"Filters not available for this card."))],void 0,!0),_:1,__:[10]}),a(i,null,{default:u(()=>[t[11]||(t[11]=v("div",{class:"tw-mb-1 tw-text-sm tw-font-semibold"},"Sort",-1)),e.sortOptions?(s(),k(m(Ve),{key:0,"model-value":U.value,options:_e.value,size:"small","onUpdate:modelValue":t[2]||(t[2]=r=>U.value=r)},null,8,["model-value","options"])):(s(),o("span",ut,"Sorting not available for this card."))],void 0,!0),_:1,__:[11]})],void 0,!0),_:1})])])):p("",!0)],void 0,!0),_:1}),e.description?(s(),o("div",dt,g(e.description),1)):p("",!0),v("div",vt,[G(e.$slots,"description",{},void 0,!0)]),e.allowPausing?(s(),o("div",ct,[ve(v("span",null,[t[12]||(t[12]=w("Last update ",-1)),a(m(ce),{instant:H.value},null,8,["instant"]),t[13]||(t[13]=w(".",-1))],512),[[me,!F.value]]),ve(v("span",null,[t[14]||(t[14]=w("Updates paused ",-1)),a(m(ce),{instant:H.value},null,8,["instant"]),t[15]||(t[15]=w(".",-1))],512),[[me,F.value]]),a(m(fe),{onClick:Ce,"data-testid":"play-pause-button"},{default:u(()=>[w(g(F.value?"Resume":"Pause")+" updates",1)],void 0,!0),_:1}),v("div",null,[q.value?(s(),k(m(le),{key:0,shape:"pill",variant:"primary"},{default:u(()=>t[16]||(t[16]=[w("New data available",-1)]),void 0,!0),_:1,__:[16]})):p("",!0)])])):p("",!0),V.value.length>0?(s(),o("div",mt,[e.listLayout==="list"?(s(),k(m(ze),{key:0,"data-testid":"meta-list-card-list-container"},{default:u(()=>[(s(!0),o(j,null,R(V.value,(r,B)=>(s(),o("div",{key:e.getItemKey?e.getItemKey(r):B,ref_for:!0,ref_key:"itemsElements",ref:z},[G(e.$slots,"item-card",{item:r,index:de(r)},()=>[w(g(r),1)],!0)]))),128)),C.value>0?(s(!0),o(j,{key:0},R(e.pageSize-V.value.length,r=>(s(),o("div",{key:m(A)+r.toString(),style:Ne(`min-height: ${P.value}px`)},null,4))),128)):p("",!0)],void 0,!0),_:3})):e.listLayout==="flex"?(s(),o("div",ft,[(s(!0),o(j,null,R(V.value,(r,B)=>(s(),o("div",{class:"mr-2 mb-2",key:B},[G(e.$slots,"item-card",{item:r,index:de(r)},()=>[v("pre",pt,g(r),1)],!0)]))),128))])):p("",!0)])):(s(),k(_,{key:3,class:"mb-4 pt-4 tw-text-center","align-h":"center","no-gutters":""},{default:u(()=>[v("span",gt,g(e.noResultsMessage),1)],void 0,!0),_:1}))]),e.moreInfoUri||ee.value?(s(),o("div",wt,[e.moreInfoUri?(s(),o("div",yt,[v("span",ht,[t[17]||(t[17]=w("View more items at theÂ ",-1)),a(m(fe),{to:e.moreInfoUri,permission:e.moreInfoPermission},{default:u(()=>[w(g(e.moreInfoLabel)+" page",1)],void 0,!0),_:1},8,["to","permission"]),t[18]||(t[18]=w("!",-1))])])):p("",!0),ee.value?(s(),o("div",bt,[a(m(qe),{size:"sm"},{default:u(()=>[a(c,{disabled:C.value==0,onClick:t[3]||(t[3]=r=>re(0))},{default:u(()=>[a(n,{icon:["fas","fast-backward"]})],void 0,!0),_:1},8,["disabled"]),a(c,{disabled:C.value==0,onClick:t[4]||(t[4]=r=>ue(-1))},{default:u(()=>[a(n,{icon:"backward"})],void 0,!0),_:1},8,["disabled"]),v("div",_t,[v("small",null,g(C.value+1)+" / "+g(L.value),1)]),a(c,{disabled:C.value==L.value-1,onClick:t[5]||(t[5]=r=>ue(1))},{default:u(()=>[a(n,{icon:"forward"})],void 0,!0),_:1},8,["disabled"]),a(c,{disabled:C.value==L.value-1,onClick:t[6]||(t[6]=r=>re(L.value-1))},{default:u(()=>[a(n,{icon:["fas","fast-forward"]})],void 0,!0),_:1},8,["disabled"])],void 0,!0),_:1})])):p("",!0)])):p("",!0)])):(s(),o("div",kt,[e.description?(s(),o("div",St,g(e.description),1)):p("",!0),v("div",Lt,[G(e.$slots,"description",{},void 0,!0)]),v("div",Ct,g(e.emptyMessage),1)])):(s(),o("div",st,[a(d,{width:"85%"}),a(d,{width:"55%"}),a(d,{width:"70%"}),a(d,{class:"tw-mt-4",width:"80%"}),a(d,{width:"65%"})])):(s(),o("div",tt,[t[7]||(t[7]=w("You need the ",-1)),a(m(le),null,{default:u(()=>[w(g(e.permission),1)],void 0,!0),_:1}),t[8]||(t[8]=w(" permission to view this card.",-1))]))],void 0,!0),_:3},8,["class"])}}}),Dt=Ee($t,[["__scopeId","data-v-cdf1ca76"]]);export{Dt as default};
