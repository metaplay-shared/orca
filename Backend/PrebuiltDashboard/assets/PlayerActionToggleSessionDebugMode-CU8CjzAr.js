import{d as T,h as p,E as V,c as v,ad as h,r as P,e as j,m as c,f as t,o as g,w as m,q as r,j as u,a as w,k as D,x as A,t as M,bs as B,bt as R}from"./index-DAyiym1a.js";import{a as z}from"./players-CkgXyjra.js";import{_ as q}from"./MInputToggleGroup.vue_vue_type_script_setup_true_lang-C2tbFKS_.js";import{_ as F}from"./MInputCheckbox.vue_vue_type_script_setup_true_lang-CmGaUCkv.js";import{_ as G}from"./MInputHintMessage.vue_vue_type_script_setup_true_lang-B7AbTbVm.js";import{_ as L}from"./MInputSingleSelectDropdown.vue_vue_type_script_setup_true_lang-BRIBVSuX.js";import{_ as H}from"./MInputNumber.vue_vue_type_script_setup_true_lang-qrqxgTEu.js";import{_ as J}from"./MActionModalButton.vue_vue_type_script_setup_true_lang-CRnsCPt_.js";import"./MInputSwitch.vue_vue_type_script_setup_true_lang-BI0IeYnL.js";import"./index-Byt7eTSs.js";import"./MActionModal.vue_vue_type_script_setup_true_lang-XDUxofmt.js";import"./index-CVSO09yM.js";const K={class:"tw-space-y-3"},Q={class:"tw-py-2"},W={key:0,class:"tw-mt-3 tw-space-y-2"},X={class:"tw-my-1 tw-text-neutral-500"},Y={key:0,class:"tw-text-neutral-500"},S=3,me=T({__name:"PlayerActionToggleSessionDebugMode",props:{playerId:{}},setup(_){const N=B(),{showSuccessNotification:x}=R(),k=_,a=p(!1),{data:e,refresh:O}=V(z(k.playerId)),n=p(S),i=p(!1),E=[{label:"Normal",value:"Normal"},{label:"Don't upload (keep on client)",value:"SilentlyOmitUploads"},{label:"Don't upload (discard from client)",value:"RejectIncidents"}],l=p("Normal");function U(){a.value=!!e.value.model.sessionDebugModeOverride,n.value=e.value.model.sessionDebugModeOverride?.forNextNumSessions??S,i.value=e.value.model.sessionDebugModeOverride?.parameters.enableEntityDebugConfig??!1,l.value=e.value.model.sessionDebugModeOverride?.parameters.incidentUploadMode??"Normal"}const $=v(()=>({Normal:"Incident reports will be uploaded normally.",SilentlyOmitUploads:"The client won't upload incidents reports to the server, but will keep them locally in case you change this option later.",RejectIncidents:"The client won't upload incidents reports to the server, and will delete them from its local storage."})[l.value]??"<unknown>"),f=v(()=>e.value.model.sessionDebugModeOverride?a.value&&n.value===e.value.model.sessionDebugModeOverride.forNextNumSessions&&i.value===e.value.model.sessionDebugModeOverride.parameters.enableEntityDebugConfig&&l.value===e.value.model.sessionDebugModeOverride.parameters.incidentUploadMode?"No changes to save.":void 0:a.value?!i.value&&l.value==="Normal"?"Enable logic checks or set a custom upload value for the debug mode to take effect.":void 0:"No changes to save."),b=v(()=>i.value||l.value!=="Normal"),y=v(()=>{if(e.value.model.sessionDebugModeOverride&&!a.value)return"Session debug mode will be disabled.";if(a.value){if(!b.value)return e.value.model.sessionDebugModeOverride?"All debug mode parameters have been reset to default values. This will have the same effect as disabling session debug mode.":"Select at least one parameter for the debug mode to take effect.";const s=[];return i.value!==e.value.model.sessionDebugModeOverride?.parameters.enableEntityDebugConfig&&s.push(i.value?"Extra logic execution checks will be enabled.":e.value.model.sessionDebugModeOverride?"Extra logic execution checks will be disabled.":void 0),l.value!==e.value.model.sessionDebugModeOverride?.parameters.incidentUploadMode&&s.push({Normal:"Incident reports will be uploaded normally.",SilentlyOmitUploads:"The client won't upload incidents reports to the server, but will keep them locally in case you change this option later.",RejectIncidents:"The client won't upload incidents reports to the server, and will delete them from its local storage."}[l.value]),n.value!==e.value.model.sessionDebugModeOverride?.forNextNumSessions&&s.push(`Session debug mode will be enabled for the next ${h(n.value,"session",!0)}.`),s.join(" ")}});async function C(){let s;e.value.model.sessionDebugModeOverride?b.value?s=a.value:s=!1:s=a.value;const o={parameters:{enableEntityDebugConfig:i.value,incidentUploadMode:l.value},forNextNumSessions:n.value};await N.post(`/players/${e.value.id}/sessionDebugMode?enabled=${s}`,o),x(`${e.value.model.playerName||"n/a"} debug mode ${a.value?"enabled":"disabled"}.`),O()}return(s,o)=>{const I=P("fa-icon");return t(e)?(g(),j(t(J),{key:0,"modal-title":"Manage Session Debug Mode",action:C,"trigger-button-label":t(e).model.sessionDebugModeOverride?"Edit Debug Mode":"Enable Debug Mode","trigger-button-full-width":"",variant:"warning","ok-button-label":"Save Settings","ok-button-disabled-tooltip":f.value,"confirm-permission":"api.players.toggle_debug_mode",onShow:U,"data-testid":"action-toggle-debug-mode"},{default:m(()=>[o[7]||(o[7]=r("p",{class:"tw-mb-3"},"Session debug mode enables additional debug tools for an individual player's sessions, allowing developers to pinpoint issues associated with that player.",-1)),u(t(q),{"model-value":a.value,"on-state-label":"Session Debug Mode Enabled","off-state-label":"Enable Session Debug Mode","off-state-hint-message":"Enable session debug mode for this player to access additional debug tools.","on-state-hint-message":"Session debug mode is enabled for this player. Disable it to turn off additional debug tools.",name:"isPlayerSessionDebugModeEnabled",size:"small","onUpdate:modelValue":o[3]||(o[3]=d=>a.value=d),"data-testid":"player-debug-mode-toggle"},{default:m(()=>[r("div",K,[r("div",Q,[u(t(F),{"model-value":i.value,size:"small","onUpdate:modelValue":o[0]||(o[0]=d=>i.value=d)},{default:m(()=>o[4]||(o[4]=[r("p",{class:"tw-font-bold"},"Enable Logic Execution Checks",-1)]),void 0,!0),_:1,__:[4]},8,["model-value"]),u(t(G),null,{default:m(()=>o[5]||(o[5]=[D("Enable additional logic checks to help pinpoint bugs more easily. These checks can be computationally expensive, so disable them if you experience performance issues.",-1)]),void 0,!0),_:1,__:[5]})]),u(t(L),{label:"Incident Report Uploads","model-value":l.value,options:E,"hint-message":$.value,"onUpdate:modelValue":o[1]||(o[1]=d=>l.value=d)},null,8,["model-value","hint-message"]),u(t(H),{label:"Number of Sessions (Optional)",disabled:!b.value,"model-value":n.value,min:1,"hint-message":`Session debug mode will automatically become disabled for this player after ${t(h)(n.value,"session",!0)}.`,"onUpdate:modelValue":o[2]||(o[2]=d=>n.value=d??1)},null,8,["disabled","model-value","hint-message"])])],void 0,!0),_:1},8,["model-value"]),y.value?(g(),w("div",W,[o[6]||(o[6]=r("span",{class:"tw-text-sm tw-font-bold"},"Status Preview",-1)),u(t(A),{class:"tw-rounded-md tw-border tw-border-neutral-200 tw-px-5"},{"bottom-left":m(()=>[r("p",X,M(y.value),1),f.value?c("",!0):(g(),w("p",Y,"Are you sure you want to proceed?"))]),default:m(()=>[r("span",null,[u(I,{icon:"user"}),D(" "+M(t(e).model.playerName||"n/a"),1)])],void 0,!0),_:1})])):c("",!0)],void 0,!0),_:1,__:[7]},8,["trigger-button-label","ok-button-disabled-tooltip"])):c("",!0)}}});export{me as default};
