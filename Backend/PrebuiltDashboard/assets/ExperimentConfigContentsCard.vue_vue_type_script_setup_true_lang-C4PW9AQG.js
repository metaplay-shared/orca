import{d as I,E as D,cc as V,c as m,h as k,K as j,e as v,o as r,w as p,m as h,f as y,_ as w,k as g,a as s,t as _,q as T,j as $,c6 as U,cL as G}from"./index-DAyiym1a.js";import{g as q,_ as z}from"./ConfigContentsCard.vue_vue_type_script_setup_true_lang-edmOVM7O.js";import{_ as A}from"./MInputSingleSelectDropdown.vue_vue_type_script_setup_true_lang-BRIBVSuX.js";const F={key:0},K={key:1},Y={key:0},H={key:1,class:"text-sm"},J={key:0},M={key:0},Q={key:1,class:"tw-italic tw-text-orange-400"},R={key:1},W={key:0,class:"tw-italic tw-text-red-400"},X={key:1},te=I({__name:"ExperimentConfigContentsCard",props:{gameConfigId:{default:"$active"},experimentId:{default:"Baseline"},excludeServerLibraries:{type:Boolean},hideNoDiffs:{type:Boolean},showExperimentSelector:{type:Boolean}},setup(C){const c=C,u=D(()=>V(c.gameConfigId)),b=m(()=>u.error.value),E=m(()=>Object.keys(d.value).map(e=>e==="Baseline"?{clearedValue:e}:{label:`${d.value[e].displayName} / ${e}`,value:e})),B=m(()=>{if(!u.isLoading.value)try{const t=u.data.value?.libraryImportErrors;let e={...u.data.value?.contents?.sharedLibraries};c.excludeServerLibraries||(e={...e,...u.data.value?.contents?.serverLibraries});const n=Object.keys(e).sort((i,f)=>i.localeCompare(f)).filter(i=>t?.[i]===void 0).map(i=>({id:i,numTopLevelItems:e[i],changeType:"None"}));t&&Object.entries(t).forEach(([i,f])=>{n.push({id:i,error:q(f),changeType:"None"})});const l=n.sort((i,f)=>i.id.localeCompare(f.id));return c.hideNoDiffs?l.filter(i=>d.value[a.value]?.patchedLibraries.includes(i.id)??!1):l}catch(t){return t instanceof Error?t:new Error("Unknown error")}}),o={},a=k(c.experimentId);function L(t){return t in o||(o[t]=k({configItems:null,error:void 0}),x(t)),o[t]}async function x(t){const e=o[t];try{const n=a.value,l=await U(G(c.gameConfigId,t,a.value==="Baseline"?void 0:a.value));if(n!==a.value)return;e.value.configItems=l.config[t]?.children??[],e.value.error=l.libraryImportErrors?.[t]}catch(n){n instanceof Error?e.value.error=n:e.value.error=new Error("Unknown error: "+String(n))}}j([()=>c.gameConfigId,()=>a.value],()=>{for(const t in o)if(Object.prototype.hasOwnProperty.call(o,t)){const e=o[t];e.value.configItems=null,x(t)}});const d=m(()=>{const t={Baseline:{displayName:"Baseline",variants:[],patchedLibraries:[]}};for(const e of Object.values(u.data.value?.experiments||{})){const n=e.id,l={displayName:e.displayName,variants:e.variants,patchedLibraries:e.patchedLibraries};t[n]=l}return t}),S=m(()=>d.value[a.value]?.variants??[]);function N(){return B}const O=m(()=>S.value.map(t=>({title:t,description:d.value[a.value]?.displayName})));return(t,e)=>(r(),v(z,{"additional-columns":O.value,"baseline-column":{title:"Baseline",description:void 0},"fetch-library-overview":N,"fetch-library":L,"hide-no-diffs":t.hideNoDiffs,"show-detailed-diff-badge":!1,error:b.value},{"no-results":p(()=>[a.value==="Baseline"?(r(),s("span",F,"You have not selected an experiment, so there are no differences to the baseline configuration to display.")):(r(),s("span",K,"The selected experiment contains no differences to the baseline configuration."))]),"header-right":p(()=>[b.value?h("",!0):(r(),s("div",Y,[t.showExperimentSelector?(r(),v(y(A),{key:0,class:"tw-w-96 tw-text-left","model-value":a.value,options:E.value,placeholder:"Select an experiment...","onUpdate:modelValue":e[0]||(e[0]=n=>a.value=n)},null,8,["model-value","options"])):(r(),s("div",H,[e[1]||(e[1]=g("Showing variants from ",-1)),$(y(w),{variant:"primary"},{default:p(()=>[g(_(a.value),1)],void 0,!0),_:1})]))]))]),value:p(n=>[n.key.title==="Baseline"?(r(),s("span",J,[n.item.values?.Baseline!==void 0?(r(),s("span",M,_(n.item.values.Baseline),1)):(r(),s("span",Q,"missing"))])):n.item.values!==void 0&&a.value+"."+n.key.title in n.item.values?(r(),s("span",R,[n.item.values[a.value+"."+n.key.title]===null?(r(),s("span",W,e[2]||(e[2]=[T("span",null,"removed",-1)]))):(r(),s("span",X,_(n.item.values[a.value+"."+n.key.title]),1))])):h("",!0)]),"library-right":p(n=>[d.value[a.value].patchedLibraries.includes(n.libraryId)?(r(),v(y(w),{key:0,size:"small",variant:"primary"},{default:p(()=>e[3]||(e[3]=[g("Variants",-1)]),void 0,!0),_:1,__:[3]})):h("",!0)]),_:1},8,["additional-columns","hide-no-diffs","error"]))}});export{te as _};
