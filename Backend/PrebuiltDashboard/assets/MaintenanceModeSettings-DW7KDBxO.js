import{d as F,E as W,a8 as j,h as g,D as c,c as M,r as G,e as S,o as n,w as r,q as f,a as l,m as V,f as t,F as w,k as s,j as d,y,t as k,_,b as A,ah as R,bs as q,bt as z}from"./index-DAyiym1a.js";import{_ as H}from"./MActionModalButton.vue_vue_type_script_setup_true_lang-CRnsCPt_.js";import{_ as J}from"./MInputToggleGroup.vue_vue_type_script_setup_true_lang-C2tbFKS_.js";import{_ as K}from"./MInputDateTime.vue_vue_type_script_setup_true_lang-BaxH1mqp.js";import{_ as Q}from"./MInputMultiSelectCheckbox.vue_vue_type_script_setup_true_lang-D6xsoOzq.js";import{_ as X}from"./MInputNumber.vue_vue_type_script_setup_true_lang-qrqxgTEu.js";import"./MActionModal.vue_vue_type_script_setup_true_lang-XDUxofmt.js";import"./index-CVSO09yM.js";import"./MInputHintMessage.vue_vue_type_script_setup_true_lang-B7AbTbVm.js";import"./MInputSwitch.vue_vue_type_script_setup_true_lang-BI0IeYnL.js";import"./index-Byt7eTSs.js";import"./MInputCheckbox.vue_vue_type_script_setup_true_lang-CmGaUCkv.js";const Y={class:"tw-space-y-2"},Z={key:0},ee={key:1},te={key:0},ae={key:1},ne={class:"tw-font-xs tw-mt-1 tw-text-neutral-400"},se={key:0},ie={key:1},oe={key:2},Se=F({__name:"MaintenanceModeSettings",props:{platforms:{default:()=>["iOS","Android","WebGL","UnityEditor"]}},setup(B){const b=B,E=q(),{data:a,refresh:O,error:N}=W(j()),o=g(!1),v=g(c.utc()),m=g(),p=g(null),I=M(()=>b.platforms.filter(u=>!a.value?.maintenanceStatus.scheduledMaintenanceMode.platformExclusions.includes(u))),U=M(()=>{if(!a.value)return"Loading...";if(!o.value&&!(a.value.maintenanceStatus.isInMaintenance||a.value.maintenanceStatus.scheduledMaintenanceMode))return"Toggle the switch to enable maintenance mode.";if(p.value?.length===0)return"Select at least one platform to enable maintenance mode."});function $(u){u&&(v.value=u)}const h=M(()=>v.value.diff(c.utc()).toMillis()>=0),{showSuccessNotification:x}=z();async function C(){if(o.value){const u={StartAt:v.value.toISO(),EstimatedDurationInMinutes:m.value??0,EstimationIsValid:!!m.value,PlatformExclusions:b.platforms.filter(e=>!p.value.includes(e))};await E.put("maintenanceMode",u),h.value?x("Maintenance mode enabled."):x("Maintenance mode scheduled.")}else await E.delete("maintenanceMode"),x("Maintenance mode disabled.");O()}const D=M(()=>o.value?h.value?{text:"Schedule",icon:"calendar-alt"}:{text:"Set Immediately",icon:["far","window-close"]}:{text:"Save Settings"});function L(){if(!a.value)throw new Error("Backend status data is not available.");m.value=a.value.maintenanceStatus.scheduledMaintenanceMode?.estimationIsValid?a.value.maintenanceStatus.scheduledMaintenanceMode?.estimatedDurationInMinutes:void 0,v.value=a.value.maintenanceStatus.scheduledMaintenanceMode?c.fromISO(a.value.maintenanceStatus.scheduledMaintenanceMode?.startAt):c.utc().plus({minutes:60}),a.value.maintenanceStatus.isInMaintenance||a.value.maintenanceStatus.scheduledMaintenanceMode?o.value=!0:o.value=!1,p.value=b.platforms.filter(u=>!a.value?.maintenanceStatus.scheduledMaintenanceMode?.platformExclusions.includes(u))}const T=M(()=>a.value?a.value.maintenanceStatus.isInMaintenance?{text:"On",variant:"success"}:a.value.maintenanceStatus.scheduledMaintenanceMode?{text:"Scheduled",variant:"primary"}:{text:"Off",variant:"neutral"}:{text:"Loading",variant:"neutral"});return(u,e)=>{const P=G("fa-icon");return n(),S(t(R),{title:"Maintenance Mode","is-loading":!t(a),error:t(N),badge:T.value.text,"badge-variant":T.value.variant,"data-testid":"system-maintenance-mode-card"},{subtitle:r(()=>e[3]||(e[3]=[s("Maintenance mode will prevent players from logging into the game. Use it to make backend downtime more graceful for players.",-1)])),buttons:r(()=>[d(t(H),{"modal-title":"Update Maintenance Mode Settings",action:C,"trigger-button-label":"Edit Settings",triggerButtonDisabledTooltip:t(a)?void 0:"Loading backend status.","ok-button-label":D.value.text,"ok-button-disabled-tooltip":U.value,permission:"api.system.edit_maintenance",onShow:L,"data-testid":"maintenance-mode"},{"ok-button-icon":r(()=>[D.value.icon?(n(),S(P,{key:0,class:"tw-mb-[0.05rem] tw-h-3.5 tw-w-4",icon:D.value.icon},null,8,["icon"])):V("",!0)]),default:r(()=>[e[16]||(e[16]=f("p",{class:"tw-my-1"},"Maintenance mode temporarily restricts player access to allow for game updates or fixes without disruption. When enabled, the game server detects maintenance mode and disconnects active players and prevents new logins.",-1)),d(t(J),{class:"tw-relative tw-top-1 tw-mb-1","model-value":o.value,"on-state-label":"Maintenance Mode Enabled","off-state-label":"Enable Maintenance Mode","off-state-hint-message":"Enable maintenance mode to schedule downtime to allow for game updates and fixes without disruptions.","on-state-hint-message":"With maintenance mode on, active players will be disconnected, and only developer players can continue accessing the game. Disable maintenance mode to restore access for all players.",name:"maintenanceModeEnabled",size:"small","onUpdate:modelValue":e[2]||(e[2]=i=>o.value=i),"data-testid":"maintenance-enabled"},{default:r(()=>[d(t(K),{"model-value":v.value,disabled:!o.value,"min-date-time":"utcNow",label:"Start Time (UTC)","onUpdate:modelValue":$},null,8,["model-value","disabled"]),f("p",ne,[!h.value&&o.value?(n(),l("span",se,"Maintenance mode will start immediately.")):o.value?(n(),l("span",ie,[e[14]||(e[14]=s("Maintenance mode will start ",-1)),d(t(y),{instant:v.value},null,8,["instant"]),e[15]||(e[15]=s(".",-1))])):(n(),l("span",oe,"Maintenance mode off."))]),d(t(Q),{class:"tw-mb-4","model-value":p.value,options:b.platforms.map(i=>({label:i,value:i})),label:"Platforms",disabled:!o.value,"hint-message":"Maintenance mode will only affect the selected platforms.","onUpdate:modelValue":e[0]||(e[0]=i=>p.value=i)},null,8,["model-value","options","disabled"]),d(t(X),{label:"Estimated Duration","model-value":m.value,disabled:!o.value,variant:o.value&&m.value&&m.value>0?"success":"default","hint-message":"This is just a number you can display on the client to the players. Maintenance mode will not turn off automatically based on duration.",min:0,"onUpdate:modelValue":e[1]||(e[1]=i=>m.value=i)},null,8,["model-value","disabled","variant"])],void 0,!0),_:1},8,["model-value"])],void 0,!0),_:1,__:[16]},8,["triggerButtonDisabledTooltip","ok-button-label","ok-button-disabled-tooltip"])]),default:r(()=>[f("div",Y,[t(a)?.maintenanceStatus.isInMaintenance?(n(),l(w,{key:0},[f("p",null,[e[4]||(e[4]=s("Maintenance mode started ",-1)),d(t(y),{instant:t(c).fromISO(t(a).maintenanceStatus.scheduledMaintenanceMode.startAt)},null,8,["instant"]),e[5]||(e[5]=s(".",-1))]),t(a).maintenanceStatus.scheduledMaintenanceMode.estimationIsValid?(n(),l("p",Z,"Estimated duration: "+k(t(a).maintenanceStatus.scheduledMaintenanceMode.estimatedDurationInMinutes)+" minutes",1)):(n(),l("p",ee,[e[7]||(e[7]=s("Duration: ",-1)),d(t(_),null,{default:r(()=>e[6]||(e[6]=[s("None",-1)]),void 0,!0),_:1,__:[6]})])),f("p",null,[e[8]||(e[8]=s("Affected platforms: ",-1)),(n(!0),l(w,null,A(I.value,i=>(n(),S(t(_),{class:"tw-mr-1",key:i},{default:r(()=>[s(k(i),1)],void 0,!0),_:2},1024))),128))])],64)):t(a)?.maintenanceStatus.scheduledMaintenanceMode?(n(),l(w,{key:1},[f("p",null,[e[9]||(e[9]=s("Maintenance mode has been scheduled to start ",-1)),d(t(y),{instant:t(c).fromISO(t(a).maintenanceStatus.scheduledMaintenanceMode.startAt),"disable-tooltip":""},null,8,["instant"]),e[10]||(e[10]=s(" on ",-1)),d(t(y),{instant:t(c).fromISO(t(a).maintenanceStatus.scheduledMaintenanceMode.startAt),showAs:"dateTime"},null,8,["instant"])]),t(a).maintenanceStatus.scheduledMaintenanceMode.estimationIsValid?(n(),l("p",te,"Estimated duration: "+k(t(a).maintenanceStatus.scheduledMaintenanceMode.estimatedDurationInMinutes)+" minutes",1)):(n(),l("p",ae,[e[12]||(e[12]=s("Duration: ",-1)),d(t(_),null,{default:r(()=>e[11]||(e[11]=[s("Off",-1)]),void 0,!0),_:1,__:[11]})])),f("p",null,[e[13]||(e[13]=s("Affected platforms: ",-1)),(n(!0),l(w,null,A(I.value,i=>(n(),S(t(_),{class:"tw-mr-1",key:i},{default:r(()=>[s(k(i),1)],void 0,!0),_:2},1024))),128))])],64)):V("",!0)])],void 0,!0),_:1},8,["is-loading","error","badge","badge-variant"])}}});export{Se as default};
