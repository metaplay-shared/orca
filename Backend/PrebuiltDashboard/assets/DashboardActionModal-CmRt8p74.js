import{d as h,h as u,E as _,a as g,o as m,m as b,j as A,t as I,f as v,c as d,aP as B,K as E,e6 as M,bs as P,e as D,w as S,k as q}from"./index-DAyiym1a.js";import{a as k}from"./players-CkgXyjra.js";import{_ as x}from"./MetaGeneratedForm.vue_vue_type_script_setup_true_lang-DdaVgxEJ.js";import{_ as L}from"./MInputHintMessage.vue_vue_type_script_setup_true_lang-B7AbTbVm.js";import{_ as T}from"./MActionModalButton.vue_vue_type_script_setup_true_lang-CRnsCPt_.js";import"./GeneratedUiFormDynamicComponent.vue_vue_type_script_setup_true_lang-BiTvhFwY.js";import"./MInputMultiSelectCheckbox.vue_vue_type_script_setup_true_lang-D6xsoOzq.js";import"./MInputCheckbox.vue_vue_type_script_setup_true_lang-CmGaUCkv.js";import"./MInputSingleSelectDropdown.vue_vue_type_script_setup_true_lang-BRIBVSuX.js";import"./MActionModal.vue_vue_type_script_setup_true_lang-XDUxofmt.js";import"./index-CVSO09yM.js";const j={key:0,class:"tw-mb-1"},z=h({__name:"DefaultDashboardActionContent",props:{playerId:{},actionData:{}},emits:["input"],setup(f,{emit:p}){const o=f,l=u(o.actionData.initialState),y=p;function r(t){l.value=t,y("input",t)}const{data:c}=_(k(o.playerId));return(t,i)=>(m(),g("div",null,[t.actionData.description&&t.actionData.description!==""?(m(),g("p",j,I(t.actionData.description),1)):b("",!0),A(x,{"logic-version":v(c).logicVersion,value:l.value,"type-name":t.actionData.typeName,"add-type-specifier":!0,onInput:i[0]||(i[0]=a=>r(a))},null,8,["logic-version","value","type-name"])]))}}),ee=h({__name:"DashboardActionModal",props:{playerId:{},typeName:{},placement:{}},setup(f){const p=P(),o=f,{data:l,refresh:y}=_(k(o.playerId)),r=u(),c=u(!0),t=u(!1),i=u(),a=d(()=>{const e=(l.value?.playerSpecializedActions??[]).find(R=>R.typeName===o.typeName);if(e===void 0)return;const s={Before:"before",After:"after"};return{...e,permission:e.permission===null?void 0:e.permission,layoutRule:e.layoutRule===null?{position:"before"}:{position:s[e.layoutRule.position],targetId:e.layoutRule.targetId}}});function w(){r.value=a.value.initialState}const N=d(()=>!B(a.value?.initialState,r.value)),$=d(()=>{if(t.value)return"Validating...";if(i.value)return"Server validation error.";if(!c.value)return"Content is not valid.";if(a.value?.requireInputBeforeAllowingConfirm&&!N.value)return`No changes to ${a.value.confirmLabel}.`});E(r,async n=>{n&&(t.value=!0,i.value=void 0,await M(250).then(()=>{p.post(`/dashboardActions/${o.playerId}/validate`,n).then(e=>{t.value=!1,e.data!=="Success"&&(i.value=e.data)})}))});const C=d(()=>o.placement==="Dangerous"?"danger":o.placement==="Disruptive"?"warning":"primary");async function V(n){await p.post(`/dashboardActions/${o.playerId}/execute`,n),y()}return(n,e)=>v(l)&&a.value?(m(),D(v(T),{key:0,"trigger-button-label":a.value.title,"modal-title":a.value.title,action:async()=>await V(r.value),permission:a.value.permission,variant:C.value,"ok-button-label":a.value.confirmLabel,"ok-button-disabled-tooltip":$.value,onShow:w,"data-testid":`dashboard-action-${a.value.title}`},{default:S(()=>[A(z,{"action-data":a.value,"player-id":n.playerId,placement:n.placement,onInput:e[0]||(e[0]=s=>r.value=s),onStatus:e[1]||(e[1]=s=>c.value=s)},null,8,["action-data","player-id","placement"]),i.value?(m(),D(v(L),{key:0,variant:"danger"},{default:S(()=>[q("Server validation error: "+I(i.value),1)],void 0,!0),_:1})):b("",!0)],void 0,!0),_:1},8,["trigger-button-label","modal-title","action","permission","variant","ok-button-label","ok-button-disabled-tooltip","data-testid"])):b("",!0)}});export{ee as default};
