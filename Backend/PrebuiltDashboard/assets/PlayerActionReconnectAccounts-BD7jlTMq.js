import{d as q,C as G,E as H,h as P,c as w,cG as h,r as T,a as l,o as t,j as i,w as s,e as p,m as z,q as c,t as d,f as o,ah as M,v as C,F as k,b as S,x,k as r,aS as J,_ as m,bd as K,bs as $,bt as Q}from"./index-DAyiym1a.js";import{p as D}from"./utils-DSYdgMhH.js";import{a as U}from"./players-CkgXyjra.js";import{_ as O}from"./OverviewList.vue_vue_type_script_setup_true_lang-CWu4PkuC.js";import{_ as X}from"./MActionModalButton.vue_vue_type_script_setup_true_lang-CRnsCPt_.js";import"./timeUtils-_Yn_3RE3.js";import"./MetaLanguageLabel.vue_vue_type_script_setup_true_lang-DNwLaJf6.js";import"./MCountryCode.vue_vue_type_script_setup_true_lang-BXb2nCN7.js";import"./MActionModal.vue_vue_type_script_setup_true_lang-XDUxofmt.js";import"./index-CVSO09yM.js";const Y={key:0},Z={key:0,class:"font-weight-bold text-danger"},ee={key:1,class:"font-weight-bold text-danger"},te={class:"text-truncate"},oe={key:1,class:"tw-mt-2 tw-italic tw-text-neutral-500"},se={key:1},ae={class:"tw-mb-1 tw-mt-1 tw-h-12"},le={key:0,class:"tw-font-semibold tw-text-green-500"},ne={key:1,class:"tw-text-semibold"},ie={class:"text-truncate"},re={key:0,class:"tw-font-semibold tw-text-green-500"},de={key:1,class:"tw-font-semibold tw-text-green-500"},ce={class:"tw-text-truncate"},ue={key:1,class:"tw-mt-2 tw-italic tw-text-neutral-500"},ke=q({__name:"PlayerActionReconnectAccounts",props:{playerId:{}},setup(N){const R=N,A=G(),{data:u,refresh:W}=H(U(R.playerId)),v=P(),n=P(),j=w(()=>!!n.value?.model),y=w(()=>!(!j.value||Object.keys(n.value?.model.attachedAuthMethods).length===0)),f=w(()=>n.value?.model?D(n.value.model.attachedAuthMethods,n.value.model.deviceHistory):[]),b=w(()=>D(u.value.model.attachedAuthMethods,u.value.model.deviceHistory));function L(){v.value=void 0,n.value=void 0}let _=h.CancelToken.source();async function I(g){v.value=g,n.value=null;try{_&&_.cancel("Request cancelled by user interaction."),_=h.CancelToken.source();const e=(await $().get(`/players/${g.id}`,{cancelToken:_.token})).data;e&&(n.value=e)}catch(e){h.isCancel(e)}}const{showSuccessNotification:V}=Q();async function B(){if(v.value&&n.value)await $().post(`/players/${v.value.id}/moveAuthTo/${u.value.id}`),V(`Login methods from '${v.value.id}' moved to the current player.`),W();else throw new Error('Trying to trigger "moveAuth" without a source player!')}return(g,e)=>{const F=T("meta-input-player-select"),E=T("meta-no-seatbelts");return t(),l("div",null,[i(o(X),{"modal-title":"Move Devices from Another Account",action:B,"trigger-button-label":"Reconnect Devices",variant:"warning","ok-button-label":"Reconnect Devices","ok-button-disabled-tooltip":y.value?void 0:"Select a valid player account to proceed.","confirm-permission":"api.players.reconnect_account","trigger-button-disabled-tooltip":o(u)?"":"Waiting for player data..",onShow:L,"data-testid":"action-merge-accounts"},{default:s(()=>[e[3]||(e[3]=c("h6",{class:"tw-mb-1 tw-font-semibold"},"Move Devices & Social Auths from this account..",-1)),i(F,{value:v.value,ignorePlayerIds:[o(u).id],onInput:I},null,8,["value","ignorePlayerIds"]),i(o(M),{class:"tw-mt-3",title:"Source Account Preview"},{default:s(()=>[n.value?.model?(t(),l("div",Y,[i(O,{class:"tw-mb-4",listTitle:"Overview",icon:"chart-bar",sourceObject:n.value,items:o(A).overviewLists.playerReconnectPreview},null,8,["sourceObject","items"]),e[2]||(e[2]=c("span",{class:"font-weight-bold"},"Login Methods",-1)),f.value&&f.value.length>0?(t(),p(o(C),{key:0},{default:s(()=>[(t(!0),l(k,null,S(f.value,a=>(t(),p(o(x),{class:"tw-pb-1 tw-pt-1",key:a.id,"no-left-padding":""},{"bottom-left":s(()=>[c("p",te,d(a.id),1)]),default:s(()=>[a.type==="device"?(t(),l("span",Z,[r("📱 "+d(a.displayString)+" ",1),i(o(m),{variant:"danger"},{default:s(()=>e[0]||(e[0]=[r("Will be removed",-1)]),void 0,!0),_:1,__:[0]})])):(t(),l("span",ee,[r("👨‍👩‍👧‍👦 "+d(a.displayString)+" ",1),i(o(m),{variant:"danger"},{default:s(()=>e[1]||(e[1]=[r("Will be removed",-1)]),void 0,!0),_:1,__:[1]})]))],void 0,!0),_:2},1024))),128))],void 0,!0),_:1})):(t(),l("p",oe,"This account has no credentials attached."))])):(t(),l("div",se,"Type in a valid player ID to preview what device reconnecting would do."))],void 0,!0),_:1})]),"right-panel":s(()=>[e[9]||(e[9]=c("span",{class:"tw-mb-1 tw-font-semibold"},"...to the current account",-1)),c("p",ae,d(o(u).id),1),i(o(M),{class:"tw-mt-6",title:"Current Account Preview"},{default:s(()=>[i(O,{class:"tw-mb-4",listTitle:"Overview",icon:"chart-bar",sourceObject:o(u),items:o(A).overviewLists.playerReconnectPreview},null,8,["sourceObject","items"]),e[8]||(e[8]=c("span",{class:"font-weight-bold"},"Login Methods",-1)),b.value&&b.value.length>0?(t(),p(o(C),{key:0},{default:s(()=>[(t(!0),l(k,null,S(b.value,a=>(t(),p(o(x),{class:"tw-pb-1 tw-pt-1",key:a.id,"no-left-padding":""},{"bottom-left":s(()=>[c("p",ie,d(a.id),1)]),default:s(()=>[a.type==="device"?(t(),l("span",le,[r("📱 "+d(a.displayString)+" ",1),J(i(o(m),null,{default:s(()=>e[4]||(e[4]=[r("Will remain",-1)]),void 0,!0),_:1,__:[4]},512),[[K,y.value]])])):(t(),l("span",ne,[r("👨‍👩‍👧‍👦 "+d(a.displayString)+" ",1),i(o(m),null,{default:s(()=>e[5]||(e[5]=[r("Will remain",-1)]),void 0,!0),_:1,__:[5]})]))],void 0,!0),_:2},1024))),128)),(t(!0),l(k,null,S(f.value,a=>(t(),p(o(x),{class:"tw-pb-1 tw-pt-1",key:a.id,"no-left-padding":""},{"bottom-left":s(()=>[c("p",ce,d(a.id),1)]),default:s(()=>[a.type==="device"?(t(),l("span",re,[r("📱 "+d(a.displayString)+" ",1),i(o(m),{variant:"success"},{default:s(()=>e[6]||(e[6]=[r("Will be added",-1)]),void 0,!0),_:1,__:[6]})])):(t(),l("span",de,[r("👨‍👩‍👧‍👦 "+d(a.displayString)+" ",1),i(o(m),{variant:"success"},{default:s(()=>e[7]||(e[7]=[r("Will be added",-1)]),void 0,!0),_:1,__:[7]})]))],void 0,!0),_:2},1024))),128))],void 0,!0),_:1})):(t(),l("p",ue,"This account has no credentials attached."))],void 0,!0),_:1,__:[8]})]),"bottom-panel":s(()=>[y.value?(t(),p(E,{key:0,class:"tw-mx-auto tw-w-7/12",name:n.value.model.playerName||"n/a"},null,8,["name"])):z("",!0)]),_:1},8,["ok-button-disabled-tooltip","trigger-button-disabled-tooltip"])])}}});export{ke as default};
